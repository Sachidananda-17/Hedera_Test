var WalletConnectGlobal=(()=>{var jb=Object.create;var Qi=Object.defineProperty;var Vb=Object.getOwnPropertyDescriptor;var $b=Object.getOwnPropertyNames;var Hb=Object.getPrototypeOf,Kb=Object.prototype.hasOwnProperty;var ce=(t,e)=>()=>(t&&(e=t(t=0)),e);var me=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ne=(t,e)=>{for(var r in e)Qi(t,r,{get:e[r],enumerable:!0})},Xi=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of $b(e))!Kb.call(t,n)&&n!==r&&Qi(t,n,{get:()=>e[n],enumerable:!(s=Vb(e,n))||s.enumerable});return t},bt=(t,e,r)=>(Xi(t,e,"default"),r&&Xi(r,e,"default")),De=(t,e,r)=>(r=t!=null?jb(Hb(t)):{},Xi(e||!t||!t.__esModule?Qi(r,"default",{value:t,enumerable:!0}):r,t)),Ms=t=>Xi(Qi({},"__esModule",{value:!0}),t);var ps=me(($5,mc)=>{"use strict";var qs=typeof Reflect=="object"?Reflect:null,Yf=qs&&typeof qs.apply=="function"?qs.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},eo;qs&&typeof qs.ownKeys=="function"?eo=qs.ownKeys:Object.getOwnPropertySymbols?eo=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:eo=function(e){return Object.getOwnPropertyNames(e)};function Gb(t){console&&console.warn&&console.warn(t)}var Zf=Number.isNaN||function(e){return e!==e};function ue(){ue.init.call(this)}mc.exports=ue;mc.exports.once=Zb;ue.EventEmitter=ue;ue.prototype._events=void 0;ue.prototype._eventsCount=0;ue.prototype._maxListeners=void 0;var Jf=10;function to(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ue,"defaultMaxListeners",{enumerable:!0,get:function(){return Jf},set:function(t){if(typeof t!="number"||t<0||Zf(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Jf=t}});ue.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ue.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Zf(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Xf(t){return t._maxListeners===void 0?ue.defaultMaxListeners:t._maxListeners}ue.prototype.getMaxListeners=function(){return Xf(this)};ue.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var n=e==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(c===void 0)return!1;if(typeof c=="function")Yf(c,this,r);else for(var u=c.length,l=sd(c,u),s=0;s<u;++s)Yf(l[s],this,r);return!0};function Qf(t,e,r,s){var n,i,o;if(to(r),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),o=i[e]),o===void 0)o=i[e]=r,++t._eventsCount;else if(typeof o=="function"?o=i[e]=s?[r,o]:[o,r]:s?o.unshift(r):o.push(r),n=Xf(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Gb(a)}return t}ue.prototype.addListener=function(e,r){return Qf(this,e,r,!1)};ue.prototype.on=ue.prototype.addListener;ue.prototype.prependListener=function(e,r){return Qf(this,e,r,!0)};function Wb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ed(t,e,r){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=Wb.bind(s);return n.listener=r,s.wrapFn=n,n}ue.prototype.once=function(e,r){return to(r),this.on(e,ed(this,e,r)),this};ue.prototype.prependOnceListener=function(e,r){return to(r),this.prependListener(e,ed(this,e,r)),this};ue.prototype.removeListener=function(e,r){var s,n,i,o,a;if(to(r),n=this._events,n===void 0)return this;if(s=n[e],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){for(i=-1,o=s.length-1;o>=0;o--)if(s[o]===r||s[o].listener===r){a=s[o].listener,i=o;break}if(i<0)return this;i===0?s.shift():Yb(s,i),s.length===1&&(n[e]=s[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};ue.prototype.off=ue.prototype.removeListener;ue.prototype.removeAllListeners=function(e){var r,s,n;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),o;for(n=0;n<i.length;++n)o=i[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function td(t,e,r){var s=t._events;if(s===void 0)return[];var n=s[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?Jb(n):sd(n,n.length)}ue.prototype.listeners=function(e){return td(this,e,!0)};ue.prototype.rawListeners=function(e){return td(this,e,!1)};ue.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):rd.call(t,e)};ue.prototype.listenerCount=rd;function rd(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ue.prototype.eventNames=function(){return this._eventsCount>0?eo(this._events):[]};function sd(t,e){for(var r=new Array(e),s=0;s<e;++s)r[s]=t[s];return r}function Yb(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Jb(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Zb(t,e){return new Promise(function(r,s){function n(o){t.removeListener(e,i),s(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}nd(t,e,i,{once:!0}),e!=="error"&&Xb(t,n,{once:!0})})}function Xb(t,e,r){typeof t.on=="function"&&nd(t,"error",e,r)}function nd(t,e,r,s){if(typeof t.on=="function")s.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(i){s.once&&t.removeEventListener(e,n),r(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}});var zs={};Ne(zs,{__assign:()=>wc,__asyncDelegator:()=>h1,__asyncGenerator:()=>l1,__asyncValues:()=>f1,__await:()=>On,__awaiter:()=>n1,__classPrivateFieldGet:()=>m1,__classPrivateFieldSet:()=>y1,__createBinding:()=>o1,__decorate:()=>t1,__exportStar:()=>a1,__extends:()=>Qb,__generator:()=>i1,__importDefault:()=>g1,__importStar:()=>p1,__makeTemplateObject:()=>d1,__metadata:()=>s1,__param:()=>r1,__read:()=>id,__rest:()=>e1,__spread:()=>c1,__spreadArrays:()=>u1,__values:()=>bc});function Qb(t,e){yc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function e1(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(r[s[n]]=t[s[n]]);return r}function t1(t,e,r,s){var n=arguments.length,i=n<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,r):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(n<3?o(i):n>3?o(e,r,i):o(e,r))||i);return n>3&&i&&Object.defineProperty(e,r,i),i}function r1(t,e){return function(r,s){e(r,s,t)}}function s1(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function n1(t,e,r,s){function n(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(t,e||[])).next())})}function i1(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,n,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,n&&(i=u[0]&2?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],n=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function o1(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}function a1(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function bc(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function id(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=s.next()).done;)i.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i}function c1(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(id(arguments[e]));return t}function u1(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var s=Array(t),n=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function On(t){return this instanceof On?(this.v=t,this):new On(t)}function l1(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(t,e||[]),n,i=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){s[f]&&(n[f]=function(p){return new Promise(function(d,g){i.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(s[f](p))}catch(d){h(i[0][3],d)}}function c(f){f.value instanceof On?Promise.resolve(f.value.v).then(u,l):h(i[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,p){f(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}function h1(t){var e,r;return e={},s("next"),s("throw",function(n){throw n}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(n,i){e[n]=t[n]?function(o){return(r=!r)?{value:On(t[n](o)),done:n==="return"}:i?i(o):o}:i}}function f1(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof bc=="function"?bc(t):t[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),n(a,c,o.done,o.value)})}}function n(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}}function d1(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function p1(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function g1(t){return t&&t.__esModule?t:{default:t}}function m1(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function y1(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var yc,wc,js=ce(()=>{yc=function(t,e){return yc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var n in s)s.hasOwnProperty(n)&&(r[n]=s[n])},yc(t,e)};wc=function(){return wc=Object.assign||function(e){for(var r,s=1,n=arguments.length;s<n;s++){r=arguments[s];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},wc.apply(this,arguments)}});var od=me(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.delay=void 0;function w1(t){return new Promise(e=>{setTimeout(()=>{e(!0)},t)})}ro.delay=w1});var ad=me(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.ONE_THOUSAND=Vs.ONE_HUNDRED=void 0;Vs.ONE_HUNDRED=100;Vs.ONE_THOUSAND=1e3});var cd=me(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.ONE_YEAR=V.FOUR_WEEKS=V.THREE_WEEKS=V.TWO_WEEKS=V.ONE_WEEK=V.THIRTY_DAYS=V.SEVEN_DAYS=V.FIVE_DAYS=V.THREE_DAYS=V.ONE_DAY=V.TWENTY_FOUR_HOURS=V.TWELVE_HOURS=V.SIX_HOURS=V.THREE_HOURS=V.ONE_HOUR=V.SIXTY_MINUTES=V.THIRTY_MINUTES=V.TEN_MINUTES=V.FIVE_MINUTES=V.ONE_MINUTE=V.SIXTY_SECONDS=V.THIRTY_SECONDS=V.TEN_SECONDS=V.FIVE_SECONDS=V.ONE_SECOND=void 0;V.ONE_SECOND=1;V.FIVE_SECONDS=5;V.TEN_SECONDS=10;V.THIRTY_SECONDS=30;V.SIXTY_SECONDS=60;V.ONE_MINUTE=V.SIXTY_SECONDS;V.FIVE_MINUTES=V.ONE_MINUTE*5;V.TEN_MINUTES=V.ONE_MINUTE*10;V.THIRTY_MINUTES=V.ONE_MINUTE*30;V.SIXTY_MINUTES=V.ONE_MINUTE*60;V.ONE_HOUR=V.SIXTY_MINUTES;V.THREE_HOURS=V.ONE_HOUR*3;V.SIX_HOURS=V.ONE_HOUR*6;V.TWELVE_HOURS=V.ONE_HOUR*12;V.TWENTY_FOUR_HOURS=V.ONE_HOUR*24;V.ONE_DAY=V.TWENTY_FOUR_HOURS;V.THREE_DAYS=V.ONE_DAY*3;V.FIVE_DAYS=V.ONE_DAY*5;V.SEVEN_DAYS=V.ONE_DAY*7;V.THIRTY_DAYS=V.ONE_DAY*30;V.ONE_WEEK=V.SEVEN_DAYS;V.TWO_WEEKS=V.ONE_WEEK*2;V.THREE_WEEKS=V.ONE_WEEK*3;V.FOUR_WEEKS=V.ONE_WEEK*4;V.ONE_YEAR=V.ONE_DAY*365});var Ec=me(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});var ud=(js(),Ms(zs));ud.__exportStar(ad(),so);ud.__exportStar(cd(),so)});var hd=me($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});$s.fromMiliseconds=$s.toMiliseconds=void 0;var ld=Ec();function b1(t){return t*ld.ONE_THOUSAND}$s.toMiliseconds=b1;function E1(t){return Math.floor(t/ld.ONE_THOUSAND)}$s.fromMiliseconds=E1});var dd=me(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});var fd=(js(),Ms(zs));fd.__exportStar(od(),no);fd.__exportStar(hd(),no)});var pd=me(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.Watch=void 0;var io=class{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){let r=this.get(e);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${e}`);let s=Date.now()-r.started;this.timestamps.set(e,{started:r.started,elapsed:s})}get(e){let r=this.timestamps.get(e);if(typeof r>"u")throw new Error(`No timestamp found for label: ${e}`);return r}elapsed(e){let r=this.get(e);return r.elapsed||Date.now()-r.started}};Cn.Watch=io;Cn.default=io});var gd=me(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.IWatch=void 0;var xc=class{};oo.IWatch=xc});var md=me(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});var x1=(js(),Ms(zs));x1.__exportStar(gd(),vc)});var Ks=me(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});var ao=(js(),Ms(zs));ao.__exportStar(dd(),Hs);ao.__exportStar(pd(),Hs);ao.__exportStar(md(),Hs);ao.__exportStar(Ec(),Hs)});var Nd=me((yT,Bd)=>{"use strict";function H1(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}Bd.exports=K1;function K1(t,e,r){var s=r&&r.stringify||H1,n=1;if(typeof t=="object"&&t!==null){var i=e.length+n;if(i===1)return t;var o=new Array(i);o[0]=s(t);for(var a=1;a<i;a++)o[a]=s(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-n,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Number(e[l]),h=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Math.floor(Number(e[l])),h=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<p&&(u+=t.slice(h,p));var d=typeof e[l];if(d==="string"){u+="'"+e[l]+"'",h=p+2,p++;break}if(d==="function"){u+=e[l].name||"<anonymous>",h=p+2,p++;break}u+=s(e[l]),h=p+2,p++;break;case 115:if(l>=c)break;h<p&&(u+=t.slice(h,p)),u+=String(e[l]),h=p+2,p++;break;case 37:h<p&&(u+=t.slice(h,p)),u+="%",h=p+2,p++,l--;break}++l}++p}return h===-1?t:(h<f&&(u+=t.slice(h)),u)}});var Nc=me((wT,Ld)=>{"use strict";var Pd=Nd();Ld.exports=Jt;var Fn=rE().console||{},G1={mapHttpRequest:fo,mapHttpResponse:fo,wrapRequestSerializer:Cc,wrapResponseSerializer:Cc,wrapErrorSerializer:Cc,req:fo,res:fo,err:X1};function W1(t,e){return Array.isArray(t)?t.filter(function(s){return s!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Jt(t){t=t||{},t.browser=t.browser||{};let e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");let r=t.browser.write||Fn;t.browser.write&&(t.browser.asObject=!0);let s=t.serializers||{},n=W1(t.browser.serialize,s),i=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(i=!1);let o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");let a=t.level||"info",c=Object.create(r);c.log||(c.log=Ln),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:f});let u={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:Q1(t)};c.levels=Jt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Ln,c.serializers=s,c._serialize=n,c._stdErrSerialize=i,c.child=p,e&&(c._logEvent=Bc());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function f(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,Gs(u,c,"error","log"),Gs(u,c,"fatal","error"),Gs(u,c,"warn","error"),Gs(u,c,"info","log"),Gs(u,c,"debug","log"),Gs(u,c,"trace","log")}function p(d,g){if(!d)throw new Error("missing bindings for child Pino");g=g||{},n&&d.serializers&&(g.serializers=d.serializers);let m=g.serializers;if(n&&m){var S=Object.assign({},s,m),A=t.browser.serialize===!0?Object.keys(S):n;delete d.serializers,po([d],A,S,this._stdErrSerialize)}function b(E){this._childLevel=(E._childLevel|0)+1,this.error=Ws(E,d,"error"),this.fatal=Ws(E,d,"fatal"),this.warn=Ws(E,d,"warn"),this.info=Ws(E,d,"info"),this.debug=Ws(E,d,"debug"),this.trace=Ws(E,d,"trace"),S&&(this.serializers=S,this._serialize=A),e&&(this._logEvent=Bc([].concat(E._logEvent.bindings,d)))}return b.prototype=this,new b(this)}return c}Jt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Jt.stdSerializers=G1;Jt.stdTimeFunctions=Object.assign({},{nullTime:Ud,epochTime:Fd,unixTime:eE,isoTime:tE});function Gs(t,e,r,s){let n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Ln:n[r]?n[r]:Fn[r]||Fn[s]||Ln,Y1(t,e,r)}function Y1(t,e,r){!t.transmit&&e[r]===Ln||(e[r]=function(s){return function(){let i=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Fn?Fn:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&po(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?s.call(a,J1(this,r,o,i)):s.apply(a,o),t.transmit){let u=t.transmit.level||e.level,l=Jt.levels.values[u],h=Jt.levels.values[r];if(h<l)return;Z1(this,{ts:i,methodLevel:r,methodValue:h,transmitLevel:u,transmitValue:Jt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function J1(t,e,r,s){t._serialize&&po(r,t._serialize,t.serializers,t._stdErrSerialize);let n=r.slice(),i=n[0],o={};s&&(o.time=s),o.level=Jt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),i!==null&&typeof i=="object"){for(;a--&&typeof n[0]=="object";)Object.assign(o,n.shift());i=n.length?Pd(n.shift(),n):void 0}else typeof i=="string"&&(i=Pd(n.shift(),n));return i!==void 0&&(o.msg=i),o}function po(t,e,r,s){for(let n in t)if(s&&t[n]instanceof Error)t[n]=Jt.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(let i in t[n])e&&e.indexOf(i)>-1&&i in r&&(t[n][i]=r[i](t[n][i]))}function Ws(t,e,r){return function(){let s=new Array(1+arguments.length);s[0]=e;for(var n=1;n<s.length;n++)s[n]=arguments[n-1];return t[r].apply(this,s)}}function Z1(t,e,r){let s=e.send,n=e.ts,i=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;po(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=i,t._logEvent.level.value=o,s(i,t._logEvent,a),t._logEvent=Bc(c)}function Bc(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function X1(t){let e={type:t.constructor.name,msg:t.message,stack:t.stack};for(let r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Q1(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Ud:Fd}function fo(){return{}}function Cc(t){return t}function Ln(){}function Ud(){return!1}function Fd(){return Date.now()}function eE(){return Math.round(Date.now()/1e3)}function tE(){return new Date(Date.now()).toISOString()}function rE(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}});var zo=me(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.getLocalStorage=fe.getLocalStorageOrThrow=fe.getCrypto=fe.getCryptoOrThrow=fe.getLocation=fe.getLocationOrThrow=fe.getNavigator=fe.getNavigatorOrThrow=fe.getDocument=fe.getDocumentOrThrow=fe.getFromWindowOrThrow=fe.getFromWindow=void 0;function ys(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}fe.getFromWindow=ys;function Zs(t){let e=ys(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}fe.getFromWindowOrThrow=Zs;function g2(){return Zs("document")}fe.getDocumentOrThrow=g2;function m2(){return ys("document")}fe.getDocument=m2;function y2(){return Zs("navigator")}fe.getNavigatorOrThrow=y2;function w2(){return ys("navigator")}fe.getNavigator=w2;function b2(){return Zs("location")}fe.getLocationOrThrow=b2;function E2(){return ys("location")}fe.getLocation=E2;function x2(){return Zs("crypto")}fe.getCryptoOrThrow=x2;function v2(){return ys("crypto")}fe.getCrypto=v2;function I2(){return Zs("localStorage")}fe.getLocalStorageOrThrow=I2;function S2(){return ys("localStorage")}fe.getLocalStorage=S2});var $p=me(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.getWindowMetadata=void 0;var Vp=zo();function _2(){let t,e;try{t=Vp.getDocumentOrThrow(),e=Vp.getLocationOrThrow()}catch{return null}function r(){let h=t.getElementsByTagName("link"),f=[];for(let p=0;p<h.length;p++){let d=h[p],g=d.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){let m=d.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let S=e.protocol+"//"+e.host;if(m.indexOf("/")===0)S+=m;else{let A=e.pathname.split("/");A.pop();let b=A.join("/");S+=b+"/"+m}f.push(S)}else if(m.indexOf("//")===0){let S=e.protocol+m;f.push(S)}else f.push(m)}}return f}function s(...h){let f=t.getElementsByTagName("meta");for(let p=0;p<f.length;p++){let d=f[p],g=["itemprop","property","name"].map(m=>d.getAttribute(m)).filter(m=>m?h.includes(m):!1);if(g.length&&g){let m=d.getAttribute("content");if(m)return m}}return""}function n(){let h=s("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function i(){return s("description","og:description","twitter:description","keywords")}let o=n(),a=i(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}jo.getWindowMetadata=_2});function fr(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}var $n=ce(()=>{});function Hn(t){return fr(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}var gu=ce(()=>{$n()});var mu,Hp=ce(()=>{mu="2.31.0"});function Kp(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Kp(t.cause,e):e?null:t}var yu,dr,Vo=ce(()=>{Hp();yu={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${mu}`},dr=class t extends Error{constructor(e,r={}){let s=r.cause instanceof t?r.cause.details:r.cause?.message?r.cause.message:r.details,n=r.cause instanceof t&&r.cause.docsPath||r.docsPath,i=yu.getDocsUrl?.({...r,docsPath:n}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...s?[`Details: ${s}`]:[],...yu.version?[`Version: ${yu.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=n,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=mu}walk(e){return Kp(this,e)}}});var Kn,Gp=ce(()=>{Vo();Kn=class extends dr{constructor({size:e,targetSize:r,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}});function Fr(t,{dir:e,size:r=32}={}){return typeof t=="string"?A2(t,{dir:e,size:r}):D2(t,{dir:e,size:r})}function A2(t,{dir:e,size:r=32}={}){if(r===null)return t;let s=t.replace("0x","");if(s.length>r*2)throw new Kn({size:Math.ceil(s.length/2),targetSize:r,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function D2(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Kn({size:t.length,targetSize:r,type:"bytes"});let s=new Uint8Array(r);for(let n=0;n<r;n++){let i=e==="right";s[i?n:r-n-1]=t[i?n:t.length-n-1]}return s}var wu=ce(()=>{Gp()});var $o,Ho,bu=ce(()=>{Vo();$o=class extends dr{constructor({max:e,min:r,signed:s,size:n,value:i}){super(`Number "${i}" is not in safe ${n?`${n*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}},Ho=class extends dr{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}});function Lr(t,{size:e}){if(Hn(t)>e)throw new Ho({givenSize:Hn(t),maxSize:e})}function Ko(t,e={}){let{signed:r}=e;e.size&&Lr(t,{size:e.size});let s=BigInt(t);if(!r)return s;let n=(t.length-2)/2,i=(1n<<BigInt(n)*8n-1n)-1n;return s<=i?s:s-BigInt(`0x${"f".padStart(n*2,"f")}`)-1n}function Wp(t,e={}){return Number(Ko(t,e))}var Go=ce(()=>{bu();gu()});function Gn(t,e={}){return typeof t=="number"||typeof t=="bigint"?Eu(t,e):typeof t=="string"?C2(t,e):typeof t=="boolean"?R2(t,e):Yp(t,e)}function R2(t,e={}){let r=`0x${Number(t)}`;return typeof e.size=="number"?(Lr(r,{size:e.size}),Fr(r,{size:e.size})):r}function Yp(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=T2[t[n]];let s=`0x${r}`;return typeof e.size=="number"?(Lr(s,{size:e.size}),Fr(s,{dir:"right",size:e.size})):s}function Eu(t,e={}){let{signed:r,size:s}=e,n=BigInt(t),i;s?r?i=(1n<<BigInt(s)*8n-1n)-1n:i=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));let o=typeof i=="bigint"&&r?-i-1n:0;if(i&&n>i||n<o){let c=typeof t=="bigint"?"n":"";throw new $o({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:r,size:s,value:`${t}${c}`})}let a=`0x${(r&&n<0?(1n<<BigInt(s*8))+BigInt(n):n).toString(16)}`;return s?Fr(a,{size:s}):a}function C2(t,e={}){let r=O2.encode(t);return Yp(r,e)}var T2,O2,Wo=ce(()=>{bu();wu();Go();T2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));O2=new TextEncoder});function Zp(t,e={}){return typeof t=="number"||typeof t=="bigint"?P2(t,e):typeof t=="boolean"?N2(t,e):fr(t)?Xp(t,e):xu(t,e)}function N2(t,e={}){let r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(Lr(r,{size:e.size}),Fr(r,{size:e.size})):r}function Jp(t){if(t>=pr.zero&&t<=pr.nine)return t-pr.zero;if(t>=pr.A&&t<=pr.F)return t-(pr.A-10);if(t>=pr.a&&t<=pr.f)return t-(pr.a-10)}function Xp(t,e={}){let r=t;e.size&&(Lr(r,{size:e.size}),r=Fr(r,{dir:"right",size:e.size}));let s=r.slice(2);s.length%2&&(s=`0${s}`);let n=s.length/2,i=new Uint8Array(n);for(let o=0,a=0;o<n;o++){let c=Jp(s.charCodeAt(a++)),u=Jp(s.charCodeAt(a++));if(c===void 0||u===void 0)throw new dr(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);i[o]=c*16+u}return i}function P2(t,e){let r=Eu(t,e);return Xp(r)}function xu(t,e={}){let r=B2.encode(t);return typeof e.size=="number"?(Lr(r,{size:e.size}),Fr(r,{dir:"right",size:e.size})):r}var B2,pr,vu=ce(()=>{Vo();$n();wu();Go();Wo();B2=new TextEncoder;pr={zero:48,nine:57,A:65,F:70,a:97,f:102}});function U2(t,e=!1){return e?{h:Number(t&Yo),l:Number(t>>Qp&Yo)}:{h:Number(t>>Qp&Yo)|0,l:Number(t&Yo)|0}}function eg(t,e=!1){let r=t.length,s=new Uint32Array(r),n=new Uint32Array(r);for(let i=0;i<r;i++){let{h:o,l:a}=U2(t[i],e);[s[i],n[i]]=[o,a]}return[s,n]}var Yo,Qp,tg,rg,sg,ng,ig=ce(()=>{Yo=BigInt(4294967295),Qp=BigInt(32);tg=(t,e,r)=>t<<r|e>>>32-r,rg=(t,e,r)=>e<<r|t>>>32-r,sg=(t,e,r)=>e<<r-32|t>>>64-r,ng=(t,e,r)=>t<<r-32|e>>>64-r});var ws,og=ce(()=>{ws=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});function F2(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function bs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Xt(t,...e){if(!F2(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ag(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");bs(t.outputLen),bs(t.blockLen)}function gr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Jo(t,e){Xt(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function cg(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Qt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Zo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function kt(t,e){return t<<32-e|t>>>e}function k2(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function M2(t){for(let e=0;e<t.length;e++)t[e]=k2(t[e]);return t}function q2(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Es(t){return typeof t=="string"&&(t=q2(t)),Xt(t),t}function ug(...t){let e=0;for(let s=0;s<t.length;s++){let n=t[s];Xt(n),e+=n.length}let r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){let i=t[s];r.set(i,n),n+=i.length}return r}function Xo(t){let e=s=>t().update(Es(s)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Qo(t=32){if(ws&&typeof ws.getRandomValues=="function")return ws.getRandomValues(new Uint8Array(t));if(ws&&typeof ws.randomBytes=="function")return Uint8Array.from(ws.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var L2,Iu,kr,Mr=ce(()=>{og();L2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;Iu=L2?t=>t:M2;kr=class{}});function W2(t,e=24){let r=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=lg(u,l,1)^r[a],f=hg(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let n=t[2],i=t[3];for(let o=0;o<24;o++){let a=dg[o],c=lg(n,i,a),u=hg(n,i,a),l=fg[o];n=t[l],i=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=K2[s],t[1]^=G2[s]}Qt(r)}var z2,Wn,j2,V2,$2,H2,fg,dg,pg,gg,K2,G2,lg,hg,Su,Y2,mg,yg=ce(()=>{ig();Mr();z2=BigInt(0),Wn=BigInt(1),j2=BigInt(2),V2=BigInt(7),$2=BigInt(256),H2=BigInt(113),fg=[],dg=[],pg=[];for(let t=0,e=Wn,r=1,s=0;t<24;t++){[r,s]=[s,(2*r+3*s)%5],fg.push(2*(5*s+r)),dg.push((t+1)*(t+2)/2%64);let n=z2;for(let i=0;i<7;i++)e=(e<<Wn^(e>>V2)*H2)%$2,e&j2&&(n^=Wn<<(Wn<<BigInt(i))-Wn);pg.push(n)}gg=eg(pg,!0),K2=gg[0],G2=gg[1],lg=(t,e,r)=>r>32?sg(t,e,r):tg(t,e,r),hg=(t,e,r)=>r>32?ng(t,e,r):rg(t,e,r);Su=class t extends kr{constructor(e,r,s,n=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=s,this.enableXOF=n,this.rounds=i,bs(s),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=cg(this.state)}clone(){return this._cloneInto()}keccak(){Iu(this.state32),W2(this.state32,this.rounds),Iu(this.state32),this.posOut=0,this.pos=0}update(e){gr(this),e=Es(e),Xt(e);let{blockLen:r,state:s}=this,n=e.length;for(let i=0;i<n;){let o=Math.min(r-this.pos,n-i);for(let a=0;a<o;a++)s[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:r,pos:s,blockLen:n}=this;e[s]^=r,r&128&&s===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){gr(this,!1),Xt(e),this.finish();let r=this.state,{blockLen:s}=this;for(let n=0,i=e.length;n<i;){this.posOut>=s&&this.keccak();let o=Math.min(s-this.posOut,i-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return bs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Jo(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Qt(this.state)}_cloneInto(e){let{blockLen:r,suffix:s,outputLen:n,rounds:i,enableXOF:o}=this;return e||(e=new t(r,s,n,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=s,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}},Y2=(t,e,r)=>Xo(()=>new Su(e,t,r)),mg=Y2(1,136,256/8)});function ea(t,e){let r=e||"hex",s=mg(fr(t,{strict:!1})?Zp(t):t);return r==="bytes"?s:Gn(s)}var _u=ce(()=>{yg();$n();vu();Wo()});var ta,wg=ce(()=>{ta=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){let s=this.keys().next().value;s&&this.delete(s)}return this}}});function bg(t,e){if(Au.has(`${t}.${e}`))return Au.get(`${t}.${e}`);let r=e?`${e}${t.toLowerCase()}`:t.substring(2).toLowerCase(),s=ea(xu(r),"bytes"),n=(e?r.substring(`${e}0x`.length):r).split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(s[o>>1]&15)>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());let i=`0x${n.join("")}`;return Au.set(`${t}.${e}`,i),i}var Au,Eg=ce(()=>{vu();_u();wg();Au=new ta(8192)});function J2(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);let n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,u=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+u,a,s)}function vg(t,e,r){return t&e^~t&r}function Ig(t,e,r){return t&e^t&r^e&r}var ra,mr,Sg=ce(()=>{Mr();ra=class extends kr{constructor(e,r,s,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=s,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Zo(this.buffer)}update(e){gr(this),e=Es(e),Xt(e);let{view:r,buffer:s,blockLen:n}=this,i=e.length;for(let o=0;o<i;){let a=Math.min(n-this.pos,i-o);if(a===n){let c=Zo(e);for(;n<=i-o;o+=n)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){gr(this),Jo(e,this),this.finished=!0;let{buffer:r,view:s,blockLen:n,isLE:i}=this,{pos:o}=this;r[o++]=128,Qt(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(s,0),o=0);for(let h=o;h<n;h++)r[h]=0;J2(s,n-8,BigInt(this.length*8),i),this.process(s,0);let a=Zo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:s,length:n,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=n,e.pos=a,n%r&&e.buffer.set(s),e}clone(){return this._cloneInto()}},mr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225])});var Z2,qr,Du,Yn,_g=ce(()=>{Sg();Mr();Z2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qr=new Uint32Array(64),Du=class extends ra{constructor(e=32){super(64,e,8,!1),this.A=mr[0]|0,this.B=mr[1]|0,this.C=mr[2]|0,this.D=mr[3]|0,this.E=mr[4]|0,this.F=mr[5]|0,this.G=mr[6]|0,this.H=mr[7]|0}get(){let{A:e,B:r,C:s,D:n,E:i,F:o,G:a,H:c}=this;return[e,r,s,n,i,o,a,c]}set(e,r,s,n,i,o,a,c){this.A=e|0,this.B=r|0,this.C=s|0,this.D=n|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)qr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){let f=qr[h-15],p=qr[h-2],d=kt(f,7)^kt(f,18)^f>>>3,g=kt(p,17)^kt(p,19)^p>>>10;qr[h]=g+qr[h-7]+d+qr[h-16]|0}let{A:s,B:n,C:i,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){let f=kt(a,6)^kt(a,11)^kt(a,25),p=l+f+vg(a,c,u)+Z2[h]+qr[h]|0,g=(kt(s,2)^kt(s,13)^kt(s,22))+Ig(s,n,i)|0;l=u,u=c,c=a,a=o+p|0,o=i,i=n,n=s,s=p+g|0}s=s+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(s,n,i,o,a,c,u,l)}roundClean(){Qt(qr)}destroy(){this.set(0,0,0,0,0,0,0,0),Qt(this.buffer)}},Yn=Xo(()=>new Du)});var sa,Tu,Ag=ce(()=>{Mr();sa=class extends kr{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,ag(e);let s=Es(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(s.length>n?e.create().update(s).digest():s);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Qt(i)}update(e){return gr(this),this.iHash.update(e),this}digestInto(e){gr(this),Xt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:s,finished:n,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=s._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Tu=(t,e,r)=>new sa(t,e).update(r).digest();Tu.create=(t,e)=>new sa(t,e)});function Xs(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function wr(t){if(!Xs(t))throw new Error("Uint8Array expected")}function Qs(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Jn(t){let e=t.toString(16);return e.length&1?"0"+e:e}function Rg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Bu:BigInt("0x"+t)}function en(t){if(wr(t),Og)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=X2[t[r]];return e}function Dg(t){if(t>=yr._0&&t<=yr._9)return t-yr._0;if(t>=yr.A&&t<=yr.F)return t-(yr.A-10);if(t>=yr.a&&t<=yr.f)return t-(yr.a-10)}function Zn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Og)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let s=new Uint8Array(r);for(let n=0,i=0;n<r;n++,i+=2){let o=Dg(t.charCodeAt(i)),a=Dg(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}s[n]=o*16+a}return s}function ut(t){return Rg(en(t))}function Nu(t){return wr(t),Rg(en(Uint8Array.from(t).reverse()))}function er(t,e){return Zn(t.toString(16).padStart(e*2,"0"))}function Pu(t,e){return er(t,e).reverse()}function _e(t,e,r){let s;if(typeof e=="string")try{s=Zn(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Xs(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let n=s.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return s}function nt(...t){let e=0;for(let s=0;s<t.length;s++){let n=t[s];wr(n),e+=n.length}let r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){let i=t[s];r.set(i,n),n+=i.length}return r}function na(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function xs(t,e,r){return Ru(t)&&Ru(e)&&Ru(r)&&e<=t&&t<r}function br(t,e,r,s){if(!xs(e,r,s))throw new Error("expected valid "+t+": "+r+" <= n < "+s+", got "+e)}function Cg(t){let e;for(e=0;t>Bu;t>>=Cu,e+=1);return e}function Bg(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let s=Ou(t),n=Ou(t),i=0,o=()=>{s.fill(1),n.fill(0),i=0},a=(...h)=>r(n,s,...h),c=(h=Ou(0))=>{n=a(Tg([0]),h),s=a(),h.length!==0&&(n=a(Tg([1]),h),s=a())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,f=[];for(;h<e;){s=a();let p=s.slice();f.push(p),h+=s.length}return nt(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(u()));)c();return o(),p}}function Er(t,e,r={}){let s=(n,i,o)=>{let a=Q2[i];if(typeof a!="function")throw new Error("invalid validator function");let c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+i+", got "+c)};for(let[n,i]of Object.entries(e))s(n,i,!1);for(let[n,i]of Object.entries(r))s(n,i,!0);return t}function Uu(t){let e=new WeakMap;return(r,...s)=>{let n=e.get(r);if(n!==void 0)return n;let i=t(r,...s);return e.set(r,i),i}}var Bu,Cu,Og,X2,yr,Ru,vs,Ou,Tg,Q2,tn=ce(()=>{Bu=BigInt(0),Cu=BigInt(1);Og=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",X2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));yr={_0:48,_9:57,A:65,F:70,a:97,f:102};Ru=t=>typeof t=="bigint"&&Bu<=t;vs=t=>(Cu<<BigInt(t))-Cu,Ou=t=>new Uint8Array(t),Tg=t=>Uint8Array.from(t);Q2={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Xs(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)}});function ve(t,e){let r=t%e;return r>=it?r:e+r}function Et(t,e,r){let s=t;for(;e-- >it;)s*=s,s%=r;return s}function ia(t,e){if(t===it)throw new Error("invert: expected non-zero number");if(e<=it)throw new Error("invert: expected positive modulus, got "+e);let r=ve(t,e),s=e,n=it,i=$e,o=$e,a=it;for(;r!==it;){let u=s/r,l=s%r,h=n-o*u,f=i-a*u;s=r,r=l,n=o,i=a,o=h,a=f}if(s!==$e)throw new Error("invert: does not exist");return ve(n,e)}function Lg(t,e){let r=(t.ORDER+$e)/Pg,s=t.pow(e,r);if(!t.eql(t.sqr(s),e))throw new Error("Cannot find square root");return s}function t3(t,e){let r=(t.ORDER-Ug)/Fg,s=t.mul(e,Is),n=t.pow(s,r),i=t.mul(e,n),o=t.mul(t.mul(i,Is),n),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function r3(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-$e,r=0;for(;e%Is===it;)e/=Is,r++;let s=Is,n=Xn(t);for(;Ng(n,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Lg;let i=n.pow(s,e),o=(e+$e)/Is;return function(c,u){if(c.is0(u))return u;if(Ng(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,i),f=c.pow(u,e),p=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===l)throw new Error("Cannot find square root");let m=$e<<BigInt(l-d-1),S=c.pow(h,m);l=d,h=c.sqr(S),f=c.mul(f,h),p=c.mul(p,S)}return p}}function s3(t){return t%Pg===e3?Lg:t%Fg===Ug?t3:r3(t)}function oa(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=n3.reduce((s,n)=>(s[n]="function",s),e);return Er(t,r)}function i3(t,e,r){if(r<it)throw new Error("invalid exponent, negatives unsupported");if(r===it)return t.ONE;if(r===$e)return e;let s=t.ONE,n=e;for(;r>it;)r&$e&&(s=t.mul(s,n)),n=t.sqr(n),r>>=$e;return s}function rn(t,e,r=!1){let s=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(s[c]=o,t.mul(o,a)),t.ONE),i=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(s[c]=t.mul(o,s[c]),t.mul(o,a)),i),s}function Ng(t,e){let r=(t.ORDER-$e)/Is,s=t.pow(e,r),n=t.eql(s,t.ONE),i=t.eql(s,t.ZERO),o=t.eql(s,t.neg(t.ONE));if(!n&&!i&&!o)throw new Error("invalid Legendre symbol result");return n?1:i?0:-1}function Fu(t,e){e!==void 0&&bs(e);let r=e!==void 0?e:t.toString(2).length,s=Math.ceil(r/8);return{nBitLength:r,nByteLength:s}}function Xn(t,e,r=!1,s={}){if(t<=it)throw new Error("invalid field: expected ORDER > 0, got "+t);let{nBitLength:n,nByteLength:i}=Fu(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:i,MASK:vs(n),ZERO:it,ONE:$e,create:c=>ve(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return it<=c&&c<t},is0:c=>c===it,isOdd:c=>(c&$e)===$e,neg:c=>ve(-c,t),eql:(c,u)=>c===u,sqr:c=>ve(c*c,t),add:(c,u)=>ve(c+u,t),sub:(c,u)=>ve(c-u,t),mul:(c,u)=>ve(c*u,t),pow:(c,u)=>i3(a,c,u),div:(c,u)=>ve(c*ia(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>ia(c,t),sqrt:s.sqrt||(c=>(o||(o=s3(t)),o(a,c))),toBytes:c=>r?Pu(c,i):er(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?Nu(c):ut(c)},invertBatch:c=>rn(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function kg(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Lu(t){let e=kg(t);return e+Math.ceil(e/2)}function Mg(t,e,r=!1){let s=t.length,n=kg(e),i=Lu(e);if(s<16||s<i||s>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+s);let o=r?Nu(t):ut(t),a=ve(o,e-$e)+$e;return r?Pu(a,n):er(a,n)}var it,$e,Is,e3,Pg,Ug,Fg,n3,Qn=ce(()=>{Mr();tn();it=BigInt(0),$e=BigInt(1),Is=BigInt(2),e3=BigInt(3),Pg=BigInt(4),Ug=BigInt(5),Fg=BigInt(8);n3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"]});function ku(t,e){let r=e.negate();return t?r:e}function jg(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Mu(t,e){jg(t,e);let r=Math.ceil(e/t)+1,s=2**(t-1),n=2**t,i=vs(t),o=BigInt(t);return{windows:r,windowSize:s,mask:i,maxNumber:n,shiftBy:o}}function zg(t,e,r){let{windowSize:s,mask:n,maxNumber:i,shiftBy:o}=r,a=Number(t&n),c=t>>o;a>s&&(a-=i,c+=ju);let u=e*s,l=u+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:u}}function o3(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,s)=>{if(!(r instanceof e))throw new Error("invalid point at index "+s)})}function a3(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,s)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+s)})}function zu(t){return Vg.get(t)||1}function $g(t,e){return{constTimeNegate:ku,hasPrecomputes(r){return zu(r)!==1},unsafeLadder(r,s,n=t.ZERO){let i=r;for(;s>qg;)s&ju&&(n=n.add(i)),i=i.double(),s>>=ju;return n},precomputeWindow(r,s){let{windows:n,windowSize:i}=Mu(s,e),o=[],a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,s,n){let i=t.ZERO,o=t.BASE,a=Mu(r,e);for(let c=0;c<a.windows;c++){let{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:d}=zg(n,c,a);n=u,h?o=o.add(ku(p,s[d])):i=i.add(ku(f,s[l]))}return{p:i,f:o}},wNAFUnsafe(r,s,n,i=t.ZERO){let o=Mu(r,e);for(let a=0;a<o.windows&&n!==qg;a++){let{nextN:c,offset:u,isZero:l,isNeg:h}=zg(n,a,o);if(n=c,!l){let f=s[u];i=i.add(h?f.negate():f)}}return i},getPrecomputes(r,s,n){let i=qu.get(s);return i||(i=this.precomputeWindow(s,r),r!==1&&qu.set(s,n(i))),i},wNAFCached(r,s,n){let i=zu(r);return this.wNAF(i,this.getPrecomputes(i,r,n),s)},wNAFCachedUnsafe(r,s,n,i){let o=zu(r);return o===1?this.unsafeLadder(r,s,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),s,i)},setWindowSize(r,s){jg(s,e),Vg.set(r,s),qu.delete(r)}}}function Hg(t,e,r,s){o3(r,t),a3(s,e);let n=r.length,i=s.length;if(n!==i)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=Cg(BigInt(n)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=vs(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,f=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<i;g++){let m=s[g],S=Number(m>>BigInt(p)&u);l[S]=l[S].add(r[g])}let d=o;for(let g=l.length-1,m=o;g>0;g--)m=m.add(l[g]),d=d.add(m);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Vu(t){return oa(t.Fp),Er(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Fu(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}var qg,ju,qu,Vg,Kg=ce(()=>{Qn();tn();qg=BigInt(0),ju=BigInt(1);qu=new WeakMap,Vg=new WeakMap});function Gg(t){t.lowS!==void 0&&Qs("lowS",t.lowS),t.prehash!==void 0&&Qs("prehash",t.prehash)}function c3(t){let e=Vu(t);Er(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:r,Fp:s,a:n}=e;if(r){if(!s.eql(n,s.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}function $u(t,e){return en(er(t,e))}function u3(t){let e=c3(t),{Fp:r}=e,s=Xn(e.n,e.nBitLength),n=e.toBytes||((b,E,v)=>{let O=E.toAffine();return nt(Uint8Array.from([4]),r.toBytes(O.x),r.toBytes(O.y))}),i=e.fromBytes||(b=>{let E=b.subarray(1),v=r.fromBytes(E.subarray(0,r.BYTES)),O=r.fromBytes(E.subarray(r.BYTES,2*r.BYTES));return{x:v,y:O}});function o(b){let{a:E,b:v}=e,O=r.sqr(b),P=r.mul(O,b);return r.add(r.add(P,r.mul(b,E)),v)}function a(b,E){let v=r.sqr(E),O=o(b);return r.eql(v,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let c=r.mul(r.pow(e.a,ei),Ku),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(b){return xs(b,le,e.n)}function h(b){let{allowedPrivateKeyLengths:E,nByteLength:v,wrapPrivateKey:O,n:P}=e;if(E&&typeof b!="bigint"){if(Xs(b)&&(b=en(b)),typeof b!="string"||!E.includes(b.length))throw new Error("invalid private key");b=b.padStart(v*2,"0")}let N;try{N=typeof b=="bigint"?b:ut(_e("private key",b,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof b)}return O&&(N=ve(N,P)),br("private key",N,le,P),N}function f(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}let p=Uu((b,E)=>{let{px:v,py:O,pz:P}=b;if(r.eql(P,r.ONE))return{x:v,y:O};let N=b.is0();E==null&&(E=N?r.ONE:r.inv(P));let w=r.mul(v,E),C=r.mul(O,E),_=r.mul(P,E);if(N)return{x:r.ZERO,y:r.ZERO};if(!r.eql(_,r.ONE))throw new Error("invZ was invalid");return{x:w,y:C}}),d=Uu(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}let{x:E,y:v}=b.toAffine();if(!r.isValid(E)||!r.isValid(v))throw new Error("bad point: x or y not FE");if(!a(E,v))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(E,v,O){if(E==null||!r.isValid(E))throw new Error("x required");if(v==null||!r.isValid(v)||r.is0(v))throw new Error("y required");if(O==null||!r.isValid(O))throw new Error("z required");this.px=E,this.py=v,this.pz=O,Object.freeze(this)}static fromAffine(E){let{x:v,y:O}=E||{};if(!E||!r.isValid(v)||!r.isValid(O))throw new Error("invalid affine point");if(E instanceof g)throw new Error("projective point not allowed");let P=N=>r.eql(N,r.ZERO);return P(v)&&P(O)?g.ZERO:new g(v,O,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(E){let v=rn(r,E.map(O=>O.pz));return E.map((O,P)=>O.toAffine(v[P])).map(g.fromAffine)}static fromHex(E){let v=g.fromAffine(i(_e("pointHex",E)));return v.assertValidity(),v}static fromPrivateKey(E){return g.BASE.multiply(h(E))}static msm(E,v){return Hg(g,s,E,v)}_setWindowSize(E){A.setWindowSize(this,E)}assertValidity(){d(this)}hasEvenY(){let{y:E}=this.toAffine();if(r.isOdd)return!r.isOdd(E);throw new Error("Field doesn't support isOdd")}equals(E){f(E);let{px:v,py:O,pz:P}=this,{px:N,py:w,pz:C}=E,_=r.eql(r.mul(v,C),r.mul(N,P)),T=r.eql(r.mul(O,C),r.mul(w,P));return _&&T}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){let{a:E,b:v}=e,O=r.mul(v,ei),{px:P,py:N,pz:w}=this,C=r.ZERO,_=r.ZERO,T=r.ZERO,B=r.mul(P,P),L=r.mul(N,N),x=r.mul(w,w),y=r.mul(P,N);return y=r.add(y,y),T=r.mul(P,w),T=r.add(T,T),C=r.mul(E,T),_=r.mul(O,x),_=r.add(C,_),C=r.sub(L,_),_=r.add(L,_),_=r.mul(C,_),C=r.mul(y,C),T=r.mul(O,T),x=r.mul(E,x),y=r.sub(B,x),y=r.mul(E,y),y=r.add(y,T),T=r.add(B,B),B=r.add(T,B),B=r.add(B,x),B=r.mul(B,y),_=r.add(_,B),x=r.mul(N,w),x=r.add(x,x),B=r.mul(x,y),C=r.sub(C,B),T=r.mul(x,L),T=r.add(T,T),T=r.add(T,T),new g(C,_,T)}add(E){f(E);let{px:v,py:O,pz:P}=this,{px:N,py:w,pz:C}=E,_=r.ZERO,T=r.ZERO,B=r.ZERO,L=e.a,x=r.mul(e.b,ei),y=r.mul(v,N),I=r.mul(O,w),R=r.mul(P,C),D=r.add(v,O),U=r.add(N,w);D=r.mul(D,U),U=r.add(y,I),D=r.sub(D,U),U=r.add(v,P);let F=r.add(N,C);return U=r.mul(U,F),F=r.add(y,R),U=r.sub(U,F),F=r.add(O,P),_=r.add(w,C),F=r.mul(F,_),_=r.add(I,R),F=r.sub(F,_),B=r.mul(L,U),_=r.mul(x,R),B=r.add(_,B),_=r.sub(I,B),B=r.add(I,B),T=r.mul(_,B),I=r.add(y,y),I=r.add(I,y),R=r.mul(L,R),U=r.mul(x,U),I=r.add(I,R),R=r.sub(y,R),R=r.mul(L,R),U=r.add(U,R),y=r.mul(I,U),T=r.add(T,y),y=r.mul(F,U),_=r.mul(D,_),_=r.sub(_,y),y=r.mul(D,I),B=r.mul(F,B),B=r.add(B,y),new g(_,T,B)}subtract(E){return this.add(E.negate())}is0(){return this.equals(g.ZERO)}wNAF(E){return A.wNAFCached(this,E,g.normalizeZ)}multiplyUnsafe(E){let{endo:v,n:O}=e;br("scalar",E,Mt,O);let P=g.ZERO;if(E===Mt)return P;if(this.is0()||E===le)return this;if(!v||A.hasPrecomputes(this))return A.wNAFCachedUnsafe(this,E,g.normalizeZ);let{k1neg:N,k1:w,k2neg:C,k2:_}=v.splitScalar(E),T=P,B=P,L=this;for(;w>Mt||_>Mt;)w&le&&(T=T.add(L)),_&le&&(B=B.add(L)),L=L.double(),w>>=le,_>>=le;return N&&(T=T.negate()),C&&(B=B.negate()),B=new g(r.mul(B.px,v.beta),B.py,B.pz),T.add(B)}multiply(E){let{endo:v,n:O}=e;br("scalar",E,le,O);let P,N;if(v){let{k1neg:w,k1:C,k2neg:_,k2:T}=v.splitScalar(E),{p:B,f:L}=this.wNAF(C),{p:x,f:y}=this.wNAF(T);B=A.constTimeNegate(w,B),x=A.constTimeNegate(_,x),x=new g(r.mul(x.px,v.beta),x.py,x.pz),P=B.add(x),N=L.add(y)}else{let{p:w,f:C}=this.wNAF(E);P=w,N=C}return g.normalizeZ([P,N])[0]}multiplyAndAddUnsafe(E,v,O){let P=g.BASE,N=(C,_)=>_===Mt||_===le||!C.equals(P)?C.multiplyUnsafe(_):C.multiply(_),w=N(this,v).add(N(E,O));return w.is0()?void 0:w}toAffine(E){return p(this,E)}isTorsionFree(){let{h:E,isTorsionFree:v}=e;if(E===le)return!0;if(v)return v(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:E,clearCofactor:v}=e;return E===le?this:v?v(g,this):this.multiplyUnsafe(e.h)}toRawBytes(E=!0){return Qs("isCompressed",E),this.assertValidity(),n(g,this,E)}toHex(E=!0){return Qs("isCompressed",E),en(this.toRawBytes(E))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);let{endo:m,nBitLength:S}=e,A=$g(g,m?Math.ceil(S/2):S);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function l3(t){let e=Vu(t);return Er(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Wg(t){let e=l3(t),{Fp:r,n:s,nByteLength:n,nBitLength:i}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(x){return ve(x,s)}function u(x){return ia(x,s)}let{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=u3({...e,toBytes(x,y,I){let R=y.toAffine(),D=r.toBytes(R.x),U=nt;return Qs("isCompressed",I),I?U(Uint8Array.from([y.hasEvenY()?2:3]),D):U(Uint8Array.from([4]),D,r.toBytes(R.y))},fromBytes(x){let y=x.length,I=x[0],R=x.subarray(1);if(y===o&&(I===2||I===3)){let D=ut(R);if(!xs(D,le,r.ORDER))throw new Error("Point is not on curve");let U=f(D),F;try{F=r.sqrt(U)}catch($){let H=$ instanceof Error?": "+$.message:"";throw new Error("Point is not on curve"+H)}let M=(F&le)===le;return(I&1)===1!==M&&(F=r.neg(F)),{x:D,y:F}}else if(y===a&&I===4){let D=r.fromBytes(R.subarray(0,r.BYTES)),U=r.fromBytes(R.subarray(r.BYTES,2*r.BYTES));return{x:D,y:U}}else{let D=o,U=a;throw new Error("invalid Point, expected length of "+D+", or uncompressed "+U+", got "+y)}}});function d(x){let y=s>>le;return x>y}function g(x){return d(x)?c(-x):x}let m=(x,y,I)=>ut(x.slice(y,I));class S{constructor(y,I,R){br("r",y,le,s),br("s",I,le,s),this.r=y,this.s=I,R!=null&&(this.recovery=R),Object.freeze(this)}static fromCompact(y){let I=n;return y=_e("compactSignature",y,I*2),new S(m(y,0,I),m(y,I,2*I))}static fromDER(y){let{r:I,s:R}=xr.toSig(_e("DER",y));return new S(I,R)}assertValidity(){}addRecoveryBit(y){return new S(this.r,this.s,y)}recoverPublicKey(y){let{r:I,s:R,recovery:D}=this,U=P(_e("msgHash",y));if(D==null||![0,1,2,3].includes(D))throw new Error("recovery id invalid");let F=D===2||D===3?I+e.n:I;if(F>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");let M=D&1?"03":"02",j=l.fromHex(M+$u(F,r.BYTES)),$=u(F),H=c(-U*$),G=c(R*$),Z=l.BASE.multiplyAndAddUnsafe(j,H,G);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new S(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Zn(this.toDERHex())}toDERHex(){return xr.hexFromSig(this)}toCompactRawBytes(){return Zn(this.toCompactHex())}toCompactHex(){let y=n;return $u(this.r,y)+$u(this.s,y)}}let A={isValidPrivateKey(x){try{return h(x),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{let x=Lu(e.n);return Mg(e.randomBytes(x),e.n)},precompute(x=8,y=l.BASE){return y._setWindowSize(x),y.multiply(BigInt(3)),y}};function b(x,y=!0){return l.fromPrivateKey(x).toRawBytes(y)}function E(x){if(typeof x=="bigint")return!1;if(x instanceof l)return!0;let I=_e("key",x).length,R=r.BYTES,D=R+1,U=2*R+1;if(!(e.allowedPrivateKeyLengths||n===D))return I===D||I===U}function v(x,y,I=!0){if(E(x)===!0)throw new Error("first arg must be private key");if(E(y)===!1)throw new Error("second arg must be public key");return l.fromHex(y).multiply(h(x)).toRawBytes(I)}let O=e.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");let y=ut(x),I=x.length*8-i;return I>0?y>>BigInt(I):y},P=e.bits2int_modN||function(x){return c(O(x))},N=vs(i);function w(x){return br("num < 2^"+i,x,Mt,N),er(x,n)}function C(x,y,I=_){if(["recovered","canonical"].some(W=>W in I))throw new Error("sign() legacy options not supported");let{hash:R,randomBytes:D}=e,{lowS:U,prehash:F,extraEntropy:M}=I;U==null&&(U=!0),x=_e("msgHash",x),Gg(I),F&&(x=_e("prehashed msgHash",R(x)));let j=P(x),$=h(y),H=[w($),w(j)];if(M!=null&&M!==!1){let W=M===!0?D(r.BYTES):M;H.push(_e("extraEntropy",W))}let G=nt(...H),Z=j;function Q(W){let ae=O(W);if(!p(ae))return;let Ee=u(ae),wt=l.BASE.multiply(ae).toAffine(),At=c(wt.x);if(At===Mt)return;let Dt=c(Ee*c(Z+At*$));if(Dt===Mt)return;let Wt=(wt.x===At?0:2)|Number(wt.y&le),Zi=Dt;return U&&d(Dt)&&(Zi=g(Dt),Wt^=1),new S(At,Zi,Wt)}return{seed:G,k2sig:Q}}let _={lowS:e.lowS,prehash:!1},T={lowS:e.lowS,prehash:!1};function B(x,y,I=_){let{seed:R,k2sig:D}=C(x,y,I),U=e;return Bg(U.hash.outputLen,U.nByteLength,U.hmac)(R,D)}l.BASE._setWindowSize(8);function L(x,y,I,R=T){let D=x;y=_e("msgHash",y),I=_e("publicKey",I);let{lowS:U,prehash:F,format:M}=R;if(Gg(R),"strict"in R)throw new Error("options.strict was renamed to lowS");if(M!==void 0&&M!=="compact"&&M!=="der")throw new Error("format must be compact or der");let j=typeof D=="string"||Xs(D),$=!j&&!M&&typeof D=="object"&&D!==null&&typeof D.r=="bigint"&&typeof D.s=="bigint";if(!j&&!$)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let H,G;try{if($&&(H=new S(D.r,D.s)),j){try{M!=="compact"&&(H=S.fromDER(D))}catch(Wt){if(!(Wt instanceof xr.Err))throw Wt}!H&&M!=="der"&&(H=S.fromCompact(D))}G=l.fromHex(I)}catch{return!1}if(!H||U&&H.hasHighS())return!1;F&&(y=e.hash(y));let{r:Z,s:Q}=H,W=P(y),ae=u(Q),Ee=c(W*ae),wt=c(Z*ae),At=l.BASE.multiplyAndAddUnsafe(G,Ee,wt)?.toAffine();return At?c(At.x)===Z:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:v,sign:B,verify:L,ProjectivePoint:l,Signature:S,utils:A}}function h3(t,e){let r=t.ORDER,s=Mt;for(let d=r-le;d%zr===Mt;d/=zr)s+=le;let n=s,i=zr<<n-le-le,o=i*zr,a=(r-le)/o,c=(a-le)/zr,u=o-le,l=i,h=t.pow(e,a),f=t.pow(e,(a+le)/zr),p=(d,g)=>{let m=h,S=t.pow(g,u),A=t.sqr(S);A=t.mul(A,g);let b=t.mul(d,A);b=t.pow(b,c),b=t.mul(b,S),S=t.mul(b,g),A=t.mul(b,d);let E=t.mul(A,S);b=t.pow(E,l);let v=t.eql(b,t.ONE);S=t.mul(A,f),b=t.mul(E,m),A=t.cmov(S,A,v),E=t.cmov(b,E,v);for(let O=n;O>le;O--){let P=O-zr;P=zr<<P-le;let N=t.pow(E,P),w=t.eql(N,t.ONE);S=t.mul(A,m),m=t.mul(m,m),N=t.mul(E,m),A=t.cmov(S,A,w),E=t.cmov(N,E,w)}return{isValid:v,value:A}};if(t.ORDER%Ku===ei){let d=(t.ORDER-ei)/Ku,g=t.sqrt(t.neg(e));p=(m,S)=>{let A=t.sqr(S),b=t.mul(m,S);A=t.mul(A,b);let E=t.pow(A,d);E=t.mul(E,b);let v=t.mul(E,g),O=t.mul(t.sqr(E),S),P=t.eql(O,m),N=t.cmov(v,E,P);return{isValid:P,value:N}}}return p}function Yg(t,e){if(oa(t),!t.isValid(e.A)||!t.isValid(e.B)||!t.isValid(e.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");let r=h3(t,e.Z);if(!t.isOdd)throw new Error("Fp.isOdd is not implemented!");return s=>{let n,i,o,a,c,u,l,h;n=t.sqr(s),n=t.mul(n,e.Z),i=t.sqr(n),i=t.add(i,n),o=t.add(i,t.ONE),o=t.mul(o,e.B),a=t.cmov(e.Z,t.neg(i),!t.eql(i,t.ZERO)),a=t.mul(a,e.A),i=t.sqr(o),u=t.sqr(a),c=t.mul(u,e.A),i=t.add(i,c),i=t.mul(i,o),u=t.mul(u,a),c=t.mul(u,e.B),i=t.add(i,c),l=t.mul(n,o);let{isValid:f,value:p}=r(i,u);h=t.mul(n,s),h=t.mul(h,p),l=t.cmov(l,o,f),h=t.cmov(h,p,f);let d=t.isOdd(s)===t.isOdd(h);h=t.cmov(t.neg(h),h,d);let g=rn(t,[a],!0)[0];return l=t.mul(l,g),{x:l,y:h}}}var Hu,xr,Mt,le,zr,ei,Ku,Gu=ce(()=>{Kg();Qn();tn();Hu=class extends Error{constructor(e=""){super(e)}},xr={Err:Hu,_tlv:{encode:(t,e)=>{let{Err:r}=xr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");let s=e.length/2,n=Jn(s);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let i=s>127?Jn(n.length/2|128):"";return Jn(t)+i+n+e},decode(t,e){let{Err:r}=xr,s=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[s++]!==t)throw new r("tlv.decode: wrong tlv");let n=e[s++],i=!!(n&128),o=0;if(!i)o=n;else{let c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=e.subarray(s,s+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of u)o=o<<8|l;if(s+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}let a=e.subarray(s,s+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(s+o)}}},_int:{encode(t){let{Err:e}=xr;if(t<Mt)throw new e("integer: negative integers are not allowed");let r=Jn(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=xr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ut(t)}},toSig(t){let{Err:e,_int:r,_tlv:s}=xr,n=_e("signature",t),{v:i,l:o}=s.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=s.decode(2,i),{v:u,l}=s.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){let{_tlv:e,_int:r}=xr,s=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),i=s+n;return e.encode(48,i)}};Mt=BigInt(0),le=BigInt(1),zr=BigInt(2),ei=BigInt(3),Ku=BigInt(4)});function f3(t){return{hash:t,hmac:(e,...r)=>Tu(t,e,ug(...r)),randomBytes:Qo}}function Jg(t,e){let r=s=>Wg({...t,...f3(s)});return{...r(e),create:r}}var Zg=ce(()=>{Ag();Mr();Gu();});function jr(t,e){if(ti(t),ti(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);let r=Array.from({length:e}).fill(0);for(let s=e-1;s>=0;s--)r[s]=t&255,t>>>=8;return new Uint8Array(r)}function p3(t,e){let r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t[s]^e[s];return r}function ti(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function g3(t,e,r,s){wr(t),wr(e),ti(r),e.length>255&&(e=s(nt(na("H2C-OVERSIZE-DST-"),e)));let{outputLen:n,blockLen:i}=s,o=Math.ceil(r/n);if(r>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");let a=nt(e,jr(e.length,1)),c=jr(0,i),u=jr(r,2),l=new Array(o),h=s(nt(c,t,u,jr(0,1),a));l[0]=s(nt(h,jr(1,1),a));for(let p=1;p<=o;p++){let d=[p3(h,l[p-1]),jr(p+1,1),a];l[p]=s(nt(...d))}return nt(...l).slice(0,r)}function m3(t,e,r,s,n){if(wr(t),wr(e),ti(r),e.length>255){let i=Math.ceil(2*s/8);e=n.create({dkLen:i}).update(na("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return n.create({dkLen:r}).update(t).update(jr(r,2)).update(e).update(jr(e.length,1)).digest()}function Xg(t,e,r){Er(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});let{p:s,k:n,m:i,hash:o,expand:a,DST:c}=r;wr(t),ti(e);let u=typeof c=="string"?na(c):c,l=s.toString(2).length,h=Math.ceil((l+n)/8),f=e*i*h,p;if(a==="xmd")p=g3(t,u,f,o);else if(a==="xof")p=m3(t,u,f,n,o);else if(a==="_internal_pass")p=t;else throw new Error('expand must be "xmd" or "xof"');let d=new Array(e);for(let g=0;g<e;g++){let m=new Array(i);for(let S=0;S<i;S++){let A=h*(S+g*i),b=p.subarray(A,A+h);m[S]=ve(d3(b),s)}d[g]=m}return d}function Qg(t,e){let r=e.map(s=>Array.from(s).reverse());return(s,n)=>{let[i,o,a,c]=r.map(h=>h.reduce((f,p)=>t.add(t.mul(f,s),p))),[u,l]=rn(t,[o,c],!0);return s=t.mul(i,u),n=t.mul(n,t.mul(a,l)),{x:s,y:n}}}function e0(t,e,r){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function s(i){return t.fromAffine(e(i))}function n(i){let o=i.clearCofactor();return o.equals(t.ZERO)?t.ZERO:(o.assertValidity(),o)}return{defaults:r,hashToCurve(i,o){let a=Xg(i,2,{...r,DST:r.DST,...o}),c=s(a[0]),u=s(a[1]);return n(c.add(u))},encodeToCurve(i,o){let a=Xg(i,1,{...r,DST:r.encodeDST,...o});return n(s(a[0]))},mapToCurve(i){if(!Array.isArray(i))throw new Error("expected array of bigints");for(let o of i)if(typeof o!="bigint")throw new Error("expected array of bigints");return n(s(i))}}}var d3,t0=ce(()=>{Qn();tn();d3=ut});var c0={};Ne(c0,{encodeToCurve:()=>S3,hashToCurve:()=>I3,schnorr:()=>E3,secp256k1:()=>ii,secp256k1_hasher:()=>el});function n0(t){let e=ni,r=BigInt(3),s=BigInt(6),n=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=Et(l,r,e)*l%e,f=Et(h,r,e)*l%e,p=Et(f,ca,e)*u%e,d=Et(p,n,e)*p%e,g=Et(d,i,e)*d%e,m=Et(g,a,e)*g%e,S=Et(m,c,e)*m%e,A=Et(S,a,e)*g%e,b=Et(A,r,e)*l%e,E=Et(b,o,e)*d%e,v=Et(E,s,e)*u%e,O=Et(v,ca,e);if(!Vr.eql(Vr.sqr(O),t))throw new Error("Cannot find square root");return O}function ua(t,...e){let r=s0[t];if(r===void 0){let s=Yn(Uint8Array.from(t,n=>n.charCodeAt(0)));r=nt(s,s),s0[t]=r}return Yn(nt(r,...e))}function Ju(t){let e=ii.utils.normPrivateKeyToScalar(t),r=Qu.fromPrivateKey(e);return{scalar:r.hasEvenY()?e:si(-e),bytes:Xu(r)}}function i0(t){br("x",t,ri,ni);let e=Wu(t*t),r=Wu(e*t+BigInt(7)),s=n0(r);s%ca!==Zu&&(s=Wu(-s));let n=new Qu(t,s,ri);return n.assertValidity(),n}function o0(...t){return si(sn(ua("BIP0340/challenge",...t)))}function w3(t){return Ju(t).bytes}function b3(t,e,r=Qo(32)){let s=_e("message",t),{bytes:n,scalar:i}=Ju(e),o=_e("auxRand",r,32),a=Yu(i^sn(ua("BIP0340/aux",o))),c=ua("BIP0340/nonce",a,n,s),u=si(sn(c));if(u===Zu)throw new Error("sign failed: k is zero");let{bytes:l,scalar:h}=Ju(u),f=o0(l,n,s),p=new Uint8Array(64);if(p.set(l,0),p.set(Yu(si(h+f*i)),32),!a0(p,s,n))throw new Error("sign: Invalid signature produced");return p}function a0(t,e,r){let s=_e("signature",t,64),n=_e("message",e),i=_e("publicKey",r,32);try{let o=i0(sn(i)),a=sn(s.subarray(0,32));if(!xs(a,ri,ni))return!1;let c=sn(s.subarray(32,64));if(!xs(c,ri,aa))return!1;let u=o0(Yu(a),Xu(o),n),l=y3(o,c,si(-u));return!(!l||!l.hasEvenY()||l.toAffine().x!==a)}catch{return!1}}var ni,aa,Zu,ri,ca,r0,Vr,ii,s0,Xu,Yu,Wu,si,Qu,y3,sn,E3,x3,v3,el,I3,S3,u0=ce(()=>{_g();Mr();Zg();t0();Qn();tn();Gu();ni=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),aa=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Zu=BigInt(0),ri=BigInt(1),ca=BigInt(2),r0=(t,e)=>(t+e/ca)/e;Vr=Xn(ni,void 0,void 0,{sqrt:n0}),ii=Jg({a:Zu,b:BigInt(7),Fp:Vr,n:aa,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=aa,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-ri*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=r0(i*t,e),c=r0(-s*t,e),u=ve(t-a*r-c*n,e),l=ve(-a*s-c*i,e),h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},Yn),s0={};Xu=t=>t.toRawBytes(!0).slice(1),Yu=t=>er(t,32),Wu=t=>ve(t,ni),si=t=>ve(t,aa),Qu=ii.ProjectivePoint,y3=(t,e,r)=>Qu.BASE.multiplyAndAddUnsafe(t,e,r);sn=ut;E3={getPublicKey:w3,sign:b3,verify:a0,utils:{randomPrivateKey:ii.utils.randomPrivateKey,lift_x:i0,pointToBytes:Xu,numberToBytesBE:er,bytesToNumberBE:ut,taggedHash:ua,mod:ve}},x3=Qg(Vr,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),v3=Yg(Vr,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:Vr.create(BigInt("-11"))}),el=e0(ii.ProjectivePoint,t=>{let{x:e,y:r}=v3(Vr.create(t[0]));return x3(e,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:Vr.ORDER,m:1,k:128,expand:"xmd",hash:Yn}),I3=el.hashToCurve,S3=el.encodeToCurve});var Bl=me((iB,K0)=>{var pI="Input must be an string, Buffer or Uint8Array";function gI(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(pI);return e}function mI(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function Sa(t){return(4294967296+t).toString(16).substring(1)}function yI(t,e,r){let s=`
`+t+" = ";for(let n=0;n<e.length;n+=2){if(r===32)s+=Sa(e[n]).toUpperCase(),s+=" ",s+=Sa(e[n+1]).toUpperCase();else if(r===64)s+=Sa(e[n+1]).toUpperCase(),s+=Sa(e[n]).toUpperCase();else throw new Error("Invalid size "+r);n%6===4?s+=`
`+new Array(t.length+4).join(" "):n<e.length-2&&(s+=" ")}console.log(s)}function wI(t,e,r){let s=new Date().getTime(),n=new Uint8Array(e);for(let o=0;o<e;o++)n[o]=o%256;let i=new Date().getTime();console.log("Generated random input in "+(i-s)+"ms"),s=i;for(let o=0;o<r;o++){let a=t(n),c=new Date().getTime(),u=c-s;s=c,console.log("Hashed in "+u+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}K0.exports={normalizeInput:gI,toHex:mI,debugPrint:yI,testSpeed:wI}});var tm=me((oB,em)=>{var Aa=Bl();function _a(t,e,r){let s=t[e]+t[r],n=t[e+1]+t[r+1];s>=4294967296&&n++,t[e]=s,t[e+1]=n}function G0(t,e,r,s){let n=t[e]+r;r<0&&(n+=4294967296);let i=t[e+1]+s;n>=4294967296&&i++,t[e]=n,t[e+1]=i}function W0(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Kr(t,e,r,s,n,i){let o=gi[n],a=gi[n+1],c=gi[i],u=gi[i+1];_a(Y,t,e),G0(Y,t,o,a);let l=Y[s]^Y[t],h=Y[s+1]^Y[t+1];Y[s]=h,Y[s+1]=l,_a(Y,r,s),l=Y[e]^Y[r],h=Y[e+1]^Y[r+1],Y[e]=l>>>24^h<<8,Y[e+1]=h>>>24^l<<8,_a(Y,t,e),G0(Y,t,c,u),l=Y[s]^Y[t],h=Y[s+1]^Y[t+1],Y[s]=l>>>16^h<<16,Y[s+1]=h>>>16^l<<16,_a(Y,r,s),l=Y[e]^Y[r],h=Y[e+1]^Y[r+1],Y[e]=h>>>31^l<<1,Y[e+1]=l>>>31^h<<1}var Y0=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),bI=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],He=new Uint8Array(bI.map(function(t){return t*2})),Y=new Uint32Array(32),gi=new Uint32Array(32);function J0(t,e){let r=0;for(r=0;r<16;r++)Y[r]=t.h[r],Y[r+16]=Y0[r];for(Y[24]=Y[24]^t.t,Y[25]=Y[25]^t.t/4294967296,e&&(Y[28]=~Y[28],Y[29]=~Y[29]),r=0;r<32;r++)gi[r]=W0(t.b,4*r);for(r=0;r<12;r++)Kr(0,8,16,24,He[r*16+0],He[r*16+1]),Kr(2,10,18,26,He[r*16+2],He[r*16+3]),Kr(4,12,20,28,He[r*16+4],He[r*16+5]),Kr(6,14,22,30,He[r*16+6],He[r*16+7]),Kr(0,10,20,30,He[r*16+8],He[r*16+9]),Kr(2,12,22,24,He[r*16+10],He[r*16+11]),Kr(4,14,16,26,He[r*16+12],He[r*16+13]),Kr(6,8,18,28,He[r*16+14],He[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^Y[r]^Y[r+16]}var Gr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Z0(t,e,r,s){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(s&&s.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");let n={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};Gr.fill(0),Gr[0]=t,e&&(Gr[1]=e.length),Gr[2]=1,Gr[3]=1,r&&Gr.set(r,32),s&&Gr.set(s,48);for(let i=0;i<16;i++)n.h[i]=Y0[i]^W0(Gr,i*4);return e&&(Nl(n,e),n.c=128),n}function Nl(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,J0(t,!1),t.c=0),t.b[t.c++]=e[r]}function X0(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;J0(t,!0);let e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function Q0(t,e,r,s,n){r=r||64,t=Aa.normalizeInput(t),s&&(s=Aa.normalizeInput(s)),n&&(n=Aa.normalizeInput(n));let i=Z0(r,e,s,n);return Nl(i,t),X0(i)}function EI(t,e,r,s,n){let i=Q0(t,e,r,s,n);return Aa.toHex(i)}em.exports={blake2b:Q0,blake2bHex:EI,blake2bInit:Z0,blake2bUpdate:Nl,blake2bFinal:X0}});var um=me((aB,cm)=>{var rm=Bl();function xI(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Wr(t,e,r,s,n,i){re[t]=re[t]+re[e]+n,re[s]=Da(re[s]^re[t],16),re[r]=re[r]+re[s],re[e]=Da(re[e]^re[r],12),re[t]=re[t]+re[e]+i,re[s]=Da(re[s]^re[t],8),re[r]=re[r]+re[s],re[e]=Da(re[e]^re[r],7)}function Da(t,e){return t>>>e^t<<32-e}var sm=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ke=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),re=new Uint32Array(16),Le=new Uint32Array(16);function nm(t,e){let r=0;for(r=0;r<8;r++)re[r]=t.h[r],re[r+8]=sm[r];for(re[12]^=t.t,re[13]^=t.t/4294967296,e&&(re[14]=~re[14]),r=0;r<16;r++)Le[r]=xI(t.b,4*r);for(r=0;r<10;r++)Wr(0,4,8,12,Le[Ke[r*16+0]],Le[Ke[r*16+1]]),Wr(1,5,9,13,Le[Ke[r*16+2]],Le[Ke[r*16+3]]),Wr(2,6,10,14,Le[Ke[r*16+4]],Le[Ke[r*16+5]]),Wr(3,7,11,15,Le[Ke[r*16+6]],Le[Ke[r*16+7]]),Wr(0,5,10,15,Le[Ke[r*16+8]],Le[Ke[r*16+9]]),Wr(1,6,11,12,Le[Ke[r*16+10]],Le[Ke[r*16+11]]),Wr(2,7,8,13,Le[Ke[r*16+12]],Le[Ke[r*16+13]]),Wr(3,4,9,14,Le[Ke[r*16+14]],Le[Ke[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=re[r]^re[r+8]}function im(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");let r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");let s={h:new Uint32Array(sm),b:new Uint8Array(64),c:0,t:0,outlen:t};return s.h[0]^=16842752^r<<8^t,r>0&&(Pl(s,e),s.c=64),s}function Pl(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,nm(t,!1),t.c=0),t.b[t.c++]=e[r]}function om(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;nm(t,!0);let e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function am(t,e,r){r=r||32,t=rm.normalizeInput(t);let s=im(r,e);return Pl(s,t),om(s)}function vI(t,e,r){let s=am(t,e,r);return rm.toHex(s)}cm.exports={blake2s:am,blake2sHex:vI,blake2sInit:im,blake2sUpdate:Pl,blake2sFinal:om}});var hm=me((cB,lm)=>{var mi=tm(),yi=um();lm.exports={blake2b:mi.blake2b,blake2bHex:mi.blake2bHex,blake2bInit:mi.blake2bInit,blake2bUpdate:mi.blake2bUpdate,blake2bFinal:mi.blake2bFinal,blake2s:yi.blake2s,blake2sHex:yi.blake2sHex,blake2sInit:yi.blake2sInit,blake2sUpdate:yi.blake2sUpdate,blake2sFinal:yi.blake2sFinal}});var Tw=me(us=>{"use strict";Object.defineProperty(us,"__esModule",{value:!0});us.isBrowserCryptoAvailable=us.getSubtleCrypto=us.getBrowerCrypto=void 0;function Vh(){return(global==null?void 0:global.crypto)||(global==null?void 0:global.msCrypto)||{}}us.getBrowerCrypto=Vh;function Dw(){let t=Vh();return t.subtle||t.webkitSubtle}us.getSubtleCrypto=Dw;function H6(){return!!Vh()&&!!Dw()}us.isBrowserCryptoAvailable=H6});var Cw=me(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.isBrowser=ls.isNode=ls.isReactNative=void 0;function Rw(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}ls.isReactNative=Rw;function Ow(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}ls.isNode=Ow;function K6(){return!Rw()&&!Ow()}ls.isBrowser=K6});var $h=me(rc=>{"use strict";Object.defineProperty(rc,"__esModule",{value:!0});var Bw=(js(),Ms(zs));Bw.__exportStar(Tw(),rc);Bw.__exportStar(Cw(),rc)});var Mw=me(($B,kw)=>{"use strict";kw.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var j5={};Ne(j5,{default:()=>z5});var Cr=De(ps());var wd=De(ps()),uo=De(Ks());var Ft=class{};var Ic=class extends Ft{constructor(e){super()}},yd=uo.FIVE_SECONDS,Nr={pulse:"heartbeat_pulse"},co=class t extends Ic{constructor(e){super(e),this.events=new wd.EventEmitter,this.interval=yd,this.interval=e?.interval||yd}static async init(e){let r=new t(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,uo.toMiliseconds)(this.interval))}pulse(){this.events.emit(Nr.pulse)}};var v1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,I1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,S1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function _1(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){A1(t);return}return e}function A1(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Bn(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);let r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!S1.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(v1.test(t)||I1.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,_1)}return JSON.parse(t)}catch(s){if(e.strict)throw s;return t}}function D1(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Te(t,...e){try{return D1(t(...e))}catch(r){return Promise.reject(r)}}function T1(t){let e=typeof t;return t===null||e!=="object"&&e!=="function"}function R1(t){let e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Nn(t){if(T1(t))return String(t);if(R1(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Nn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}var Sc="base64:";function bd(t){return typeof t=="string"?t:Sc+C1(t)}function Ed(t){return typeof t!="string"||!t.startsWith(Sc)?t:O1(t.slice(Sc.length))}function O1(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function C1(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function st(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function xd(...t){return st(t.join(":"))}function Pn(t){return t=st(t),t?t+":":""}function vd(t,e){if(e===void 0)return!0;let r=0,s=t.indexOf(":");for(;s>-1;)r++,s=t.indexOf(":",s+1);return r<=e}function Id(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}var B1="memory",N1=()=>{let t=new Map;return{name:B1,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Ad(t={}){let e={mounts:{"":t.driver||N1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(let l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},s=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(u,l)=>{if(e.watching){l=st(l);for(let h of e.watchListeners)h(u,l)}},i=async()=>{if(!e.watching){e.watching=!0;for(let u in e.mounts)e.unwatch[u]=await Sd(e.mounts[u],n,u)}},o=async()=>{if(e.watching){for(let u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{let f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(let d of u){let g=typeof d=="string",m=st(g?d:d.key),S=g?void 0:d.value,A=g||!d.options?l:{...l,...d.options},b=r(m);p(b).items.push({key:m,value:S,relativeKey:b.relativeKey,options:A})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(u,l={}){u=st(u);let{relativeKey:h,driver:f}=r(u);return Te(f.hasItem,h,l)},getItem(u,l={}){u=st(u);let{relativeKey:h,driver:f}=r(u);return Te(f.getItem,h,l).then(p=>Bn(p))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?Te(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(p=>({key:xd(h.base,p.key),value:Bn(p.value)}))):Promise.all(h.items.map(f=>Te(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Bn(p)})))))},getItemRaw(u,l={}){u=st(u);let{relativeKey:h,driver:f}=r(u);return f.getItemRaw?Te(f.getItemRaw,h,l):Te(f.getItem,h,l).then(p=>Ed(p))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=st(u);let{relativeKey:f,driver:p}=r(u);p.setItem&&(await Te(p.setItem,f,Nn(l),h),p.watch||n("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return Te(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Nn(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>Te(h.driver.setItem,f.relativeKey,Nn(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=st(u);let{relativeKey:f,driver:p}=r(u);if(p.setItemRaw)await Te(p.setItemRaw,f,l,h);else if(p.setItem)await Te(p.setItem,f,bd(l),h);else return;p.watch||n("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=st(u);let{relativeKey:h,driver:f}=r(u);f.removeItem&&(await Te(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await Te(f.removeItem,h+"$",l),f.watch||n("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=st(u);let{relativeKey:h,driver:f}=r(u),p=Object.create(null);if(f.getMeta&&Object.assign(p,await Te(f.getMeta,h,l)),!l.nativeOnly){let d=await Te(f.getItem,h+"$",l).then(g=>Bn(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=Pn(u);let h=s(u,!0),f=[],p=[],d=!0;for(let m of h){m.driver.flags?.maxDepth||(d=!1);let S=await Te(m.driver.getKeys,m.relativeBase,l);for(let A of S){let b=m.mountpoint+st(A);f.some(E=>b.startsWith(E))||p.push(b)}f=[m.mountpoint,...f.filter(A=>!A.startsWith(m.mountpoint))]}let g=l.maxDepth!==void 0&&!d;return p.filter(m=>(!g||vd(m,l.maxDepth))&&Id(m,u))},async clear(u,l={}){u=Pn(u),await Promise.all(s(u,!1).map(async h=>{if(h.driver.clear)return Te(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){let f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(p=>h.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>_d(u)))},async watch(u){return await i(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=Pn(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Sd(l,n,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=Pn(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await _d(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=st(u)+":";let l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=st(u),s(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Sd(t,e,r){return t.watch?t.watch((s,n)=>e(s,r+n)):()=>{}}async function _d(t){typeof t.dispose=="function"&&await Te(t.dispose)}function gs(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Ac(t,e){let r,s=()=>{if(r)return r;let n=indexedDB.open(t);return n.onupgradeneeded=()=>n.result.createObjectStore(e),r=gs(n),r.then(i=>{i.onclose=()=>r=void 0},()=>{}),r};return(n,i)=>s().then(o=>i(o.transaction(e,n).objectStore(e)))}var _c;function Un(){return _c||(_c=Ac("keyval-store","keyval")),_c}function Dc(t,e=Un()){return e("readonly",r=>gs(r.get(t)))}function Dd(t,e,r=Un()){return r("readwrite",s=>(s.put(e,t),gs(s.transaction)))}function Td(t,e=Un()){return e("readwrite",r=>(r.delete(t),gs(r.transaction)))}function Rd(t=Un()){return t("readwrite",e=>(e.clear(),gs(e.transaction)))}function P1(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},gs(t.transaction)}function Od(t=Un()){return t("readonly",e=>{if(e.getAllKeys)return gs(e.getAllKeys());let r=[];return P1(e,s=>r.push(s.key)).then(()=>r)})}var U1=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),F1=t=>{let e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(s,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Yt(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return F1(t)}catch{return t}}function Tt(t){return typeof t=="string"?t:U1(t)||""}var L1="idb-keyval",k1=(t={})=>{let e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n,s;return t.dbName&&t.storeName&&(s=Ac(t.dbName,t.storeName)),{name:L1,options:t,async hasItem(n){return!(typeof await Dc(r(n),s)>"u")},async getItem(n){return await Dc(r(n),s)??null},setItem(n,i){return Dd(r(n),i,s)},removeItem(n){return Td(r(n),s)},getKeys(){return Od(s)},clear(){return Rd(s)}}},M1="WALLET_CONNECT_V2_INDEXED_DB",q1="keyvaluestorage",Rc=class{constructor(){this.indexedDb=Ad({driver:k1({dbName:M1,storeName:q1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){let r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Tt(r))}async removeItem(e){await this.indexedDb.removeItem(e)}},Tc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lo={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,s){this[r]=String(s)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){let r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Tc<"u"&&Tc.localStorage?lo.exports=Tc.localStorage:typeof window<"u"&&window.localStorage?lo.exports=window.localStorage:lo.exports=new e})();function z1(t){var e;return[t[0],Yt((e=t[1])!=null?e:"")]}var Oc=class{constructor(){this.localStorage=lo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(z1)}async getItem(e){let r=this.localStorage.getItem(e);if(r!==null)return Yt(r)}async setItem(e,r){this.localStorage.setItem(e,Tt(r))}async removeItem(e){this.localStorage.removeItem(e)}},j1="wc_storage_version",Cd=1,V1=async(t,e,r)=>{let s=j1,n=await e.getItem(s);if(n&&n>=Cd){r(e);return}let i=await t.getKeys();if(!i.length){r(e);return}let o=[];for(;i.length;){let a=i.shift();if(!a)continue;let c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){let u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(s,Cd),r(e),$1(t,o)},$1=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})},ho=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};let e=new Oc;this.storage=e;try{let r=new Rc;V1(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{let r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var ur=De(Nc()),kn=De(Nc());var sE={level:"info"},Mn="custom_context",Lc=1e3*1024,Pc=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},go=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let r=new Pc(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let r=e.value;return e=e.next,{done:!1,value:r}}}}},mo=class{constructor(e,r=Lc){this.level=e??"error",this.levelValue=ur.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new go(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===ur.levels.values.error?console.error(e):r===ur.levels.values.warn?console.warn(e):r===ur.levels.values.debug?console.debug(e):r===ur.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Tt({timestamp:new Date().toISOString(),log:e}));let r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new go(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let r=this.getLogArray();return r.push(Tt({extraMetadata:e})),new Blob(r,{type:"application/json"})}},Uc=class{constructor(e,r=Lc){this.baseChunkLogger=new mo(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let r=URL.createObjectURL(this.logsToBlob(e)),s=document.createElement("a");s.href=r,s.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}},Fc=class{constructor(e,r=Lc){this.baseChunkLogger=new mo(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}},nE=Object.defineProperty,iE=Object.defineProperties,oE=Object.getOwnPropertyDescriptors,kd=Object.getOwnPropertySymbols,aE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,Md=(t,e,r)=>e in t?nE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yo=(t,e)=>{for(var r in e||(e={}))aE.call(e,r)&&Md(t,r,e[r]);if(kd)for(var r of kd(e))cE.call(e,r)&&Md(t,r,e[r]);return t},wo=(t,e)=>iE(t,oE(e));function qn(t){return wo(yo({},t),{level:t?.level||sE.level})}function uE(t,e=Mn){return t[e]||""}function lE(t,e,r=Mn){return t[r]=e,t}function Ve(t,e=Mn){let r="";return typeof t.bindings>"u"?r=uE(t,e):r=t.bindings().context||"",r}function hE(t,e,r=Mn){let s=Ve(t,r);return s.trim()?`${s}/${e}`:e}function Pe(t,e,r=Mn){let s=hE(t,e,r),n=t.child({context:s});return lE(n,s,r)}function fE(t){var e,r;let s=new Uc((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:(0,ur.default)(wo(yo({},t.opts),{level:"trace",browser:wo(yo({},(r=t.opts)==null?void 0:r.browser),{write:n=>s.write(n)})})),chunkLoggerController:s}}function dE(t){var e;let r=new Fc((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:(0,ur.default)(wo(yo({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function qd(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?fE(t):dE(t)}var Vd=De(ps()),pE=Object.defineProperty,gE=(t,e,r)=>e in t?pE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zd=(t,e,r)=>gE(t,typeof e!="symbol"?e+"":e,r),bo=class extends Ft{constructor(e){super(),this.opts=e,zd(this,"protocol","wc"),zd(this,"version",2)}};var mE=Object.defineProperty,yE=(t,e,r)=>e in t?mE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wE=(t,e,r)=>yE(t,typeof e!="symbol"?e+"":e,r),Eo=class extends Ft{constructor(e,r){super(),this.core=e,this.logger=r,wE(this,"records",new Map)}},xo=class{constructor(e,r){this.logger=e,this.core=r}},vo=class extends Ft{constructor(e,r){super(),this.relayer=e,this.logger=r}},Io=class extends Ft{constructor(e){super()}},So=class{constructor(e,r,s,n){this.core=e,this.logger=r,this.name=s}};var _o=class extends Ft{constructor(e,r){super(),this.relayer=e,this.logger=r}};var Ao=class extends Ft{constructor(e,r){super(),this.core=e,this.logger=r}};var Do=class{constructor(e,r,s){this.core=e,this.logger=r,this.store=s}},To=class{constructor(e,r){this.projectId=e,this.logger=r}},Ro=class{constructor(e,r,s){this.core=e,this.logger=r,this.telemetryEnabled=s}},bE=Object.defineProperty,EE=(t,e,r)=>e in t?bE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jd=(t,e,r)=>EE(t,typeof e!="symbol"?e+"":e,r);var Oo=class{constructor(e){this.opts=e,jd(this,"protocol","wc"),jd(this,"version",2)}};var Co=class{constructor(e){this.client=e}};var K=De(Ks());var cp=De(Ks());function xE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function up(t,...e){if(!xE(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function $d(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function vE(t,e){up(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}var Ys=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var kc=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function IE(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function lp(t){return typeof t=="string"&&(t=IE(t)),up(t),t}var Kc=class{clone(){return this._cloneInto()}};function SE(t){let e=s=>t().update(lp(s)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function hp(t=32){if(Ys&&typeof Ys.getRandomValues=="function")return Ys.getRandomValues(new Uint8Array(t));if(Ys&&typeof Ys.randomBytes=="function")return Ys.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function _E(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);let n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,u=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+u,a,s)}var Gc=class extends Kc{constructor(e,r,s,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=s,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=kc(this.buffer)}update(e){$d(this);let{view:r,buffer:s,blockLen:n}=this;e=lp(e);let i=e.length;for(let o=0;o<i;){let a=Math.min(n-this.pos,i-o);if(a===n){let c=kc(e);for(;n<=i-o;o+=n)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$d(this),vE(e,this),this.finished=!0;let{buffer:r,view:s,blockLen:n,isLE:i}=this,{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(s,0),o=0);for(let h=o;h<n;h++)r[h]=0;_E(s,n-8,BigInt(this.length*8),i),this.process(s,0);let a=kc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:s,length:n,finished:i,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=i,e.destroyed=o,n%r&&e.buffer.set(s),e}},Bo=BigInt(2**32-1),Wc=BigInt(32);function fp(t,e=!1){return e?{h:Number(t&Bo),l:Number(t>>Wc&Bo)}:{h:Number(t>>Wc&Bo)|0,l:Number(t&Bo)|0}}function AE(t,e=!1){let r=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let n=0;n<t.length;n++){let{h:i,l:o}=fp(t[n],e);[r[n],s[n]]=[i,o]}return[r,s]}var DE=(t,e)=>BigInt(t>>>0)<<Wc|BigInt(e>>>0),TE=(t,e,r)=>t>>>r,RE=(t,e,r)=>t<<32-r|e>>>r,OE=(t,e,r)=>t>>>r|e<<32-r,CE=(t,e,r)=>t<<32-r|e>>>r,BE=(t,e,r)=>t<<64-r|e>>>r-32,NE=(t,e,r)=>t>>>r-32|e<<64-r,PE=(t,e)=>e,UE=(t,e)=>t,FE=(t,e,r)=>t<<r|e>>>32-r,LE=(t,e,r)=>e<<r|t>>>32-r,kE=(t,e,r)=>e<<r-32|t>>>64-r,ME=(t,e,r)=>t<<r-32|e>>>64-r;function qE(t,e,r,s){let n=(e>>>0)+(s>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}var zE=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),jE=(t,e,r,s)=>e+r+s+(t/2**32|0)|0,VE=(t,e,r,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0),$E=(t,e,r,s,n)=>e+r+s+n+(t/2**32|0)|0,HE=(t,e,r,s,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0)+(n>>>0),KE=(t,e,r,s,n,i)=>e+r+s+n+i+(t/2**32|0)|0,J={fromBig:fp,split:AE,toBig:DE,shrSH:TE,shrSL:RE,rotrSH:OE,rotrSL:CE,rotrBH:BE,rotrBL:NE,rotr32H:PE,rotr32L:UE,rotlSH:FE,rotlSL:LE,rotlBH:kE,rotlBL:ME,add:qE,add3L:zE,add3H:jE,add4L:VE,add4H:$E,add5H:KE,add5L:HE},[GE,WE]=J.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Pr=new Uint32Array(80),Ur=new Uint32Array(80),Yc=class extends Gc{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:r,Bh:s,Bl:n,Ch:i,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:m}=this;return[e,r,s,n,i,o,a,c,u,l,h,f,p,d,g,m]}set(e,r,s,n,i,o,a,c,u,l,h,f,p,d,g,m){this.Ah=e|0,this.Al=r|0,this.Bh=s|0,this.Bl=n|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)Pr[b]=e.getUint32(r),Ur[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){let E=Pr[b-15]|0,v=Ur[b-15]|0,O=J.rotrSH(E,v,1)^J.rotrSH(E,v,8)^J.shrSH(E,v,7),P=J.rotrSL(E,v,1)^J.rotrSL(E,v,8)^J.shrSL(E,v,7),N=Pr[b-2]|0,w=Ur[b-2]|0,C=J.rotrSH(N,w,19)^J.rotrBH(N,w,61)^J.shrSH(N,w,6),_=J.rotrSL(N,w,19)^J.rotrBL(N,w,61)^J.shrSL(N,w,6),T=J.add4L(P,_,Ur[b-7],Ur[b-16]),B=J.add4H(T,O,C,Pr[b-7],Pr[b-16]);Pr[b]=B|0,Ur[b]=T|0}let{Ah:s,Al:n,Bh:i,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:m,Hh:S,Hl:A}=this;for(let b=0;b<80;b++){let E=J.rotrSH(h,f,14)^J.rotrSH(h,f,18)^J.rotrBH(h,f,41),v=J.rotrSL(h,f,14)^J.rotrSL(h,f,18)^J.rotrBL(h,f,41),O=h&p^~h&g,P=f&d^~f&m,N=J.add5L(A,v,P,WE[b],Ur[b]),w=J.add5H(N,S,E,O,GE[b],Pr[b]),C=N|0,_=J.rotrSH(s,n,28)^J.rotrBH(s,n,34)^J.rotrBH(s,n,39),T=J.rotrSL(s,n,28)^J.rotrBL(s,n,34)^J.rotrBL(s,n,39),B=s&i^s&a^i&a,L=n&o^n&c^o&c;S=g|0,A=m|0,g=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=J.add(u|0,l|0,w|0,C|0),u=a|0,l=c|0,a=i|0,c=o|0,i=s|0,o=n|0;let x=J.add3L(C,T,L);s=J.add3H(x,w,_,B),n=x|0}({h:s,l:n}=J.add(this.Ah|0,this.Al|0,s|0,n|0)),{h:i,l:o}=J.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=J.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=J.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=J.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=J.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:m}=J.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:S,l:A}=J.add(this.Hh|0,this.Hl|0,S|0,A|0),this.set(s,n,i,o,a,c,u,l,h,f,p,d,g,m,S,A)}roundClean(){Pr.fill(0),Ur.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},YE=SE(()=>new Yc);var ou=BigInt(0),dp=BigInt(1),JE=BigInt(2);function au(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function cu(t){if(!au(t))throw new Error("Uint8Array expected")}function Mc(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}var ZE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function uu(t){cu(t);let e="";for(let r=0;r<t.length;r++)e+=ZE[t[r]];return e}function pp(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ou:BigInt("0x"+t)}var lr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hd(t){if(t>=lr._0&&t<=lr._9)return t-lr._0;if(t>=lr.A&&t<=lr.F)return t-(lr.A-10);if(t>=lr.a&&t<=lr.f)return t-(lr.a-10)}function gp(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let s=new Uint8Array(r);for(let n=0,i=0;n<r;n++,i+=2){let o=Hd(t.charCodeAt(i)),a=Hd(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}s[n]=o*16+a}return s}function XE(t){return pp(uu(t))}function Uo(t){return cu(t),pp(uu(Uint8Array.from(t).reverse()))}function mp(t,e){return gp(t.toString(16).padStart(e*2,"0"))}function Jc(t,e){return mp(t,e).reverse()}function hr(t,e,r){let s;if(typeof e=="string")try{s=gp(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(au(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let n=s.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return s}function Kd(...t){let e=0;for(let s=0;s<t.length;s++){let n=t[s];cu(n),e+=n.length}let r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){let i=t[s];r.set(i,n),n+=i.length}return r}var qc=t=>typeof t=="bigint"&&ou<=t;function QE(t,e,r){return qc(t)&&qc(e)&&qc(r)&&e<=t&&t<r}function zn(t,e,r,s){if(!QE(e,r,s))throw new Error("expected valid "+t+": "+r+" <= n < "+s+", got "+e)}function ex(t){let e;for(e=0;t>ou;t>>=dp,e+=1);return e}var tx=t=>(JE<<BigInt(t-1))-dp,rx={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||au(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function lu(t,e,r={}){let s=(n,i,o)=>{let a=rx[i];if(typeof a!="function")throw new Error("invalid validator function");let c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+i+", got "+c)};for(let[n,i]of Object.entries(e))s(n,i,!1);for(let[n,i]of Object.entries(r))s(n,i,!0);return t}function Gd(t){let e=new WeakMap;return(r,...s)=>{let n=e.get(r);if(n!==void 0)return n;let i=t(r,...s);return e.set(r,i),i}}var Ce=BigInt(0),xe=BigInt(1),ms=BigInt(2),sx=BigInt(3),Zc=BigInt(4),Wd=BigInt(5),Yd=BigInt(8);function Re(t,e){let r=t%e;return r>=Ce?r:e+r}function nx(t,e,r){if(e<Ce)throw new Error("invalid exponent, negatives unsupported");if(r<=Ce)throw new Error("invalid modulus");if(r===xe)return Ce;let s=xe;for(;e>Ce;)e&xe&&(s=s*t%r),t=t*t%r,e>>=xe;return s}function Zt(t,e,r){let s=t;for(;e-- >Ce;)s*=s,s%=r;return s}function Jd(t,e){if(t===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let r=Re(t,e),s=e,n=Ce,i=xe;for(;r!==Ce;){let o=s/r,a=s%r,c=n-i*o;s=r,r=a,n=i,i=c}if(s!==xe)throw new Error("invert: does not exist");return Re(n,e)}function ix(t){let e=(t-xe)/ms,r,s,n;for(r=t-xe,s=0;r%ms===Ce;r/=ms,s++);for(n=ms;n<t&&nx(n,e,t)!==t-xe;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){let o=(t+xe)/Zc;return function(a,c){let u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}let i=(r+xe)/ms;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=s,u=o.pow(o.mul(o.ONE,n),r),l=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);let p=o.pow(u,xe<<BigInt(c-f-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=f}return l}}function ox(t){if(t%Zc===sx){let e=(t+xe)/Zc;return function(r,s){let n=r.pow(s,e);if(!r.eql(r.sqr(n),s))throw new Error("Cannot find square root");return n}}if(t%Yd===Wd){let e=(t-Wd)/Yd;return function(r,s){let n=r.mul(s,ms),i=r.pow(n,e),o=r.mul(s,i),a=r.mul(r.mul(o,ms),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),s))throw new Error("Cannot find square root");return c}}return ix(t)}var ax=(t,e)=>(Re(t,e)&xe)===xe,cx=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ux(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=cx.reduce((s,n)=>(s[n]="function",s),e);return lu(t,r)}function lx(t,e,r){if(r<Ce)throw new Error("invalid exponent, negatives unsupported");if(r===Ce)return t.ONE;if(r===xe)return e;let s=t.ONE,n=e;for(;r>Ce;)r&xe&&(s=t.mul(s,n)),n=t.sqr(n),r>>=xe;return s}function hx(t,e){let r=new Array(e.length),s=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),n=t.inv(s);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),n),r}function yp(t,e){let r=e!==void 0?e:t.toString(2).length,s=Math.ceil(r/8);return{nBitLength:r,nByteLength:s}}function wp(t,e,r=!1,s={}){if(t<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+t);let{nBitLength:n,nByteLength:i}=yp(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:i,MASK:tx(n),ZERO:Ce,ONE:xe,create:c=>Re(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ce<=c&&c<t},is0:c=>c===Ce,isOdd:c=>(c&xe)===xe,neg:c=>Re(-c,t),eql:(c,u)=>c===u,sqr:c=>Re(c*c,t),add:(c,u)=>Re(c+u,t),sub:(c,u)=>Re(c-u,t),mul:(c,u)=>Re(c*u,t),pow:(c,u)=>lx(a,c,u),div:(c,u)=>Re(c*Jd(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Jd(c,t),sqrt:s.sqrt||(c=>(o||(o=ox(t)),o(a,c))),invertBatch:c=>hx(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Jc(c,i):mp(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?Uo(c):XE(c)}});return Object.freeze(a)}var Zd=BigInt(0),No=BigInt(1);function zc(t,e){let r=e.negate();return t?r:e}function bp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function jc(t,e){bp(t,e);let r=Math.ceil(e/t)+1,s=2**(t-1);return{windows:r,windowSize:s}}function fx(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,s)=>{if(!(r instanceof e))throw new Error("invalid point at index "+s)})}function dx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,s)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+s)})}var Vc=new WeakMap,Ep=new WeakMap;function $c(t){return Ep.get(t)||1}function px(t,e){return{constTimeNegate:zc,hasPrecomputes(r){return $c(r)!==1},unsafeLadder(r,s,n=t.ZERO){let i=r;for(;s>Zd;)s&No&&(n=n.add(i)),i=i.double(),s>>=No;return n},precomputeWindow(r,s){let{windows:n,windowSize:i}=jc(s,e),o=[],a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,s,n){let{windows:i,windowSize:o}=jc(r,e),a=t.ZERO,c=t.BASE,u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<i;f++){let p=f*o,d=Number(n&u);n>>=h,d>o&&(d-=l,n+=No);let g=p,m=p+Math.abs(d)-1,S=f%2!==0,A=d<0;d===0?c=c.add(zc(S,s[g])):a=a.add(zc(A,s[m]))}return{p:a,f:c}},wNAFUnsafe(r,s,n,i=t.ZERO){let{windows:o,windowSize:a}=jc(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){let f=h*a;if(n===Zd)break;let p=Number(n&c);if(n>>=l,p>a&&(p-=u,n+=No),p===0)continue;let d=s[f+Math.abs(p)-1];p<0&&(d=d.negate()),i=i.add(d)}return i},getPrecomputes(r,s,n){let i=Vc.get(s);return i||(i=this.precomputeWindow(s,r),r!==1&&Vc.set(s,n(i))),i},wNAFCached(r,s,n){let i=$c(r);return this.wNAF(i,this.getPrecomputes(i,r,n),s)},wNAFCachedUnsafe(r,s,n,i){let o=$c(r);return o===1?this.unsafeLadder(r,s,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),s,i)},setWindowSize(r,s){bp(s,e),Ep.set(r,s),Vc.delete(r)}}}function gx(t,e,r,s){if(fx(r,t),dx(s,e),r.length!==s.length)throw new Error("arrays of points and scalars must have equal length");let n=t.ZERO,i=ex(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o,l=n;for(let h=u;h>=0;h-=o){c.fill(n);for(let p=0;p<s.length;p++){let d=s[p],g=Number(d>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[p])}let f=n;for(let p=c.length-1,d=n;p>0;p--)d=d.add(c[p]),f=f.add(d);if(l=l.add(f),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function mx(t){return ux(t.Fp),lu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...yp(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}var Lt=BigInt(0),ct=BigInt(1),Po=BigInt(2),yx=BigInt(8),wx={zip215:!0};function bx(t){let e=mx(t);return lu(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Ex(t){let e=bx(t),{Fp:r,n:s,prehash:n,hash:i,randomBytes:o,nByteLength:a,h:c}=e,u=Po<<BigInt(a*8)-ct,l=r.create,h=wp(e.n,e.nBitLength),f=e.uvRatio||((x,y)=>{try{return{isValid:!0,value:r.sqrt(x*r.inv(y))}}catch{return{isValid:!1,value:Lt}}}),p=e.adjustScalarBytes||(x=>x),d=e.domain||((x,y,I)=>{if(Mc("phflag",I),y.length||I)throw new Error("Contexts/pre-hash are not supported");return x});function g(x,y){zn("coordinate "+x,y,Lt,u)}function m(x){if(!(x instanceof b))throw new Error("ExtendedPoint expected")}let S=Gd((x,y)=>{let{ex:I,ey:R,ez:D}=x,U=x.is0();y==null&&(y=U?yx:r.inv(D));let F=l(I*y),M=l(R*y),j=l(D*y);if(U)return{x:Lt,y:ct};if(j!==ct)throw new Error("invZ was invalid");return{x:F,y:M}}),A=Gd(x=>{let{a:y,d:I}=e;if(x.is0())throw new Error("bad point: ZERO");let{ex:R,ey:D,ez:U,et:F}=x,M=l(R*R),j=l(D*D),$=l(U*U),H=l($*$),G=l(M*y),Z=l($*l(G+j)),Q=l(H+l(I*l(M*j)));if(Z!==Q)throw new Error("bad point: equation left != right (1)");let W=l(R*D),ae=l(U*F);if(W!==ae)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(y,I,R,D){this.ex=y,this.ey=I,this.ez=R,this.et=D,g("x",y),g("y",I),g("z",R),g("t",D),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof b)throw new Error("extended point not allowed");let{x:I,y:R}=y||{};return g("x",I),g("y",R),new b(I,R,ct,l(I*R))}static normalizeZ(y){let I=r.invertBatch(y.map(R=>R.ez));return y.map((R,D)=>R.toAffine(I[D])).map(b.fromAffine)}static msm(y,I){return gx(b,h,y,I)}_setWindowSize(y){O.setWindowSize(this,y)}assertValidity(){A(this)}equals(y){m(y);let{ex:I,ey:R,ez:D}=this,{ex:U,ey:F,ez:M}=y,j=l(I*M),$=l(U*D),H=l(R*M),G=l(F*D);return j===$&&H===G}is0(){return this.equals(b.ZERO)}negate(){return new b(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){let{a:y}=e,{ex:I,ey:R,ez:D}=this,U=l(I*I),F=l(R*R),M=l(Po*l(D*D)),j=l(y*U),$=I+R,H=l(l($*$)-U-F),G=j+F,Z=G-M,Q=j-F,W=l(H*Z),ae=l(G*Q),Ee=l(H*Q),wt=l(Z*G);return new b(W,ae,wt,Ee)}add(y){m(y);let{a:I,d:R}=e,{ex:D,ey:U,ez:F,et:M}=this,{ex:j,ey:$,ez:H,et:G}=y;if(I===BigInt(-1)){let jf=l((U-D)*($+j)),Vf=l((U+D)*($-j)),gc=l(Vf-jf);if(gc===Lt)return this.double();let $f=l(F*Po*G),Hf=l(M*Po*H),Kf=Hf+$f,Gf=Vf+jf,Wf=Hf-$f,kb=l(Kf*gc),Mb=l(Gf*Wf),qb=l(Kf*Wf),zb=l(gc*Gf);return new b(kb,Mb,zb,qb)}let Z=l(D*j),Q=l(U*$),W=l(M*R*G),ae=l(F*H),Ee=l((D+U)*(j+$)-Z-Q),wt=ae-W,At=ae+W,Dt=l(Q-I*Z),Wt=l(Ee*wt),Zi=l(At*Dt),Fb=l(Ee*Dt),Lb=l(wt*At);return new b(Wt,Zi,Lb,Fb)}subtract(y){return this.add(y.negate())}wNAF(y){return O.wNAFCached(this,y,b.normalizeZ)}multiply(y){let I=y;zn("scalar",I,ct,s);let{p:R,f:D}=this.wNAF(I);return b.normalizeZ([R,D])[0]}multiplyUnsafe(y,I=b.ZERO){let R=y;return zn("scalar",R,Lt,s),R===Lt?v:this.is0()||R===ct?this:O.wNAFCachedUnsafe(this,R,b.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,s).is0()}toAffine(y){return S(this,y)}clearCofactor(){let{h:y}=e;return y===ct?this:this.multiplyUnsafe(y)}static fromHex(y,I=!1){let{d:R,a:D}=e,U=r.BYTES;y=hr("pointHex",y,U),Mc("zip215",I);let F=y.slice(),M=y[U-1];F[U-1]=M&-129;let j=Uo(F),$=I?u:r.ORDER;zn("pointHex.y",j,Lt,$);let H=l(j*j),G=l(H-ct),Z=l(R*H-D),{isValid:Q,value:W}=f(G,Z);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");let ae=(W&ct)===ct,Ee=(M&128)!==0;if(!I&&W===Lt&&Ee)throw new Error("Point.fromHex: x=0 and x_0=1");return Ee!==ae&&(W=l(-W)),b.fromAffine({x:W,y:j})}static fromPrivateKey(y){return w(y).point}toRawBytes(){let{x:y,y:I}=this.toAffine(),R=Jc(I,r.BYTES);return R[R.length-1]|=y&ct?128:0,R}toHex(){return uu(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,ct,l(e.Gx*e.Gy)),b.ZERO=new b(Lt,ct,ct,Lt);let{BASE:E,ZERO:v}=b,O=px(b,a*8);function P(x){return Re(x,s)}function N(x){return P(Uo(x))}function w(x){let y=r.BYTES;x=hr("private key",x,y);let I=hr("hashed private key",i(x),2*y),R=p(I.slice(0,y)),D=I.slice(y,2*y),U=N(R),F=E.multiply(U),M=F.toRawBytes();return{head:R,prefix:D,scalar:U,point:F,pointBytes:M}}function C(x){return w(x).pointBytes}function _(x=new Uint8Array,...y){let I=Kd(...y);return N(i(d(I,hr("context",x),!!n)))}function T(x,y,I={}){x=hr("message",x),n&&(x=n(x));let{prefix:R,scalar:D,pointBytes:U}=w(y),F=_(I.context,R,x),M=E.multiply(F).toRawBytes(),j=_(I.context,M,U,x),$=P(F+j*D);zn("signature.s",$,Lt,s);let H=Kd(M,Jc($,r.BYTES));return hr("result",H,r.BYTES*2)}let B=wx;function L(x,y,I,R=B){let{context:D,zip215:U}=R,F=r.BYTES;x=hr("signature",x,2*F),y=hr("message",y),I=hr("publicKey",I,F),U!==void 0&&Mc("zip215",U),n&&(y=n(y));let M=Uo(x.slice(F,2*F)),j,$,H;try{j=b.fromHex(I,U),$=b.fromHex(x.slice(0,F),U),H=E.multiplyUnsafe(M)}catch{return!1}if(!U&&j.isSmallOrder())return!1;let G=_(D,$.toRawBytes(),j.toRawBytes(),y);return $.add(j.multiplyUnsafe(G)).subtract(H).clearCofactor().equals(b.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:C,sign:T,verify:L,ExtendedPoint:b,utils:{getExtendedPublicKey:w,randomPrivateKey:()=>o(r.BYTES),precompute(x=8,y=b.BASE){return y._setWindowSize(x),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);var hu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Xd=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);var xx=BigInt(1),Qd=BigInt(2);BigInt(3);var vx=BigInt(5),Ix=BigInt(8);function Sx(t){let e=BigInt(10),r=BigInt(20),s=BigInt(40),n=BigInt(80),i=hu,o=t*t%i*t%i,a=Zt(o,Qd,i)*o%i,c=Zt(a,xx,i)*t%i,u=Zt(c,vx,i)*c%i,l=Zt(u,e,i)*u%i,h=Zt(l,r,i)*l%i,f=Zt(h,s,i)*h%i,p=Zt(f,n,i)*f%i,d=Zt(p,n,i)*f%i,g=Zt(d,e,i)*u%i;return{pow_p_5_8:Zt(g,Qd,i)*t%i,b2:o}}function _x(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Ax(t,e){let r=hu,s=Re(e*e*e,r),n=Re(s*s*e,r),i=Sx(t*n).pow_p_5_8,o=Re(t*s*i,r),a=Re(e*o*o,r),c=o,u=Re(o*Xd,r),l=a===t,h=a===Re(-t,r),f=a===Re(-t*Xd,r);return l&&(o=c),(h||f)&&(o=u),ax(o,r)&&(o=Re(-o,r)),{isValid:l||h,value:o}}var Dx=wp(hu,void 0,!0),Tx={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Dx,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Ix,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:YE,randomBytes:hp,adjustScalarBytes:_x,uvRatio:Ax},xp=Ex(Tx),Rx="EdDSA",Ox="JWT",Fo=".",ko="base64url",vp="utf8",Ip="utf8",Cx=":",Bx="did",Nx="key",ep="base58btc",Px="z",Ux="K36";var Fx=32;function fu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Sp(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?fu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function _p(t,e){e||(e=t.reduce((n,i)=>n+i.length,0));let r=Sp(e),s=0;for(let n of t)r.set(n,s),s+=n.length;return fu(r)}function Lx(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,S=0,A=d.length;S!==A&&d[S]===0;)S++,g++;for(var b=(A-S)*l+1>>>0,E=new Uint8Array(b);S!==A;){for(var v=d[S],O=0,P=b-1;(v!==0||O<m)&&P!==-1;P--,O++)v+=256*E[P]>>>0,E[P]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");m=O,S++}for(var N=b-m;N!==b&&E[N]===0;)N++;for(var w=c.repeat(g);N<b;++N)w+=t.charAt(E[N]);return w}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,S=0;d[g]===c;)m++,g++;for(var A=(d.length-g)*u+1>>>0,b=new Uint8Array(A);d[g];){var E=r[d.charCodeAt(g)];if(E===255)return;for(var v=0,O=A-1;(E!==0||v<S)&&O!==-1;O--,v++)E+=a*b[O]>>>0,b[O]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");S=v,g++}if(d[g]!==" "){for(var P=A-S;P!==A&&b[P]===0;)P++;for(var N=new Uint8Array(m+(A-P)),w=m;P!==A;)N[w++]=b[P++];return N}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var kx=Lx,Mx=kx,Ap=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},qx=t=>new TextEncoder().encode(t),zx=t=>new TextDecoder().decode(t),Xc=class{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Qc=class{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Dp(this,e)}},eu=class{constructor(e){this.decoders=e}or(e){return Dp(this,e)}decode(e){let r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Dp=(t,e)=>new eu({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),tu=class{constructor(e,r,s,n){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=n,this.encoder=new Xc(e,r,s),this.decoder=new Qc(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Mo=({name:t,prefix:e,encode:r,decode:s})=>new tu(t,e,r,s),jn=({prefix:t,name:e,alphabet:r})=>{let{encode:s,decode:n}=Mx(r,e);return Mo({prefix:t,name:e,encode:s,decode:i=>Ap(n(i))})},jx=(t,e,r,s)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,c=0,u=0;for(let l=0;l<i;++l){let h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Vx=(t,e,r)=>{let s=e[e.length-1]==="=",n=(1<<r)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[n&a>>o];if(o&&(i+=e[n&a<<r-o]),s)for(;i.length*r&7;)i+="=";return i},Ue=({name:t,prefix:e,bitsPerChar:r,alphabet:s})=>Mo({prefix:e,name:t,encode(n){return Vx(n,s,r)},decode(n){return jx(n,s,r,t)}}),$x=Mo({prefix:"\0",name:"identity",encode:t=>zx(t),decode:t=>qx(t)}),Hx=Object.freeze({__proto__:null,identity:$x}),Kx=Ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Gx=Object.freeze({__proto__:null,base2:Kx}),Wx=Ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Yx=Object.freeze({__proto__:null,base8:Wx}),Jx=jn({prefix:"9",name:"base10",alphabet:"0123456789"}),Zx=Object.freeze({__proto__:null,base10:Jx}),Xx=Ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Qx=Ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ev=Object.freeze({__proto__:null,base16:Xx,base16upper:Qx}),tv=Ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rv=Ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sv=Ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),nv=Ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),iv=Ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ov=Ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),av=Ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cv=Ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uv=Ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),lv=Object.freeze({__proto__:null,base32:tv,base32upper:rv,base32pad:sv,base32padupper:nv,base32hex:iv,base32hexupper:ov,base32hexpad:av,base32hexpadupper:cv,base32z:uv}),hv=jn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fv=jn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),dv=Object.freeze({__proto__:null,base36:hv,base36upper:fv}),pv=jn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gv=jn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mv=Object.freeze({__proto__:null,base58btc:pv,base58flickr:gv}),yv=Ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wv=Ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bv=Ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ev=Ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),xv=Object.freeze({__proto__:null,base64:yv,base64pad:wv,base64url:bv,base64urlpad:Ev}),Tp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),vv=Tp.reduce((t,e,r)=>(t[r]=e,t),[]),Iv=Tp.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Sv(t){return t.reduce((e,r)=>(e+=vv[r],e),"")}function _v(t){let e=[];for(let r of t){let s=Iv[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}var Av=Mo({prefix:"\u{1F680}",name:"base256emoji",encode:Sv,decode:_v}),Dv=Object.freeze({__proto__:null,base256emoji:Av}),Tv=Rp,tp=128,Rv=127,Ov=~Rv,Cv=Math.pow(2,31);function Rp(t,e,r){e=e||[],r=r||0;for(var s=r;t>=Cv;)e[r++]=t&255|tp,t/=128;for(;t&Ov;)e[r++]=t&255|tp,t>>>=7;return e[r]=t|0,Rp.bytes=r-s+1,e}var Bv=ru,Nv=128,rp=127;function ru(t,s){var r=0,s=s||0,n=0,i=s,o,a=t.length;do{if(i>=a)throw ru.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=n<28?(o&rp)<<n:(o&rp)*Math.pow(2,n),n+=7}while(o>=Nv);return ru.bytes=i-s,r}var Pv=Math.pow(2,7),Uv=Math.pow(2,14),Fv=Math.pow(2,21),Lv=Math.pow(2,28),kv=Math.pow(2,35),Mv=Math.pow(2,42),qv=Math.pow(2,49),zv=Math.pow(2,56),jv=Math.pow(2,63),Vv=function(t){return t<Pv?1:t<Uv?2:t<Fv?3:t<Lv?4:t<kv?5:t<Mv?6:t<qv?7:t<zv?8:t<jv?9:10},$v={encode:Tv,decode:Bv,encodingLength:Vv},Op=$v,sp=(t,e,r=0)=>(Op.encode(t,e,r),e),np=t=>Op.encodingLength(t),su=(t,e)=>{let r=e.byteLength,s=np(t),n=s+np(r),i=new Uint8Array(n+r);return sp(t,i,0),sp(r,i,s),i.set(e,n),new nu(t,r,e,i)},nu=class{constructor(e,r,s,n){this.code=e,this.size=r,this.digest=s,this.bytes=n}},Cp=({name:t,code:e,encode:r})=>new iu(t,e,r),iu=class{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?su(this.code,r):r.then(s=>su(this.code,s))}else throw Error("Unknown type, must be binary type")}},Bp=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Hv=Cp({name:"sha2-256",code:18,encode:Bp("SHA-256")}),Kv=Cp({name:"sha2-512",code:19,encode:Bp("SHA-512")}),Gv=Object.freeze({__proto__:null,sha256:Hv,sha512:Kv}),Np=0,Wv="identity",Pp=Ap,Yv=t=>su(Np,Pp(t)),Jv={code:Np,name:Wv,encode:Pp,digest:Yv},Zv=Object.freeze({__proto__:null,identity:Jv});new TextEncoder,new TextDecoder;var ip={...Hx,...Gx,...Yx,...Zx,...ev,...lv,...dv,...mv,...xv,...Dv};({...Gv,...Zv});function Up(t,e,r,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:s}}}var op=Up("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Hc=Up("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=Sp(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Fp={utf8:op,"utf-8":op,hex:ip.base16,latin1:Hc,ascii:Hc,binary:Hc,...ip};function qo(t,e="utf8"){let r=Fp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Js(t,e="utf8"){let r=Fp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?fu(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function ap(t){return Yt(qo(Js(t,ko),vp))}function Lo(t){return qo(Js(Tt(t),vp),ko)}function du(t){let e=Js(Ux,ep),r=Px+qo(_p([e,t]),ep);return[Bx,Nx,r].join(Cx)}function Xv(t){return qo(t,ko)}function Qv(t){return Js(t,ko)}function e2(t){return Js([Lo(t.header),Lo(t.payload)].join(Fo),Ip)}function t2(t){return[Lo(t.header),Lo(t.payload),Xv(t.signature)].join(Fo)}function Vn(t){let e=t.split(Fo),r=ap(e[0]),s=ap(e[1]),n=Qv(e[2]),i=Js(e.slice(0,2).join(Fo),Ip);return{header:r,payload:s,signature:n,data:i}}function pu(t=hp(Fx)){let e=xp.getPublicKey(t);return{secretKey:_p([t,e]),publicKey:e}}async function Lp(t,e,r,s,n=(0,cp.fromMiliseconds)(Date.now())){let i={alg:Rx,typ:Ox},o=du(s.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},u=e2({header:i,payload:c}),l=xp.sign(u,s.secretKey.slice(0,32));return t2({header:i,payload:c,signature:l})}var kp=function(t,e,r){if(r||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},s2=function(){function t(e,r,s){this.name=e,this.version=r,this.os=s,this.type="browser"}return t}();var n2=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}();var i2=function(){function t(e,r,s,n){this.name=e,this.version=r,this.os=s,this.bot=n,this.type="bot-device"}return t}();var o2=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}();var a2=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}();var c2=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,u2=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Mp=3,l2=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",c2]],qp=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function jp(t){return t?zp(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new a2:typeof navigator<"u"?zp(navigator.userAgent):d2()}function h2(t){return t!==""&&l2.reduce(function(e,r){var s=r[0],n=r[1];if(e)return e;var i=n.exec(t);return!!i&&[s,i]},!1)}function zp(t){var e=h2(t);if(!e)return null;var r=e[0],s=e[1];if(r==="searchbot")return new o2;var n=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);n?n.length<Mp&&(n=kp(kp([],n,!0),p2(Mp-n.length),!0)):n=[];var i=n.join("."),o=f2(t),a=u2.exec(t);return a&&a[1]?new i2(r,i,o,a[1]):new s2(r,i,o)}function f2(t){for(var e=0,r=qp.length;e<r;e++){var s=qp[e],n=s[0],i=s[1],o=i.exec(t);if(o)return n}return null}function d2(){var t=typeof process<"u"&&process.version;return t?new n2(process.version.slice(1)):null}function p2(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ar=De(Ks()),Vt=De(zo()),$m=De($p());Eg();_u();function xg(t){let e=ea(`0x${t.substring(4)}`).substring(26);return bg(`0x${e}`)}$n();gu();Go();Wo();async function h0({hash:t,signature:e}){let r=fr(t)?t:Gn(t),{secp256k1:s}=await Promise.resolve().then(()=>(u0(),c0));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){let{r:u,s:l,v:h,yParity:f}=e,p=Number(f??h),d=l0(p);return new s.Signature(Ko(u),Ko(l)).addRecoveryBit(d)}let o=fr(e)?e:Gn(e);if(Hn(o)!==65)throw new Error("invalid signature length");let a=Wp(`0x${o.slice(130)}`),c=l0(a);return s.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function l0(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function tl({hash:t,signature:e}){return xg(await h0({hash:t,signature:e}))}function _3(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){let l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}let r=t.length,s=t.charAt(0),n=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0,p=u.length;for(;f!==p&&u[f]===0;)f++,l++;let d=(p-f)*i+1>>>0,g=new Uint8Array(d);for(;f!==p;){let A=u[f],b=0;for(let E=d-1;(A!==0||b<h)&&E!==-1;E--,b++)A+=256*g[E]>>>0,g[E]=A%r>>>0,A=A/r>>>0;if(A!==0)throw new Error("Non-zero carry");h=b,f++}let m=d-h;for(;m!==d&&g[m]===0;)m++;let S=s.repeat(l);for(;m<d;++m)S+=t.charAt(g[m]);return S}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===s;)h++,l++;let p=(u.length-l)*n+1>>>0,d=new Uint8Array(p);for(;l<u.length;){let A=u.charCodeAt(l);if(A>255)return;let b=e[A];if(b===255)return;let E=0;for(let v=p-1;(b!==0||E<f)&&v!==-1;v--,E++)b+=r*d[v]>>>0,d[v]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=E,l++}let g=p-f;for(;g!==p&&d[g]===0;)g++;let m=new Uint8Array(h+(p-g)),S=h;for(;g!==p;)m[S++]=d[g++];return m}function c(u){let l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var f0=_3;var A3="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",nn=f0(A3);function d0(t){let e=t.length,r=0,s=0;for(;s<e;){let n=t.charCodeAt(s++);if(n&4294967168)if(!(n&4294965248))r+=2;else{if(n>=55296&&n<=56319&&s<e){let i=t.charCodeAt(s);(i&64512)===56320&&(++s,n=((n&1023)<<10)+(i&1023)+65536)}n&4294901760?r+=4:r+=3}else{r++;continue}}return r}function D3(t,e,r){let s=t.length,n=r,i=0;for(;i<s;){let o=t.charCodeAt(i++);if(o&4294967168)if(!(o&4294965248))e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<s){let a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128):(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128)}else{e[n++]=o;continue}e[n++]=o&63|128}}var T3=new TextEncoder,R3=50;function O3(t,e,r){T3.encodeInto(t,e.subarray(r))}function p0(t,e,r){t.length>R3?O3(t,e,r):D3(t,e,r)}var C3=4096;function rl(t,e,r){let s=e,n=s+r,i=[],o="";for(;s<n;){let a=t[s++];if(!(a&128))i.push(a);else if((a&224)===192){let c=t[s++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){let c=t[s++]&63,u=t[s++]&63;i.push((a&31)<<12|c<<6|u)}else if((a&248)===240){let c=t[s++]&63,u=t[s++]&63,l=t[s++]&63,h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=C3&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}var B3=new TextDecoder,N3=200;function P3(t,e,r){let s=t.subarray(e,e+r);return B3.decode(s)}function g0(t,e,r){return r>N3?P3(t,e,r):rl(t,e,r)}var Ss=class{constructor(e,r){this.type=e,this.data=r}};var lt=class t extends Error{constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};function m0(t,e,r){let s=r/4294967296,n=r;t.setUint32(e,s),t.setUint32(e+4,n)}function la(t,e,r){let s=Math.floor(r/4294967296),n=r;t.setUint32(e,s),t.setUint32(e+4,n)}function ha(t,e){let r=t.getInt32(e),s=t.getUint32(e+4);return r*4294967296+s}function y0(t,e){let r=t.getUint32(e),s=t.getUint32(e+4);return r*4294967296+s}var U3=-1,F3=4294967296-1,L3=17179869184-1;function k3({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=L3)if(e===0&&t<=F3){let r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{let r=t/4294967296,s=t&4294967295,n=new Uint8Array(8),i=new DataView(n.buffer);return i.setUint32(0,e<<2|r&3),i.setUint32(4,s),n}else{let r=new Uint8Array(12),s=new DataView(r.buffer);return s.setUint32(0,e),la(s,4,t),r}}function M3(t){let e=t.getTime(),r=Math.floor(e/1e3),s=(e-r*1e3)*1e6,n=Math.floor(s/1e9);return{sec:r+n,nsec:s-n*1e9}}function q3(t){if(t instanceof Date){let e=M3(t);return k3(e)}else return null}function z3(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let r=e.getUint32(0),s=e.getUint32(4),n=(r&3)*4294967296+s,i=r>>>2;return{sec:n,nsec:i}}case 12:{let r=ha(e,4),s=e.getUint32(0);return{sec:r,nsec:s}}default:throw new lt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function j3(t){let e=z3(t);return new Date(e.sec*1e3+e.nsec/1e6)}var w0={type:U3,encode:q3,decode:j3};var $r=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(w0)}register({type:e,encode:r,decode:s}){if(e>=0)this.encoders[e]=r,this.decoders[e]=s;else{let n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=s}}tryToEncode(e,r){for(let s=0;s<this.builtInEncoders.length;s++){let n=this.builtInEncoders[s];if(n!=null){let i=n(e,r);if(i!=null){let o=-1-s;return new Ss(o,i)}}}for(let s=0;s<this.encoders.length;s++){let n=this.encoders[s];if(n!=null){let i=n(e,r);if(i!=null){let o=s;return new Ss(o,i)}}}return e instanceof Ss?e:null}decode(e,r,s){let n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,s):new Ss(r,e)}};$r.defaultCodec=new $r;function V3(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function oi(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):V3(t)?new Uint8Array(t):Uint8Array.from(t)}var $3=100,H3=2048,fa=class t{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??$r.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??$3,this.initialBufferSize=e?.initialBufferSize??H3,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){let r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){let r=new ArrayBuffer(e),s=new Uint8Array(r),n=new DataView(r);s.set(this.bytes),this.view=n,this.bytes=s}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let s=d0(e);this.ensureBufferSizeToWrite(5+s),this.writeStringHeader(s),p0(e,this.bytes,this.pos),this.pos+=s}encodeObject(e,r){let s=this.extensionCodec.tryToEncode(e,this.context);if(s!=null)this.encodeExtension(s);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);let s=oi(e);this.writeU8a(s)}encodeArray(e,r){let s=e.length;if(s<16)this.writeU8(144+s);else if(s<65536)this.writeU8(220),this.writeU16(s);else if(s<4294967296)this.writeU8(221),this.writeU32(s);else throw new Error(`Too large array: ${s}`);for(let n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let s=0;for(let n of r)e[n]!==void 0&&s++;return s}encodeMap(e,r){let s=Object.keys(e);this.sortKeys&&s.sort();let n=this.ignoreUndefined?this.countWithoutUndefined(e,s):s.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(let i of s){let o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){let s=e.data(this.pos+6),n=s.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(s);return}let r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),m0(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),la(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function sl(t,e){return new fa(e).encodeSharedRef(t)}function da(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}var K3=16,G3=16,pa=class{constructor(e=K3,r=G3){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let s=0;s<this.maxKeyLength;s++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,s){let n=this.caches[s-1];e:for(let i of n){let o=i.bytes;for(let a=0;a<s;a++)if(o[a]!==e[r+a])continue e;return i.str}return null}store(e,r){let s=this.caches[e.length-1],n={bytes:e,str:r};s.length>=this.maxLengthPerKey?s[Math.random()*s.length|0]=n:s.push(n)}decode(e,r,s){let n=this.find(e,r,s);if(n!=null)return this.hit++,n;this.miss++;let i=rl(e,r,s),o=Uint8Array.prototype.slice.call(e,r,r+s);return this.store(o,i),i}};var nl="array",ui="map_key",E0="map_value",W3=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new lt("The type of key must be string or number but "+typeof t)},il=class{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let r=this.getUninitializedStateFromPool();r.type=nl,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){let r=this.getUninitializedStateFromPool();r.type=ui,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){let e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===nl){let s=e;s.size=0,s.array=void 0,s.position=0,s.type=void 0}if(e.type===ui||e.type===E0){let s=e;s.size=0,s.map=void 0,s.readCount=0,s.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}},ci=-1,ol=new DataView(new ArrayBuffer(0)),Y3=new Uint8Array(ol.buffer);try{ol.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var b0=new RangeError("Insufficient data"),J3=new pa,ga=class t{constructor(e){this.totalPos=0,this.pos=0,this.view=ol,this.bytes=Y3,this.headByte=ci,this.stack=new il,this.entered=!1,this.extensionCodec=e?.extensionCodec??$r.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??4294967295,this.maxBinLength=e?.maxBinLength??4294967295,this.maxArrayLength=e?.maxArrayLength??4294967295,this.maxMapLength=e?.maxMapLength??4294967295,this.maxExtLength=e?.maxExtLength??4294967295,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:J3,this.mapKeyConverter=e?.mapKeyConverter??W3}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=ci,this.stack.reset()}setBuffer(e){let r=oi(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===ci&&!this.hasRemaining(1))this.setBuffer(e);else{let r=this.bytes.subarray(this.pos),s=oi(e),n=new Uint8Array(r.length+s.length);n.set(r),n.set(s,r.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:r,pos:s}=this;return new RangeError(`Extra ${r.byteLength-s} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,s;for await(let a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{s=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return s}let{headByte:n,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${da(n)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let s=r,n=-1;for await(let i of e){if(r&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),s&&(n=this.readArraySize(),s=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){let e=this.readHeadByte(),r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){let n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){let n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{let n=e-160;r=this.decodeString(n,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){let n=this.lookU8();r=this.decodeString(n,1)}else if(e===218){let n=this.lookU16();r=this.decodeString(n,2)}else if(e===219){let n=this.lookU32();r=this.decodeString(n,4)}else if(e===220){let n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){let n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){let n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){let n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){let n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){let n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){let n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){let n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){let n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){let n=this.lookU32();r=this.decodeExtension(n,4)}else throw new lt(`Unrecognized type byte: ${da(e)}`);this.complete();let s=this.stack;for(;s.length>0;){let n=s.top();if(n.type===nl)if(n.array[n.position]=r,n.position++,n.position===n.size)r=n.array,s.release(n);else continue e;else if(n.type===ui){if(r==="__proto__")throw new lt("The key __proto__ is not allowed");n.key=this.mapKeyConverter(r),n.type=E0;continue e}else if(n.map[n.key]=r,n.readCount++,n.readCount===n.size)r=n.map,s.release(n);else{n.key=null,n.type=ui;continue e}}return r}}readHeadByte(){return this.headByte===ci&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=ci}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new lt(`Unrecognized array type byte: ${da(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new lt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new lt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new lt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw b0;let s=this.pos+r,n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,s,e):n=g0(this.bytes,s,e),this.pos+=r+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===ui:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new lt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw b0;let s=this.pos+r,n=this.bytes.subarray(s,s+e);return this.pos+=r+e,n}decodeExtension(e,r){if(e>this.maxExtLength)throw new lt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let s=this.view.getInt8(this.pos+r),n=this.decodeBinary(e,r+1);return this.extensionCodec.decode(n,s,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=y0(this.view,this.pos);return this.pos+=8,e}readI64(){let e=ha(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function al(t,e){return new ga(e).decode(t)}function Z3(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function v0(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function ma(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function ll(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function ul(t){if(!Array.isArray(t))throw new Error("array expected")}function ya(t,e){if(!v0(!0,e))throw new Error(`${t}: array of strings expected`)}function X3(t,e){if(!v0(!1,e))throw new Error(`${t}: array of numbers expected`)}function Q3(...t){let e=i=>i,r=(i,o)=>a=>i(o(a)),s=t.map(i=>i.encode).reduceRight(r,e),n=t.map(i=>i.decode).reduce(r,e);return{encode:s,decode:n}}function e8(t){let e=typeof t=="string"?t.split(""):t,r=e.length;ya("alphabet",e);let s=new Map(e.map((n,i)=>[n,i]));return{encode:n=>(ul(n),n.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${t}`);return e[i]})),decode:n=>(ul(n),n.map(i=>{ma("alphabet.decode",i);let o=s.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${t}`);return o}))}}function t8(t=""){return ma("join",t),{encode:e=>(ya("join.decode",e),e.join(t)),decode:e=>(ma("join.decode",e),e.split(t))}}function r8(t,e="="){return ll(t),ma("padding",e),{encode(r){for(ya("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){ya("padding.decode",r);let s=r.length;if(s*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;s>0&&r[s-1]===e;s--)if((s-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,s)}}}var I0=(t,e)=>e===0?t:I0(e,t%e),wa=(t,e)=>t+(e-I0(t,e)),cl=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function x0(t,e,r,s){if(ul(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(wa(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${wa(e,r)}`);let n=0,i=0,o=cl[e],a=cl[r]-1,c=[];for(let u of t){if(ll(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(n=n<<e|u,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=r;i-=r)c.push((n>>i-r&a)>>>0);let l=cl[i];if(l===void 0)throw new Error("invalid carry");n&=l-1}if(n=n<<r-i&a,!s&&i>=e)throw new Error("Excess padding");if(!s&&n>0)throw new Error(`Non-zero padding: ${n}`);return s&&i>0&&c.push(n>>>0),c}function s8(t,e=!1){if(ll(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(wa(8,t)>32||wa(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Z3(r))throw new Error("radix2.encode input should be Uint8Array");return x0(Array.from(r),8,t,!e)},decode:r=>(X3("radix2.decode",r),Uint8Array.from(x0(r,t,8,e)))}}var S0=Q3(s8(5),e8("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),r8(5),t8(""));function _s(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function li(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?_s(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function As(t,e){e||(e=t.reduce((n,i)=>n+i.length,0));let r=li(e),s=0;for(let n of t)r.set(n,s),s+=n.length;return _s(r)}var gl={};Ne(gl,{identity:()=>u8});function n8(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,S=0,A=d.length;S!==A&&d[S]===0;)S++,g++;for(var b=(A-S)*l+1>>>0,E=new Uint8Array(b);S!==A;){for(var v=d[S],O=0,P=b-1;(v!==0||O<m)&&P!==-1;P--,O++)v+=256*E[P]>>>0,E[P]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");m=O,S++}for(var N=b-m;N!==b&&E[N]===0;)N++;for(var w=c.repeat(g);N<b;++N)w+=t.charAt(E[N]);return w}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,S=0;d[g]===c;)m++,g++;for(var A=(d.length-g)*u+1>>>0,b=new Uint8Array(A);d[g];){var E=r[d.charCodeAt(g)];if(E===255)return;for(var v=0,O=A-1;(E!==0||v<S)&&O!==-1;O--,v++)E+=a*b[O]>>>0,b[O]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");S=v,g++}if(d[g]!==" "){for(var P=A-S;P!==A&&b[P]===0;)P++;for(var N=new Uint8Array(m+(A-P)),w=m;P!==A;)N[w++]=b[P++];return N}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var i8=n8,o8=i8,_0=o8;var iC=new Uint8Array(0);var A0=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},vr=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var D0=t=>new TextEncoder().encode(t),T0=t=>new TextDecoder().decode(t);var hl=class{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},fl=class{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return O0(this,e)}},dl=class{constructor(e){this.decoders=e}or(e){return O0(this,e)}decode(e){let r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},O0=(t,e)=>new dl({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),pl=class{constructor(e,r,s,n){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=n,this.encoder=new hl(e,r,s),this.decoder=new fl(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},on=({name:t,prefix:e,encode:r,decode:s})=>new pl(t,e,r,s),Hr=({prefix:t,name:e,alphabet:r})=>{let{encode:s,decode:n}=_0(r,e);return on({prefix:t,name:e,encode:s,decode:i=>vr(n(i))})},a8=(t,e,r,s)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,c=0,u=0;for(let l=0;l<i;++l){let h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},c8=(t,e,r)=>{let s=e[e.length-1]==="=",n=(1<<r)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[n&a>>o];if(o&&(i+=e[n&a<<r-o]),s)for(;i.length*r&7;)i+="=";return i},ye=({name:t,prefix:e,bitsPerChar:r,alphabet:s})=>on({prefix:e,name:t,encode(n){return c8(n,s,r)},decode(n){return a8(n,s,r,t)}});var u8=on({prefix:"\0",name:"identity",encode:t=>T0(t),decode:t=>D0(t)});var ml={};Ne(ml,{base2:()=>l8});var l8=ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var yl={};Ne(yl,{base8:()=>h8});var h8=ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var wl={};Ne(wl,{base10:()=>f8});var f8=Hr({prefix:"9",name:"base10",alphabet:"0123456789"});var bl={};Ne(bl,{base16:()=>d8,base16upper:()=>p8});var d8=ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),p8=ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var El={};Ne(El,{base32:()=>an,base32hex:()=>w8,base32hexpad:()=>E8,base32hexpadupper:()=>x8,base32hexupper:()=>b8,base32pad:()=>m8,base32padupper:()=>y8,base32upper:()=>g8,base32z:()=>v8});var an=ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),g8=ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),m8=ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),y8=ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),w8=ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),b8=ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),E8=ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),x8=ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),v8=ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var xl={};Ne(xl,{base36:()=>I8,base36upper:()=>S8});var I8=Hr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),S8=Hr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vl={};Ne(vl,{base58btc:()=>tr,base58flickr:()=>_8});var tr=Hr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_8=Hr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Il={};Ne(Il,{base64:()=>A8,base64pad:()=>D8,base64url:()=>T8,base64urlpad:()=>R8});var A8=ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),D8=ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),T8=ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),R8=ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Sl={};Ne(Sl,{base256emoji:()=>P8});var C0=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),O8=C0.reduce((t,e,r)=>(t[r]=e,t),[]),C8=C0.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function B8(t){return t.reduce((e,r)=>(e+=O8[r],e),"")}function N8(t){let e=[];for(let r of t){let s=C8[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}var P8=on({prefix:"\u{1F680}",name:"base256emoji",encode:B8,decode:N8});var Tl={};Ne(Tl,{sha256:()=>Q8,sha512:()=>eI});var U8=P0,B0=128,F8=127,L8=~F8,k8=Math.pow(2,31);function P0(t,e,r){e=e||[],r=r||0;for(var s=r;t>=k8;)e[r++]=t&255|B0,t/=128;for(;t&L8;)e[r++]=t&255|B0,t>>>=7;return e[r]=t|0,P0.bytes=r-s+1,e}var M8=_l,q8=128,N0=127;function _l(t,s){var r=0,s=s||0,n=0,i=s,o,a=t.length;do{if(i>=a)throw _l.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=n<28?(o&N0)<<n:(o&N0)*Math.pow(2,n),n+=7}while(o>=q8);return _l.bytes=i-s,r}var z8=Math.pow(2,7),j8=Math.pow(2,14),V8=Math.pow(2,21),$8=Math.pow(2,28),H8=Math.pow(2,35),K8=Math.pow(2,42),G8=Math.pow(2,49),W8=Math.pow(2,56),Y8=Math.pow(2,63),J8=function(t){return t<z8?1:t<j8?2:t<V8?3:t<$8?4:t<H8?5:t<K8?6:t<G8?7:t<W8?8:t<Y8?9:10},Z8={encode:U8,decode:M8,encodingLength:J8},X8=Z8,hi=X8;var fi=(t,e=0)=>[hi.decode(t,e),hi.decode.bytes],cn=(t,e,r=0)=>(hi.encode(t,e,r),e),un=t=>hi.encodingLength(t);var Ds=(t,e)=>{let r=e.byteLength,s=un(t),n=s+un(r),i=new Uint8Array(n+r);return cn(t,i,0),cn(r,i,s),i.set(e,n),new ln(t,r,e,i)},U0=t=>{let e=vr(t),[r,s]=fi(e),[n,i]=fi(e.subarray(s)),o=e.subarray(s+i);if(o.byteLength!==n)throw new Error("Incorrect length");return new ln(r,n,o,e)},F0=(t,e)=>t===e?!0:t.code===e.code&&t.size===e.size&&A0(t.bytes,e.bytes),ln=class{constructor(e,r,s,n){this.code=e,this.size=r,this.digest=s,this.bytes=n}};var Dl=({name:t,code:e,encode:r})=>new Al(t,e,r),Al=class{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Ds(this.code,r):r.then(s=>Ds(this.code,s))}else throw Error("Unknown type, must be binary type")}};var k0=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Q8=Dl({name:"sha2-256",code:18,encode:k0("SHA-256")}),eI=Dl({name:"sha2-512",code:19,encode:k0("SHA-512")});var Rl={};Ne(Rl,{identity:()=>sI});var M0=0,tI="identity",q0=vr,rI=t=>Ds(M0,q0(t)),sI={code:M0,name:tI,encode:q0,digest:rI};var AC=new TextEncoder,DC=new TextDecoder;var va=class t{constructor(e,r,s,n){this.code=r,this.version=e,this.multihash=s,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:xa,byteLength:xa,code:Ea,version:Ea,multihash:Ea,bytes:Ea,_baseCache:xa,asCID:xa})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==pi)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==uI)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,s=Ds(e,r);return t.createV1(this.code,s)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&F0(this.multihash,e.multihash)}toString(e){let{bytes:r,version:s,_baseCache:n}=this;switch(s){case 0:return aI(r,n,e||tr.encoder);default:return cI(r,n,e||an.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return hI(/^0\.0/,fI),!!(e&&(e[j0]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof t)return e;if(e!=null&&e.asCID===e){let{version:r,code:s,multihash:n,bytes:i}=e;return new t(r,s,n,i||z0(r,s,n.bytes))}else if(e!=null&&e[j0]===!0){let{version:r,multihash:s,code:n}=e,i=U0(s);return t.create(r,n,i)}else return null}static create(e,r,s){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==pi)throw new Error(`Version 0 CID must use dag-pb (code: ${pi}) block encoding`);return new t(e,r,s,s.bytes)}case 1:{let n=z0(e,r,s.bytes);return new t(e,r,s,n)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,pi,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,s]=t.decodeFirst(e);if(s.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),s=r.size-r.multihashSize,n=vr(e.subarray(s,s+r.multihashSize));if(n.byteLength!==r.multihashSize)throw new Error("Incorrect length");let i=n.subarray(r.multihashSize-r.digestSize),o=new ln(r.multihashCode,r.digestSize,i,n);return[r.version===0?t.createV0(o):t.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,s=()=>{let[h,f]=fi(e.subarray(r));return r+=f,h},n=s(),i=pi;if(n===18?(n=0,r=0):n===1&&(i=s()),n!==0&&n!==1)throw new RangeError(`Invalid CID version ${n}`);let o=r,a=s(),c=s(),u=r+c,l=u-o;return{version:n,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,r){let[s,n]=oI(e,r),i=t.decode(n);return i._baseCache.set(s,e),i}},oI=(t,e)=>{switch(t[0]){case"Q":{let r=e||tr;return[tr.prefix,r.decode(`${tr.prefix}${t}`)]}case tr.prefix:{let r=e||tr;return[tr.prefix,r.decode(t)]}case an.prefix:{let r=e||an;return[an.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},aI=(t,e,r)=>{let{prefix:s}=r;if(s!==tr.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let n=e.get(s);if(n==null){let i=r.encode(t).slice(1);return e.set(s,i),i}else return n},cI=(t,e,r)=>{let{prefix:s}=r,n=e.get(s);if(n==null){let i=r.encode(t);return e.set(s,i),i}else return n},pi=112,uI=18,z0=(t,e,r)=>{let s=un(t),n=s+un(e),i=new Uint8Array(n+r.byteLength);return cn(t,i,0),cn(e,i,s),i.set(r,n),i},j0=Symbol.for("@ipld/js-cid/CID"),Ea={writable:!1,configurable:!1,enumerable:!0},xa={writable:!1,enumerable:!1,configurable:!1},lI="0.0.0-dev",hI=(t,e)=>{if(t.test(lI))console.warn(e);else throw new Error(e)},fI=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var Ol={...gl,...ml,...yl,...wl,...bl,...El,...xl,...vl,...Il,...Sl},UC={...Tl,...Rl};function $0(t,e,r,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:s}}}var V0=$0("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Cl=$0("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=li(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),dI={utf8:V0,"utf-8":V0,hex:Ol.base16,latin1:Cl,ascii:Cl,binary:Cl,...Ol},Ia=dI;function ht(t,e="utf8"){let r=Ia[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?_s(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Fe(t,e="utf8"){let r=Ia[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var H0={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Hm=De(hm()),II=":";function Oi(t){let[e,r]=t.split(II);return{namespace:e,reference:r}}function Km(t,e){return t.includes(":")?[t]:e.chains||[]}var SI=Object.defineProperty,_I=Object.defineProperties,AI=Object.getOwnPropertyDescriptors,fm=Object.getOwnPropertySymbols,DI=Object.prototype.hasOwnProperty,TI=Object.prototype.propertyIsEnumerable,$l=(t,e,r)=>e in t?SI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dm=(t,e)=>{for(var r in e||(e={}))DI.call(e,r)&&$l(t,r,e[r]);if(fm)for(var r of fm(e))TI.call(e,r)&&$l(t,r,e[r]);return t},RI=(t,e)=>_I(t,AI(e)),pm=(t,e,r)=>$l(t,typeof e!="symbol"?e+"":e,r),OI="ReactNative",pt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};var CI="js";function Ci(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Tr(){return!(0,Vt.getDocument)()&&!!(0,Vt.getNavigator)()&&navigator.product===OI}function Gm(){return Tr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Wm(){return Tr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ps(){return!Ci()&&!!(0,Vt.getNavigator)()&&!!(0,Vt.getDocument)()}function Bi(){return Tr()?pt.reactNative:Ci()?pt.node:Ps()?pt.browser:pt.unknown}function ch(){var t;try{return Tr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function BI(t,e){let r=new URLSearchParams(t);for(let s of Object.keys(e).sort())if(e.hasOwnProperty(s)){let n=e[s];n!==void 0&&r.set(s,n)}return r.toString()}function Ym(t){var e,r;let s=uh();try{return t!=null&&t.url&&s.url&&new URL(t.url).host!==new URL(s.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${s.url}. This is probably unintended and can lead to issues.`),t.url=s.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),RI(dm(dm({},s),t),{url:t?.url||s.url,name:t?.name||s.name,description:t?.description||s.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:s.icons})}catch(n){return console.warn("Error populating app metadata",n),t||s}}function uh(){return(0,$m.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function NI(){if(Bi()===pt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:r,Version:s}=global.Platform;return[r,s].join("-")}let t=jp();if(t===null)return"unknown";let e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function PI(){var t;let e=Bi();return e===pt.browser?[e,((t=(0,Vt.getLocation)())==null?void 0:t.host)||"unknown"].join(":"):e}function lh(t,e,r){let s=NI(),n=PI();return[[t,e].join("-"),[CI,r].join("-"),s,n].join("/")}function Jm({protocol:t,version:e,relayUrl:r,sdkVersion:s,auth:n,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){let u=r.split("?"),l=lh(t,e,s),h={auth:n,ua:l,projectId:i,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=BI(u[1]||"",h);return u[0]+"?"+f}function Ts(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Ma(t){return Object.fromEntries(t.entries())}function qa(t){return new Map(Object.entries(t))}function Rr(t=Ar.FIVE_MINUTES,e){let r=(0,Ar.toMiliseconds)(t||Ar.FIVE_MINUTES),s,n,i,o;return{resolve:a=>{i&&s&&(clearTimeout(i),s(a),o=Promise.resolve(a))},reject:a=>{i&&n&&(clearTimeout(i),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{let u=new Error(e);o=Promise.reject(u),c(u)},r),s=a,n=c})}}function $t(t,e,r){return new Promise(async(s,n)=>{let i=setTimeout(()=>n(new Error(r)),e);try{let o=await t;s(o)}catch(o){n(o)}clearTimeout(i)})}function Zm(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Xm(t){return Zm("topic",t)}function Qm(t){return Zm("id",t)}function za(t){let[e,r]=t.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")s.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return s}function Se(t,e){return(0,Ar.fromMiliseconds)((e||Date.now())+(0,Ar.toMiliseconds)(t))}function sr(t){return Date.now()>=(0,Ar.toMiliseconds)(t)}function ne(t,e){return`${t}${e?`:${e}`:""}`}function Bs(t=[],e=[]){return[...new Set([...t,...e])]}async function ey({id:t,topic:e,wcDeepLink:r}){var s;try{if(!r)return;let n=typeof r=="string"?JSON.parse(r):r,i=n?.href;if(typeof i!="string")return;let o=UI(i,t,e),a=Bi();if(a===pt.browser){if(!((s=(0,Vt.getDocument)())!=null&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}FI(o)}else a===pt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function UI(t,e,r){let s=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){let i=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${i}${MI(s,!0)}`}else n=`${n}/wc?${s}`;return n}function FI(t){let e="_self";kI()?e="_top":(LI()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function ty(t,e){let r="";try{if(Ps()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(s){console.error(s)}return r}function hh(t,e){if(!t.includes(e))return null;let r=t.split(/([&,?,=])/),s=r.indexOf(e);return r[s+2]}function fh(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ni(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function LI(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function kI(){try{return window.self!==window.top}catch{return!1}}function MI(t,e=!1){let r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function ry(t){return Buffer.from(t,"base64").toString("utf-8")}function sy(t){return new Promise(e=>setTimeout(e,t))}var Na=class{constructor({limit:e}){pm(this,"limit"),pm(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}},Ta=BigInt(2**32-1),gm=BigInt(32);function ny(t,e=!1){return e?{h:Number(t&Ta),l:Number(t>>gm&Ta)}:{h:Number(t>>gm&Ta)|0,l:Number(t&Ta)|0}}function iy(t,e=!1){let r=t.length,s=new Uint32Array(r),n=new Uint32Array(r);for(let i=0;i<r;i++){let{h:o,l:a}=ny(t[i],e);[s[i],n[i]]=[o,a]}return[s,n]}var mm=(t,e,r)=>t>>>r,ym=(t,e,r)=>t<<32-r|e>>>r,ts=(t,e,r)=>t>>>r|e<<32-r,rs=(t,e,r)=>t<<32-r|e>>>r,Ei=(t,e,r)=>t<<64-r|e>>>r-32,xi=(t,e,r)=>t>>>r-32|e<<64-r,qI=(t,e)=>e,zI=(t,e)=>t,jI=(t,e,r)=>t<<r|e>>>32-r,VI=(t,e,r)=>e<<r|t>>>32-r,$I=(t,e,r)=>e<<r-32|t>>>64-r,HI=(t,e,r)=>t<<r-32|e>>>64-r;function zt(t,e,r,s){let n=(e>>>0)+(s>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}var dh=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),ph=(t,e,r,s)=>e+r+s+(t/2**32|0)|0,KI=(t,e,r,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0),GI=(t,e,r,s,n)=>e+r+s+n+(t/2**32|0)|0,WI=(t,e,r,s,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0)+(n>>>0),YI=(t,e,r,s,n,i)=>e+r+s+n+i+(t/2**32|0)|0,hn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function gh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Dr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ot(t,...e){if(!gh(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function mh(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Dr(t.outputLen),Dr(t.blockLen)}function is(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function yh(t,e){Ot(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ai(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ct(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Ul(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function rr(t,e){return t<<32-e|t>>>e}var oy=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ay(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}var Sr=oy?t=>t:t=>ay(t);function JI(t){for(let e=0;e<t.length;e++)t[e]=ay(t[e]);return t}var ss=oy?t=>t:JI,cy=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ZI=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Di(t){if(Ot(t),cy)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=ZI[t[r]];return e}var Ir={_0:48,_9:57,A:65,F:70,a:97,f:102};function wm(t){if(t>=Ir._0&&t<=Ir._9)return t-Ir._0;if(t>=Ir.A&&t<=Ir.F)return t-(Ir.A-10);if(t>=Ir.a&&t<=Ir.f)return t-(Ir.a-10)}function wh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(cy)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let s=new Uint8Array(r);for(let n=0,i=0;n<r;n++,i+=2){let o=wm(t.charCodeAt(i)),a=wm(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}s[n]=o*16+a}return s}function XI(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function jt(t){return typeof t=="string"&&(t=XI(t)),Ot(t),t}function Rs(...t){let e=0;for(let s=0;s<t.length;s++){let n=t[s];Ot(n),e+=n.length}let r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){let i=t[s];r.set(i,n),n+=i.length}return r}var dn=class{};function Pi(t){let e=s=>t().update(jt(s)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function QI(t){let e=(s,n)=>t(n).update(jt(s)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=s=>t(s),e}function mn(t=32){if(hn&&typeof hn.getRandomValues=="function")return hn.getRandomValues(new Uint8Array(t));if(hn&&typeof hn.randomBytes=="function")return Uint8Array.from(hn.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var eS=BigInt(0),wi=BigInt(1),tS=BigInt(2),rS=BigInt(7),sS=BigInt(256),nS=BigInt(113),uy=[],ly=[],hy=[];for(let t=0,e=wi,r=1,s=0;t<24;t++){[r,s]=[s,(2*r+3*s)%5],uy.push(2*(5*s+r)),ly.push((t+1)*(t+2)/2%64);let n=eS;for(let i=0;i<7;i++)e=(e<<wi^(e>>rS)*nS)%sS,e&tS&&(n^=wi<<(wi<<BigInt(i))-wi);hy.push(n)}var fy=iy(hy,!0),iS=fy[0],oS=fy[1],bm=(t,e,r)=>r>32?$I(t,e,r):jI(t,e,r),Em=(t,e,r)=>r>32?HI(t,e,r):VI(t,e,r);function aS(t,e=24){let r=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=bm(u,l,1)^r[a],f=Em(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let n=t[2],i=t[3];for(let o=0;o<24;o++){let a=ly[o],c=bm(n,i,a),u=Em(n,i,a),l=uy[o];n=t[l],i=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=iS[s],t[1]^=oS[s]}Ct(r)}var Hl=class t extends dn{constructor(e,r,s,n=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=s,this.enableXOF=n,this.rounds=i,Dr(s),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ai(this.state)}clone(){return this._cloneInto()}keccak(){ss(this.state32),aS(this.state32,this.rounds),ss(this.state32),this.posOut=0,this.pos=0}update(e){is(this),e=jt(e),Ot(e);let{blockLen:r,state:s}=this,n=e.length;for(let i=0;i<n;){let o=Math.min(r-this.pos,n-i);for(let a=0;a<o;a++)s[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:r,pos:s,blockLen:n}=this;e[s]^=r,r&128&&s===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){is(this,!1),Ot(e),this.finish();let r=this.state,{blockLen:s}=this;for(let n=0,i=e.length;n<i;){this.posOut>=s&&this.keccak();let o=Math.min(s-this.posOut,i-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Dr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(yh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ct(this.state)}_cloneInto(e){let{blockLen:r,suffix:s,outputLen:n,rounds:i,enableXOF:o}=this;return e||(e=new t(r,s,n,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=s,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}},cS=(t,e,r)=>Pi(()=>new Hl(e,t,r)),uS=cS(1,136,256/8);function lS(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);let n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,u=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+u,a,s)}function hS(t,e,r){return t&e^~t&r}function fS(t,e,r){return t&e^t&r^e&r}var Pa=class extends dn{constructor(e,r,s,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=s,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Ul(this.buffer)}update(e){is(this),e=jt(e),Ot(e);let{view:r,buffer:s,blockLen:n}=this,i=e.length;for(let o=0;o<i;){let a=Math.min(n-this.pos,i-o);if(a===n){let c=Ul(e);for(;n<=i-o;o+=n)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){is(this),yh(e,this),this.finished=!0;let{buffer:r,view:s,blockLen:n,isLE:i}=this,{pos:o}=this;r[o++]=128,Ct(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(s,0),o=0);for(let h=o;h<n;h++)r[h]=0;lS(s,n-8,BigInt(this.length*8),i),this.process(s,0);let a=Ul(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:s,length:n,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=n,e.pos=a,n%r&&e.buffer.set(s),e}clone(){return this._cloneInto()}},Yr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ge=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),We=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),dS=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jr=new Uint32Array(64),Kl=class extends Pa{constructor(e=32){super(64,e,8,!1),this.A=Yr[0]|0,this.B=Yr[1]|0,this.C=Yr[2]|0,this.D=Yr[3]|0,this.E=Yr[4]|0,this.F=Yr[5]|0,this.G=Yr[6]|0,this.H=Yr[7]|0}get(){let{A:e,B:r,C:s,D:n,E:i,F:o,G:a,H:c}=this;return[e,r,s,n,i,o,a,c]}set(e,r,s,n,i,o,a,c){this.A=e|0,this.B=r|0,this.C=s|0,this.D=n|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Jr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){let f=Jr[h-15],p=Jr[h-2],d=rr(f,7)^rr(f,18)^f>>>3,g=rr(p,17)^rr(p,19)^p>>>10;Jr[h]=g+Jr[h-7]+d+Jr[h-16]|0}let{A:s,B:n,C:i,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){let f=rr(a,6)^rr(a,11)^rr(a,25),p=l+f+hS(a,c,u)+dS[h]+Jr[h]|0,d=(rr(s,2)^rr(s,13)^rr(s,22))+fS(s,n,i)|0;l=u,u=c,c=a,a=o+p|0,o=i,i=n,n=s,s=p+d|0}s=s+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(s,n,i,o,a,c,u,l)}roundClean(){Ct(Jr)}destroy(){this.set(0,0,0,0,0,0,0,0),Ct(this.buffer)}},dy=iy(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),pS=dy[0],gS=dy[1],Zr=new Uint32Array(80),Xr=new Uint32Array(80),Ti=class extends Pa{constructor(e=64){super(128,e,16,!1),this.Ah=We[0]|0,this.Al=We[1]|0,this.Bh=We[2]|0,this.Bl=We[3]|0,this.Ch=We[4]|0,this.Cl=We[5]|0,this.Dh=We[6]|0,this.Dl=We[7]|0,this.Eh=We[8]|0,this.El=We[9]|0,this.Fh=We[10]|0,this.Fl=We[11]|0,this.Gh=We[12]|0,this.Gl=We[13]|0,this.Hh=We[14]|0,this.Hl=We[15]|0}get(){let{Ah:e,Al:r,Bh:s,Bl:n,Ch:i,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:m}=this;return[e,r,s,n,i,o,a,c,u,l,h,f,p,d,g,m]}set(e,r,s,n,i,o,a,c,u,l,h,f,p,d,g,m){this.Ah=e|0,this.Al=r|0,this.Bh=s|0,this.Bl=n|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)Zr[b]=e.getUint32(r),Xr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){let E=Zr[b-15]|0,v=Xr[b-15]|0,O=ts(E,v,1)^ts(E,v,8)^mm(E,v,7),P=rs(E,v,1)^rs(E,v,8)^ym(E,v,7),N=Zr[b-2]|0,w=Xr[b-2]|0,C=ts(N,w,19)^Ei(N,w,61)^mm(N,w,6),_=rs(N,w,19)^xi(N,w,61)^ym(N,w,6),T=KI(P,_,Xr[b-7],Xr[b-16]),B=GI(T,O,C,Zr[b-7],Zr[b-16]);Zr[b]=B|0,Xr[b]=T|0}let{Ah:s,Al:n,Bh:i,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:m,Hh:S,Hl:A}=this;for(let b=0;b<80;b++){let E=ts(h,f,14)^ts(h,f,18)^Ei(h,f,41),v=rs(h,f,14)^rs(h,f,18)^xi(h,f,41),O=h&p^~h&g,P=f&d^~f&m,N=WI(A,v,P,gS[b],Xr[b]),w=YI(N,S,E,O,pS[b],Zr[b]),C=N|0,_=ts(s,n,28)^Ei(s,n,34)^Ei(s,n,39),T=rs(s,n,28)^xi(s,n,34)^xi(s,n,39),B=s&i^s&a^i&a,L=n&o^n&c^o&c;S=g|0,A=m|0,g=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=zt(u|0,l|0,w|0,C|0),u=a|0,l=c|0,a=i|0,c=o|0,i=s|0,o=n|0;let x=dh(C,T,L);s=ph(x,w,_,B),n=x|0}({h:s,l:n}=zt(this.Ah|0,this.Al|0,s|0,n|0)),{h:i,l:o}=zt(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=zt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=zt(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=zt(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=zt(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:m}=zt(this.Gh|0,this.Gl|0,g|0,m|0),{h:S,l:A}=zt(this.Hh|0,this.Hl|0,S|0,A|0),this.set(s,n,i,o,a,c,u,l,h,f,p,d,g,m,S,A)}roundClean(){Ct(Zr,Xr)}destroy(){Ct(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Gl=class extends Ti{constructor(){super(48),this.Ah=Ge[0]|0,this.Al=Ge[1]|0,this.Bh=Ge[2]|0,this.Bl=Ge[3]|0,this.Ch=Ge[4]|0,this.Cl=Ge[5]|0,this.Dh=Ge[6]|0,this.Dl=Ge[7]|0,this.Eh=Ge[8]|0,this.El=Ge[9]|0,this.Fh=Ge[10]|0,this.Fl=Ge[11]|0,this.Gh=Ge[12]|0,this.Gl=Ge[13]|0,this.Hh=Ge[14]|0,this.Hl=Ge[15]|0}},Ye=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]),Wl=class extends Ti{constructor(){super(32),this.Ah=Ye[0]|0,this.Al=Ye[1]|0,this.Bh=Ye[2]|0,this.Bl=Ye[3]|0,this.Ch=Ye[4]|0,this.Cl=Ye[5]|0,this.Dh=Ye[6]|0,this.Dl=Ye[7]|0,this.Eh=Ye[8]|0,this.El=Ye[9]|0,this.Fh=Ye[10]|0,this.Fl=Ye[11]|0,this.Gh=Ye[12]|0,this.Gl=Ye[13]|0,this.Hh=Ye[14]|0,this.Hl=Ye[15]|0}},ja=Pi(()=>new Kl),mS=Pi(()=>new Ti),yS=Pi(()=>new Gl),wS=Pi(()=>new Wl),bS=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Oe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function Qr(t,e,r,s,n,i){let o=n[i],a=n[i+1],c=z[2*t],u=z[2*t+1],l=z[2*e],h=z[2*e+1],f=z[2*r],p=z[2*r+1],d=z[2*s],g=z[2*s+1],m=dh(c,l,o);u=ph(m,u,h,a),c=m|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:qI(g,d),Dl:zI(g)},{h:p,l:f}=zt(p,f,g,d),{Bh:h,Bl:l}={Bh:h^p,Bl:l^f},{Bh:h,Bl:l}={Bh:ts(h,l,24),Bl:rs(h,l,24)},z[2*t]=c,z[2*t+1]=u,z[2*e]=l,z[2*e+1]=h,z[2*r]=f,z[2*r+1]=p,z[2*s]=d,z[2*s+1]=g}function es(t,e,r,s,n,i){let o=n[i],a=n[i+1],c=z[2*t],u=z[2*t+1],l=z[2*e],h=z[2*e+1],f=z[2*r],p=z[2*r+1],d=z[2*s],g=z[2*s+1],m=dh(c,l,o);u=ph(m,u,h,a),c=m|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:ts(g,d,16),Dl:rs(g,d,16)},{h:p,l:f}=zt(p,f,g,d),{Bh:h,Bl:l}={Bh:h^p,Bl:l^f},{Bh:h,Bl:l}={Bh:Ei(h,l,63),Bl:xi(h,l,63)},z[2*t]=c,z[2*t+1]=u,z[2*e]=l,z[2*e+1]=h,z[2*r]=f,z[2*r+1]=p,z[2*s]=d,z[2*s+1]=g}function ES(t,e={},r,s,n){if(Dr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");let{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==s)throw new Error("salt must be undefined or "+s);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}var Yl=class extends dn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Dr(e),Dr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Ai(this.buffer)}update(e){is(this),e=jt(e),Ot(e);let{blockLen:r,buffer:s,buffer32:n}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(ss(n),this.compress(n,0,!1),ss(n),this.pos=0);let u=Math.min(r-this.pos,i-c),l=o+c;if(u===r&&!(l%4)&&c+u<i){let h=new Uint32Array(a,l,Math.floor((i-c)/4));ss(h);for(let f=0;c+r<i;f+=n.length,c+=r)this.length+=r,this.compress(h,f,!1);ss(h);continue}s.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){is(this),yh(e,this);let{pos:r,buffer32:s}=this;this.finished=!0,Ct(this.buffer.subarray(r)),ss(s),this.compress(s,0,!0),ss(s);let n=Ai(e);this.get().forEach((i,o)=>n[o]=Sr(i))}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){let{buffer:r,length:s,finished:n,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=n,e.length=s,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},Jl=class extends Yl{constructor(e={}){let r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Oe[0]|0,this.v0h=Oe[1]|0,this.v1l=Oe[2]|0,this.v1h=Oe[3]|0,this.v2l=Oe[4]|0,this.v2h=Oe[5]|0,this.v3l=Oe[6]|0,this.v3h=Oe[7]|0,this.v4l=Oe[8]|0,this.v4h=Oe[9]|0,this.v5l=Oe[10]|0,this.v5h=Oe[11]|0,this.v6l=Oe[12]|0,this.v6h=Oe[13]|0,this.v7l=Oe[14]|0,this.v7h=Oe[15]|0,ES(r,e,64,16,16);let{key:s,personalization:n,salt:i}=e,o=0;if(s!==void 0&&(s=jt(s),o=s.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=jt(i);let a=Ai(i);this.v4l^=Sr(a[0]),this.v4h^=Sr(a[1]),this.v5l^=Sr(a[2]),this.v5h^=Sr(a[3])}if(n!==void 0){n=jt(n);let a=Ai(n);this.v6l^=Sr(a[0]),this.v6h^=Sr(a[1]),this.v7l^=Sr(a[2]),this.v7h^=Sr(a[3])}if(s!==void 0){let a=new Uint8Array(this.blockLen);a.set(s),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:s,v1h:n,v2l:i,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:p,v6h:d,v7l:g,v7h:m}=this;return[e,r,s,n,i,o,a,c,u,l,h,f,p,d,g,m]}set(e,r,s,n,i,o,a,c,u,l,h,f,p,d,g,m){this.v0l=e|0,this.v0h=r|0,this.v1l=s|0,this.v1h=n|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=m|0}compress(e,r,s){this.get().forEach((c,u)=>z[u]=c),z.set(Oe,16);let{h:n,l:i}=ny(BigInt(this.length));z[24]=Oe[8]^i,z[25]=Oe[9]^n,s&&(z[28]=~z[28],z[29]=~z[29]);let o=0,a=bS;for(let c=0;c<12;c++)Qr(0,4,8,12,e,r+2*a[o++]),es(0,4,8,12,e,r+2*a[o++]),Qr(1,5,9,13,e,r+2*a[o++]),es(1,5,9,13,e,r+2*a[o++]),Qr(2,6,10,14,e,r+2*a[o++]),es(2,6,10,14,e,r+2*a[o++]),Qr(3,7,11,15,e,r+2*a[o++]),es(3,7,11,15,e,r+2*a[o++]),Qr(0,5,10,15,e,r+2*a[o++]),es(0,5,10,15,e,r+2*a[o++]),Qr(1,6,11,12,e,r+2*a[o++]),es(1,6,11,12,e,r+2*a[o++]),Qr(2,7,8,13,e,r+2*a[o++]),es(2,7,8,13,e,r+2*a[o++]),Qr(3,4,9,14,e,r+2*a[o++]),es(3,4,9,14,e,r+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],Ct(z)}destroy(){this.destroyed=!0,Ct(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},xS=QI(t=>new Jl(t)),vS="https://rpc.walletconnect.org/v1";function py(t){let e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(uS(r)).toString("hex")}async function IS(t,e,r,s,n,i){switch(r.t){case"eip191":return await SS(t,e,r.s);case"eip1271":return await _S(t,e,r.s,s,n,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function SS(t,e,r){return(await tl({hash:py(e),signature:r})).toLowerCase()===t.toLowerCase()}async function _S(t,e,r,s,n,i){let o=Oi(s);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${s}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=r.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:py(e)).substring(2),f=a+h+c+l+u,p=await fetch(`${i||vS}/?chainId=${s}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:AS(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function AS(){return Date.now()+Math.floor(Math.random()*1e3)}function gy(t){let e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);let s=r[0];if(s===0)throw new Error("No signatures found");let n=1+s*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");let i=Buffer.from(t,"base64").slice(1,65);return nn.encode(i)}function my(t){let e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),s=new Uint8Array(r.length+e.length);s.set(r),s.set(e,r.length);let n=xS(s,{dkLen:32});return nn.encode(n)}function bh(t){let e=new Uint8Array(ja(DS(t)));return nn.encode(e)}function DS(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Eh(t){let e=Buffer.from(t,"base64"),r=al(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");let s=sl(r),n=Buffer.from("TX"),i=Buffer.concat([n,Buffer.from(s)]),o=wS(i);return S0.encode(o).replace(/=+$/,"")}function Fl(t){let e=[],r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function yy(t){let e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),s=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(Fl(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(Fl(r.length)),n.push(r),n.push(Buffer.from([26])),n.push(Fl(s.length)),n.push(s);let i=Buffer.concat(n),o=ja(i);return Buffer.from(o).toString("hex").toUpperCase()}var TS=Object.defineProperty,RS=Object.defineProperties,OS=Object.getOwnPropertyDescriptors,xm=Object.getOwnPropertySymbols,CS=Object.prototype.hasOwnProperty,BS=Object.prototype.propertyIsEnumerable,vm=(t,e,r)=>e in t?TS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,NS=(t,e)=>{for(var r in e||(e={}))CS.call(e,r)&&vm(t,r,e[r]);if(xm)for(var r of xm(e))BS.call(e,r)&&vm(t,r,e[r]);return t},PS=(t,e)=>RS(t,OS(e)),US="did:pkh:",xh=t=>t?.split(":"),FS=t=>{let e=t&&xh(t);if(e)return t.includes(US)?e[3]:e[1]},Va=t=>{let e=t&&xh(t);if(e)return e[2]+":"+e[3]},Ui=t=>{let e=t&&xh(t);if(e)return e.pop()};async function vh(t){let{cacao:e,projectId:r}=t,{s,p:n}=e,i=Ih(n,n.iss),o=Ui(n.iss);return await IS(o,i,s,Va(n.iss),r)}var Ih=(t,e)=>{let r=`${t.domain} wants you to sign in with your Ethereum account:`,s=Ui(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=t.statement||void 0,i=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${FS(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,d=Fi(t.resources);if(d){let g=Ri(d);n=VS(n,g)}return[r,s,"",n,"",i,o,a,c,u,l,h,f,p].filter(g=>g!=null).join(`
`)};function LS(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function kS(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Ns(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");let e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{let s=t.att[r];if(Array.isArray(s))throw new Error(`Resource must be an object: ${r}`);if(typeof s!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(s).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(s).forEach(n=>{let i=s[n];if(!Array.isArray(i))throw new Error(`Ability limits ${n} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function MS(t,e,r,s={}){return r?.sort((n,i)=>n.localeCompare(i)),{att:{[t]:qS(e,r,s)}}}function qS(t,e,r={}){e=e?.sort((n,i)=>n.localeCompare(i));let s=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...s)}function wy(t){return Ns(t),`urn:recap:${LS(t).replace(/=/g,"")}`}function Ri(t){let e=kS(t.replace("urn:recap:",""));return Ns(e),e}function by(t,e,r){let s=MS(t,e,r);return wy(s)}function zS(t){return t&&t.includes("urn:recap:")}function Ey(t,e){let r=Ri(t),s=Ri(e),n=jS(r,s);return wy(n)}function jS(t,e){Ns(t),Ns(e);let r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,i)=>n.localeCompare(i)),s={att:{}};return r.forEach(n=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;s.att[n]=PS(NS({},s.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((u=e.att[n])==null?void 0:u[a])})})}),s}function VS(t="",e){Ns(e);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;let s=[],n=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));let u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});let l=Object.keys(u).map(h=>(n++,`(${n}) '${h}': '${u[h].join("', '")}' for '${a}'.`));s.push(l.join(", ").replace(".,","."))});let i=s.join(" "),o=`${r}${i}`;return`${t?t+" ":""}${o}`}function Sh(t){var e;let r=Ri(t);Ns(r);let s=(e=r.att)==null?void 0:e.eip155;return s?Object.keys(s).map(n=>n.split("/")[1]):[]}function _h(t){let e=Ri(t);Ns(e);let r=[];return Object.values(e.att).forEach(s=>{Object.values(s).forEach(n=>{var i;(i=n?.[0])!=null&&i.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function Fi(t){if(!t)return;let e=t?.[t.length-1];return zS(e)?e:void 0}function xy(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zl(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Ll(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function dt(t,...e){if(!xy(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Im(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function $S(t,e){dt(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ns(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function pn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function HS(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}var KS=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function GS(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Xl(t){if(typeof t=="string")t=GS(t);else if(xy(t))t=Ql(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function WS(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function YS(t,e){if(t.length!==e.length)return!1;let r=0;for(let s=0;s<t.length;s++)r|=t[s]^e[s];return r===0}var JS=(t,e)=>{function r(s,...n){if(dt(s),!KS)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){let u=n[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?dt(u):dt(u,t.nonceLength)}let i=t.tagLength;i&&n[1]!==void 0&&dt(n[1]);let o=e(s,...n),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");dt(l)}},c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,dt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(dt(u),i&&u.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Sm(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!XS(e))throw new Error("invalid output, must be aligned");return e}function _m(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);let n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,u=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+u,a,s)}function ZS(t,e,r){Zl(r);let s=new Uint8Array(16),n=HS(s);return _m(n,0,BigInt(e),r),_m(n,8,BigInt(t),r),s}function XS(t){return t.byteOffset%4===0}function Ql(t){return Uint8Array.from(t)}var vy=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),QS=vy("expand 16-byte k"),e_=vy("expand 32-byte k"),t_=ns(QS),r_=ns(e_);function se(t,e){return t<<e|t>>>32-e}function eh(t){return t.byteOffset%4===0}var Ra=64,s_=16,Iy=2**32-1,Am=new Uint32Array;function n_(t,e,r,s,n,i,o,a){let c=n.length,u=new Uint8Array(Ra),l=ns(u),h=eh(n)&&eh(i),f=h?ns(n):Am,p=h?ns(i):Am;for(let d=0;d<c;o++){if(t(e,r,s,l,o,a),o>=Iy)throw new Error("arx: counter overflow");let g=Math.min(Ra,c-d);if(h&&g===Ra){let m=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let S=0,A;S<s_;S++)A=m+S,p[A]=f[A]^l[S];d+=Ra;continue}for(let m=0,S;m<g;m++)S=d+m,i[S]=n[S]^u[m];d+=g}}function i_(t,e){let{allowShortKeys:r,extendNonceFn:s,counterLength:n,counterRight:i,rounds:o}=WS({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Ll(n),Ll(o),Zl(i),Zl(r),(a,c,u,l,h=0)=>{dt(a),dt(c),dt(u);let f=u.length;if(l===void 0&&(l=new Uint8Array(f)),dt(l),Ll(h),h<0||h>=Iy)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);let p=[],d=a.length,g,m;if(d===32)p.push(g=Ql(a)),m=r_;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),m=t_,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);eh(c)||p.push(c=Ql(c));let S=ns(g);if(s){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(m,S,ns(c.subarray(0,16)),S),c=c.subarray(16)}let A=16-n;if(A!==c.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){let E=new Uint8Array(12);E.set(c,i?0:12-c.length),c=E,p.push(c)}let b=ns(c);return n_(t,m,S,b,u,l,h,o),pn(...p),l}}var ke=(t,e)=>t[e++]&255|(t[e++]&255)<<8,th=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Xl(e),dt(e,32);let r=ke(e,0),s=ke(e,2),n=ke(e,4),i=ke(e,6),o=ke(e,8),a=ke(e,10),c=ke(e,12),u=ke(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|s<<3)&8191,this.r[2]=(s>>>10|n<<6)&7939,this.r[3]=(n>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=ke(e,16+2*l)}process(e,r,s=!1){let n=s?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],p=o[6],d=o[7],g=o[8],m=o[9],S=ke(e,r+0),A=ke(e,r+2),b=ke(e,r+4),E=ke(e,r+6),v=ke(e,r+8),O=ke(e,r+10),P=ke(e,r+12),N=ke(e,r+14),w=i[0]+(S&8191),C=i[1]+((S>>>13|A<<3)&8191),_=i[2]+((A>>>10|b<<6)&8191),T=i[3]+((b>>>7|E<<9)&8191),B=i[4]+((E>>>4|v<<12)&8191),L=i[5]+(v>>>1&8191),x=i[6]+((v>>>14|O<<2)&8191),y=i[7]+((O>>>11|P<<5)&8191),I=i[8]+((P>>>8|N<<8)&8191),R=i[9]+(N>>>5|n),D=0,U=D+w*a+C*(5*m)+_*(5*g)+T*(5*d)+B*(5*p);D=U>>>13,U&=8191,U+=L*(5*f)+x*(5*h)+y*(5*l)+I*(5*u)+R*(5*c),D+=U>>>13,U&=8191;let F=D+w*c+C*a+_*(5*m)+T*(5*g)+B*(5*d);D=F>>>13,F&=8191,F+=L*(5*p)+x*(5*f)+y*(5*h)+I*(5*l)+R*(5*u),D+=F>>>13,F&=8191;let M=D+w*u+C*c+_*a+T*(5*m)+B*(5*g);D=M>>>13,M&=8191,M+=L*(5*d)+x*(5*p)+y*(5*f)+I*(5*h)+R*(5*l),D+=M>>>13,M&=8191;let j=D+w*l+C*u+_*c+T*a+B*(5*m);D=j>>>13,j&=8191,j+=L*(5*g)+x*(5*d)+y*(5*p)+I*(5*f)+R*(5*h),D+=j>>>13,j&=8191;let $=D+w*h+C*l+_*u+T*c+B*a;D=$>>>13,$&=8191,$+=L*(5*m)+x*(5*g)+y*(5*d)+I*(5*p)+R*(5*f),D+=$>>>13,$&=8191;let H=D+w*f+C*h+_*l+T*u+B*c;D=H>>>13,H&=8191,H+=L*a+x*(5*m)+y*(5*g)+I*(5*d)+R*(5*p),D+=H>>>13,H&=8191;let G=D+w*p+C*f+_*h+T*l+B*u;D=G>>>13,G&=8191,G+=L*c+x*a+y*(5*m)+I*(5*g)+R*(5*d),D+=G>>>13,G&=8191;let Z=D+w*d+C*p+_*f+T*h+B*l;D=Z>>>13,Z&=8191,Z+=L*u+x*c+y*a+I*(5*m)+R*(5*g),D+=Z>>>13,Z&=8191;let Q=D+w*g+C*d+_*p+T*f+B*h;D=Q>>>13,Q&=8191,Q+=L*l+x*u+y*c+I*a+R*(5*m),D+=Q>>>13,Q&=8191;let W=D+w*m+C*g+_*d+T*p+B*f;D=W>>>13,W&=8191,W+=L*h+x*l+y*u+I*c+R*a,D+=W>>>13,W&=8191,D=(D<<2)+D|0,D=D+U|0,U=D&8191,D=D>>>13,F+=D,i[0]=U,i[1]=F,i[2]=M,i[3]=j,i[4]=$,i[5]=H,i[6]=G,i[7]=Z,i[8]=Q,i[9]=W}finalize(){let{h:e,pad:r}=this,s=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,s[0]=e[0]+5,n=s[0]>>>13,s[0]&=8191;for(let a=1;a<10;a++)s[a]=e[a]+n,n=s[a]>>>13,s[a]&=8191;s[9]-=8192;let i=(n^1)-1;for(let a=0;a<10;a++)s[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|s[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;pn(s)}update(e){Im(this),e=Xl(e),dt(e);let{buffer:r,blockLen:s}=this,n=e.length;for(let i=0;i<n;){let o=Math.min(s-this.pos,n-i);if(o===s){for(;s<=n-i;i+=s)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===s&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){pn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Im(this),$S(e,this),this.finished=!0;let{buffer:r,h:s}=this,{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=s[o]>>>0,e[i++]=s[o]>>>8;return e}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let s=e.slice(0,r);return this.destroy(),s}};function o_(t){let e=(s,n)=>t(n).update(Xl(s)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=s=>t(s),e}var a_=o_(t=>new th(t));function c_(t,e,r,s,n,i=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],p=e[3],d=e[4],g=e[5],m=e[6],S=e[7],A=n,b=r[0],E=r[1],v=r[2],O=o,P=a,N=c,w=u,C=l,_=h,T=f,B=p,L=d,x=g,y=m,I=S,R=A,D=b,U=E,F=v;for(let j=0;j<i;j+=2)O=O+C|0,R=se(R^O,16),L=L+R|0,C=se(C^L,12),O=O+C|0,R=se(R^O,8),L=L+R|0,C=se(C^L,7),P=P+_|0,D=se(D^P,16),x=x+D|0,_=se(_^x,12),P=P+_|0,D=se(D^P,8),x=x+D|0,_=se(_^x,7),N=N+T|0,U=se(U^N,16),y=y+U|0,T=se(T^y,12),N=N+T|0,U=se(U^N,8),y=y+U|0,T=se(T^y,7),w=w+B|0,F=se(F^w,16),I=I+F|0,B=se(B^I,12),w=w+B|0,F=se(F^w,8),I=I+F|0,B=se(B^I,7),O=O+_|0,F=se(F^O,16),y=y+F|0,_=se(_^y,12),O=O+_|0,F=se(F^O,8),y=y+F|0,_=se(_^y,7),P=P+T|0,R=se(R^P,16),I=I+R|0,T=se(T^I,12),P=P+T|0,R=se(R^P,8),I=I+R|0,T=se(T^I,7),N=N+B|0,D=se(D^N,16),L=L+D|0,B=se(B^L,12),N=N+B|0,D=se(D^N,8),L=L+D|0,B=se(B^L,7),w=w+C|0,U=se(U^w,16),x=x+U|0,C=se(C^x,12),w=w+C|0,U=se(U^w,8),x=x+U|0,C=se(C^x,7);let M=0;s[M++]=o+O|0,s[M++]=a+P|0,s[M++]=c+N|0,s[M++]=u+w|0,s[M++]=l+C|0,s[M++]=h+_|0,s[M++]=f+T|0,s[M++]=p+B|0,s[M++]=d+L|0,s[M++]=g+x|0,s[M++]=m+y|0,s[M++]=S+I|0,s[M++]=A+R|0,s[M++]=b+D|0,s[M++]=E+U|0,s[M++]=v+F|0}var u_=i_(c_,{counterRight:!1,counterLength:4,allowShortKeys:!1}),l_=new Uint8Array(16),Dm=(t,e)=>{t.update(e);let r=e.length%16;r&&t.update(l_.subarray(r))},h_=new Uint8Array(32);function Tm(t,e,r,s,n){let i=t(e,r,h_),o=a_.create(i);n&&Dm(o,n),Dm(o,s);let a=ZS(s.length,n?n.length:0,!0);o.update(a);let c=o.digest();return pn(i,a),c}var f_=t=>(e,r,s)=>({encrypt(n,i){let o=n.length;i=Sm(o+16,i,!1),i.set(n);let a=i.subarray(0,-16);t(e,r,a,a,1);let c=Tm(t,e,r,a,s);return i.set(c,o),pn(c),i},decrypt(n,i){i=Sm(n.length-16,i,!1);let o=n.subarray(0,-16),a=n.subarray(-16),c=Tm(t,e,r,o,s);if(!YS(a,c))throw new Error("invalid tag");return i.set(n.subarray(0,-16)),t(e,r,i,i,1),pn(c),i}}),Sy=JS({blockSize:64,nonceLength:12,tagLength:16},f_(u_)),Ua=class extends dn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,mh(e);let s=jt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(s.length>n?e.create().update(s).digest():s);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Ct(i)}update(e){return is(this),this.iHash.update(e),this}digestInto(e){is(this),Ot(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:s,finished:n,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=s._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},$a=(t,e,r)=>new Ua(t,e).update(r).digest();$a.create=(t,e)=>new Ua(t,e);function d_(t,e,r){return mh(t),r===void 0&&(r=new Uint8Array(t.outputLen)),$a(t,jt(r),jt(e))}var kl=Uint8Array.from([0]),Rm=Uint8Array.of();function p_(t,e,r,s=32){mh(t),Dr(s);let n=t.outputLen;if(s>255*n)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(s/n);r===void 0&&(r=Rm);let o=new Uint8Array(i*n),a=$a.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<i;l++)kl[0]=l+1,c.update(l===0?Rm:u).update(r).update(kl).digestInto(u),o.set(u,n*l),a._cloneInto(c);return a.destroy(),c.destroy(),Ct(u,kl),o.slice(0,s)}var g_=(t,e,r,s,n)=>p_(t,d_(t,e,r),s,n),Ha=ja,Ah=BigInt(0),rh=BigInt(1);function Fa(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Oa(t){let e=t.toString(16);return e.length&1?"0"+e:e}function _y(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ah:BigInt("0x"+t)}function Ka(t){return _y(Di(t))}function La(t){return Ot(t),_y(Di(Uint8Array.from(t).reverse()))}function Dh(t,e){return wh(t.toString(16).padStart(e*2,"0"))}function Th(t,e){return Dh(t,e).reverse()}function ft(t,e,r){let s;if(typeof e=="string")try{s=wh(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(gh(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let n=s.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return s}var Ml=t=>typeof t=="bigint"&&Ah<=t;function m_(t,e,r){return Ml(t)&&Ml(e)&&Ml(r)&&e<=t&&t<r}function sh(t,e,r,s){if(!m_(e,r,s))throw new Error("expected valid "+t+": "+r+" <= n < "+s+", got "+e)}function y_(t){let e;for(e=0;t>Ah;t>>=rh,e+=1);return e}var Ga=t=>(rh<<BigInt(t))-rh;function w_(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let s=f=>new Uint8Array(f),n=f=>Uint8Array.of(f),i=s(t),o=s(t),a=0,c=()=>{i.fill(1),o.fill(0),a=0},u=(...f)=>r(o,i,...f),l=(f=s(0))=>{o=u(n(0),f),i=u(),f.length!==0&&(o=u(n(1),f),i=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0,p=[];for(;f<e;){i=u();let d=i.slice();p.push(d),f+=i.length}return Rs(...p)};return(f,p)=>{c(),l(f);let d;for(;!(d=p(h()));)l();return c(),d}}function Wa(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function s(n,i,o){let a=t[n];if(o&&a===void 0)return;let c=typeof a;if(c!==i||a===null)throw new Error(`param "${n}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([n,i])=>s(n,i,!1)),Object.entries(r).forEach(([n,i])=>s(n,i,!0))}function Om(t){let e=new WeakMap;return(r,...s)=>{let n=e.get(r);if(n!==void 0)return n;let i=t(r,...s);return e.set(r,i),i}}var gt=BigInt(0),ot=BigInt(1),Os=BigInt(2),b_=BigInt(3),Ay=BigInt(4),Dy=BigInt(5),Ty=BigInt(8);function Rt(t,e){let r=t%e;return r>=gt?r:e+r}function qt(t,e,r){let s=t;for(;e-- >gt;)s*=s,s%=r;return s}function Cm(t,e){if(t===gt)throw new Error("invert: expected non-zero number");if(e<=gt)throw new Error("invert: expected positive modulus, got "+e);let r=Rt(t,e),s=e,n=gt,i=ot;for(;r!==gt;){let o=s/r,a=s%r,c=n-i*o;s=r,r=a,n=i,i=c}if(s!==ot)throw new Error("invert: does not exist");return Rt(n,e)}function Ry(t,e){let r=(t.ORDER+ot)/Ay,s=t.pow(e,r);if(!t.eql(t.sqr(s),e))throw new Error("Cannot find square root");return s}function E_(t,e){let r=(t.ORDER-Dy)/Ty,s=t.mul(e,Os),n=t.pow(s,r),i=t.mul(e,n),o=t.mul(t.mul(i,Os),n),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function x_(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-ot,r=0;for(;e%Os===gt;)e/=Os,r++;let s=Os,n=yn(t);for(;Bm(n,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ry;let i=n.pow(s,e),o=(e+ot)/Os;return function(a,c){if(a.is0(c))return c;if(Bm(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,i),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===u)throw new Error("Cannot find square root");let g=ot<<BigInt(u-p-1),m=a.pow(l,g);u=p,l=a.sqr(m),h=a.mul(h,l),f=a.mul(f,m)}return f}}function v_(t){return t%Ay===b_?Ry:t%Ty===Dy?E_:x_(t)}var I_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function S_(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=I_.reduce((s,n)=>(s[n]="function",s),e);return Wa(t,r),t}function __(t,e,r){if(r<gt)throw new Error("invalid exponent, negatives unsupported");if(r===gt)return t.ONE;if(r===ot)return e;let s=t.ONE,n=e;for(;r>gt;)r&ot&&(s=t.mul(s,n)),n=t.sqr(n),r>>=ot;return s}function Oy(t,e,r=!1){let s=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(s[c]=o,t.mul(o,a)),t.ONE),i=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(s[c]=t.mul(o,s[c]),t.mul(o,a)),i),s}function Bm(t,e){let r=(t.ORDER-ot)/Os,s=t.pow(e,r),n=t.eql(s,t.ONE),i=t.eql(s,t.ZERO),o=t.eql(s,t.neg(t.ONE));if(!n&&!i&&!o)throw new Error("invalid Legendre symbol result");return n?1:i?0:-1}function A_(t,e){e!==void 0&&Dr(e);let r=e!==void 0?e:t.toString(2).length,s=Math.ceil(r/8);return{nBitLength:r,nByteLength:s}}function yn(t,e,r=!1,s={}){if(t<=gt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n,i;if(typeof e=="object"&&e!=null){if(s.sqrt||r)throw new Error("cannot specify opts in two arguments");let l=e;l.BITS&&(n=l.BITS),l.sqrt&&(i=l.sqrt),typeof l.isLE=="boolean"&&(r=l.isLE)}else typeof e=="number"&&(n=e),s.sqrt&&(i=s.sqrt);let{nBitLength:o,nByteLength:a}=A_(t,n);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,u=Object.freeze({ORDER:t,isLE:r,BITS:o,BYTES:a,MASK:Ga(o),ZERO:gt,ONE:ot,create:l=>Rt(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return gt<=l&&l<t},is0:l=>l===gt,isValidNot0:l=>!u.is0(l)&&u.isValid(l),isOdd:l=>(l&ot)===ot,neg:l=>Rt(-l,t),eql:(l,h)=>l===h,sqr:l=>Rt(l*l,t),add:(l,h)=>Rt(l+h,t),sub:(l,h)=>Rt(l-h,t),mul:(l,h)=>Rt(l*h,t),pow:(l,h)=>__(u,l,h),div:(l,h)=>Rt(l*Cm(h,t),t),sqrN:l=>l*l,addN:(l,h)=>l+h,subN:(l,h)=>l-h,mulN:(l,h)=>l*h,inv:l=>Cm(l,t),sqrt:i||(l=>(c||(c=v_(t)),c(u,l))),toBytes:l=>r?Th(l,a):Dh(l,a),fromBytes:l=>{if(l.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+l.length);return r?La(l):Ka(l)},invertBatch:l=>Oy(u,l),cmov:(l,h,f)=>f?h:l});return Object.freeze(u)}function Cy(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function By(t){let e=Cy(t);return e+Math.ceil(e/2)}function D_(t,e,r=!1){let s=t.length,n=Cy(e),i=By(e);if(s<16||s<i||s>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+s);let o=r?La(t):Ka(t),a=Rt(o,e-ot)+ot;return r?Th(a,n):Dh(a,n)}var gn=BigInt(0),Cs=BigInt(1);function vi(t,e){let r=e.negate();return t?r:e}function T_(t,e,r){let s=e==="pz"?i=>i.pz:i=>i.ez,n=Oy(t.Fp,r.map(s));return r.map((i,o)=>i.toAffine(n[o])).map(t.fromAffine)}function Ny(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ql(t,e){Ny(t,e);let r=Math.ceil(e/t)+1,s=2**(t-1),n=2**t,i=Ga(t),o=BigInt(t);return{windows:r,windowSize:s,mask:i,maxNumber:n,shiftBy:o}}function Nm(t,e,r){let{windowSize:s,mask:n,maxNumber:i,shiftBy:o}=r,a=Number(t&n),c=t>>o;a>s&&(a-=i,c+=Cs);let u=e*s,l=u+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:u}}function R_(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,s)=>{if(!(r instanceof e))throw new Error("invalid point at index "+s)})}function O_(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,s)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+s)})}var zl=new WeakMap,Py=new WeakMap;function jl(t){return Py.get(t)||1}function Pm(t){if(t!==gn)throw new Error("invalid wNAF")}function C_(t,e){return{constTimeNegate:vi,hasPrecomputes(r){return jl(r)!==1},unsafeLadder(r,s,n=t.ZERO){let i=r;for(;s>gn;)s&Cs&&(n=n.add(i)),i=i.double(),s>>=Cs;return n},precomputeWindow(r,s){let{windows:n,windowSize:i}=ql(s,e),o=[],a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,s,n){let i=t.ZERO,o=t.BASE,a=ql(r,e);for(let c=0;c<a.windows;c++){let{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:d}=Nm(n,c,a);n=u,h?o=o.add(vi(p,s[d])):i=i.add(vi(f,s[l]))}return Pm(n),{p:i,f:o}},wNAFUnsafe(r,s,n,i=t.ZERO){let o=ql(r,e);for(let a=0;a<o.windows&&n!==gn;a++){let{nextN:c,offset:u,isZero:l,isNeg:h}=Nm(n,a,o);if(n=c,!l){let f=s[u];i=i.add(h?f.negate():f)}}return Pm(n),i},getPrecomputes(r,s,n){let i=zl.get(s);return i||(i=this.precomputeWindow(s,r),r!==1&&(typeof n=="function"&&(i=n(i)),zl.set(s,i))),i},wNAFCached(r,s,n){let i=jl(r);return this.wNAF(i,this.getPrecomputes(i,r,n),s)},wNAFCachedUnsafe(r,s,n,i){let o=jl(r);return o===1?this.unsafeLadder(r,s,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),s,i)},setWindowSize(r,s){Ny(s,e),Py.set(r,s),zl.delete(r)}}}function B_(t,e,r,s){let n=e,i=t.ZERO,o=t.ZERO;for(;r>gn||s>gn;)r&Cs&&(i=i.add(n)),s&Cs&&(o=o.add(n)),n=n.double(),r>>=Cs,s>>=Cs;return{p1:i,p2:o}}function N_(t,e,r,s){R_(r,t),O_(s,e);let n=r.length,i=s.length;if(n!==i)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=y_(BigInt(n)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=Ga(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,f=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<i;g++){let m=s[g],S=Number(m>>BigInt(p)&u);l[S]=l[S].add(r[g])}let d=o;for(let g=l.length-1,m=o;g>0;g--)m=m.add(l[g]),d=d.add(m);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Um(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return S_(e),e}else return yn(t)}function P_(t,e,r={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let o of["p","n","h"]){let a=e[o];if(!(typeof a=="bigint"&&a>gn))throw new Error(`CURVE.${o} must be positive bigint`)}let s=Um(e.p,r.Fp),n=Um(e.n,r.Fn),i=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let o of i)if(!s.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);var bi=BigInt(0),fn=BigInt(1),Ca=BigInt(2);function U_(t){return Wa(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function F_(t){let e=U_(t),{P:r,type:s,adjustScalarBytes:n,powPminus2:i,randomBytes:o}=e,a=s==="x25519";if(!a&&s!=="x448")throw new Error("invalid type");let c=o||mn,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?Ca**BigInt(254):Ca**BigInt(447),d=a?BigInt(8)*Ca**BigInt(251)-fn:BigInt(4)*Ca**BigInt(445)-fn,g=p+d+fn,m=w=>Rt(w,r),S=A(h);function A(w){return Th(m(w),l)}function b(w){let C=ft("u coordinate",w,l);return a&&(C[31]&=127),m(La(C))}function E(w){return La(n(ft("scalar",w,l)))}function v(w,C){let _=N(b(C),E(w));if(_===bi)throw new Error("invalid private or public key received");return A(_)}function O(w){return v(w,S)}function P(w,C,_){let T=m(w*(C-_));return C=m(C-T),_=m(_+T),{x_2:C,x_3:_}}function N(w,C){sh("u",w,bi,r),sh("scalar",C,p,g);let _=C,T=w,B=fn,L=bi,x=w,y=fn,I=bi;for(let D=BigInt(u-1);D>=bi;D--){let U=_>>D&fn;I^=U,{x_2:B,x_3:x}=P(I,B,x),{x_2:L,x_3:y}=P(I,L,y),I=U;let F=B+L,M=m(F*F),j=B-L,$=m(j*j),H=M-$,G=x+y,Z=x-y,Q=m(Z*F),W=m(G*j),ae=Q+W,Ee=Q-W;x=m(ae*ae),y=m(T*m(Ee*Ee)),B=m(M*$),L=m(H*(M+m(f*H)))}({x_2:B,x_3:x}=P(I,B,x)),{x_2:L,x_3:y}=P(I,L,y);let R=i(L);return m(B*R)}return{scalarMult:v,scalarMultBase:O,getSharedSecret:(w,C)=>v(w,C),getPublicKey:w=>O(w),utils:{randomPrivateKey:()=>c(l)},GuBytes:S.slice()}}BigInt(0);var L_=BigInt(1),Fm=BigInt(2),k_=BigInt(3),M_=BigInt(5),q_=BigInt(8),Uy={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:q_,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function z_(t){let e=BigInt(10),r=BigInt(20),s=BigInt(40),n=BigInt(80),i=Uy.p,o=t*t%i*t%i,a=qt(o,Fm,i)*o%i,c=qt(a,L_,i)*t%i,u=qt(c,M_,i)*c%i,l=qt(u,e,i)*u%i,h=qt(l,r,i)*l%i,f=qt(h,s,i)*h%i,p=qt(f,n,i)*f%i,d=qt(p,n,i)*f%i,g=qt(d,e,i)*u%i;return{pow_p_5_8:qt(g,Fm,i)*t%i,b2:o}}function j_(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var nh=(()=>{let t=Uy.p;return F_({P:t,type:"x25519",powPminus2:e=>{let{pow_p_5_8:r,b2:s}=z_(e);return Rt(qt(r,k_,t)*s,t)},adjustScalarBytes:j_})})();function Lm(t){t.lowS!==void 0&&Fa("lowS",t.lowS),t.prehash!==void 0&&Fa("prehash",t.prehash)}var ih=class extends Error{constructor(e=""){super(e)}},_r={Err:ih,_tlv:{encode:(t,e)=>{let{Err:r}=_r;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");let s=e.length/2,n=Oa(s);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let i=s>127?Oa(n.length/2|128):"";return Oa(t)+i+n+e},decode(t,e){let{Err:r}=_r,s=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[s++]!==t)throw new r("tlv.decode: wrong tlv");let n=e[s++],i=!!(n&128),o=0;if(!i)o=n;else{let c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=e.subarray(s,s+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of u)o=o<<8|l;if(s+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}let a=e.subarray(s,s+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(s+o)}}},_int:{encode(t){let{Err:e}=_r;if(t<Ii)throw new e("integer: negative integers are not allowed");let r=Oa(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=_r;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ka(t)}},toSig(t){let{Err:e,_int:r,_tlv:s}=_r,n=ft("signature",t),{v:i,l:o}=s.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=s.decode(2,i),{v:u,l}=s.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){let{_tlv:e,_int:r}=_r,s=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),i=s+n;return e.encode(48,i)}},Ii=BigInt(0),Si=BigInt(1),V_=BigInt(2),Ba=BigInt(3),$_=BigInt(4);function H_(t,e,r){function s(n){let i=t.sqr(n),o=t.mul(i,n);return t.add(t.add(o,t.mul(n,e)),r)}return s}function Fy(t,e,r){let{BYTES:s}=t;function n(i){let o;if(typeof i=="bigint")o=i;else{let a=ft("private key",i);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(s);c.set(a,c.length-a.length),a=c}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${s}, got ${typeof i}`)}}if(r&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return n}function K_(t,e={}){let{Fp:r,Fn:s}=P_("weierstrass",t,e),{h:n,n:i}=t;Wa(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:o}=e;if(o&&(!r.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(N,w,C){let{x:_,y:T}=w.toAffine(),B=r.toBytes(_);if(Fa("isCompressed",C),C){a();let L=!r.isOdd(T);return Rs(Ly(L),B)}else return Rs(Uint8Array.of(4),B,r.toBytes(T))}function u(N){Ot(N);let w=r.BYTES,C=w+1,_=2*w+1,T=N.length,B=N[0],L=N.subarray(1);if(T===C&&(B===2||B===3)){let x=r.fromBytes(L);if(!r.isValid(x))throw new Error("bad point: is not on curve, wrong x");let y=f(x),I;try{I=r.sqrt(y)}catch(D){let U=D instanceof Error?": "+D.message:"";throw new Error("bad point: is not on curve, sqrt error"+U)}a();let R=r.isOdd(I);return(B&1)===1!==R&&(I=r.neg(I)),{x,y:I}}else if(T===_&&B===4){let x=r.fromBytes(L.subarray(w*0,w*1)),y=r.fromBytes(L.subarray(w*1,w*2));if(!p(x,y))throw new Error("bad point: is not on curve");return{x,y}}else throw new Error(`bad point: got length ${T}, expected compressed=${C} or uncompressed=${_}`)}let l=e.toBytes||c,h=e.fromBytes||u,f=H_(r,t.a,t.b);function p(N,w){let C=r.sqr(w),_=f(N);return r.eql(C,_)}if(!p(t.Gx,t.Gy))throw new Error("bad curve params: generator point");let d=r.mul(r.pow(t.a,Ba),$_),g=r.mul(r.sqr(t.b),BigInt(27));if(r.is0(r.add(d,g)))throw new Error("bad curve params: a or b");function m(N,w,C=!1){if(!r.isValid(w)||C&&r.is0(w))throw new Error(`bad point coordinate ${N}`);return w}function S(N){if(!(N instanceof v))throw new Error("ProjectivePoint expected")}let A=Om((N,w)=>{let{px:C,py:_,pz:T}=N;if(r.eql(T,r.ONE))return{x:C,y:_};let B=N.is0();w==null&&(w=B?r.ONE:r.inv(T));let L=r.mul(C,w),x=r.mul(_,w),y=r.mul(T,w);if(B)return{x:r.ZERO,y:r.ZERO};if(!r.eql(y,r.ONE))throw new Error("invZ was invalid");return{x:L,y:x}}),b=Om(N=>{if(N.is0()){if(e.allowInfinityPoint&&!r.is0(N.py))return;throw new Error("bad point: ZERO")}let{x:w,y:C}=N.toAffine();if(!r.isValid(w)||!r.isValid(C))throw new Error("bad point: x or y not field elements");if(!p(w,C))throw new Error("bad point: equation left != right");if(!N.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function E(N,w,C,_,T){return C=new v(r.mul(C.px,N),C.py,C.pz),w=vi(_,w),C=vi(T,C),w.add(C)}class v{constructor(w,C,_){this.px=m("x",w),this.py=m("y",C,!0),this.pz=m("z",_),Object.freeze(this)}static fromAffine(w){let{x:C,y:_}=w||{};if(!w||!r.isValid(C)||!r.isValid(_))throw new Error("invalid affine point");if(w instanceof v)throw new Error("projective point not allowed");return r.is0(C)&&r.is0(_)?v.ZERO:new v(C,_,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){return T_(v,"pz",w)}static fromBytes(w){return Ot(w),v.fromHex(w)}static fromHex(w){let C=v.fromAffine(h(ft("pointHex",w)));return C.assertValidity(),C}static fromPrivateKey(w){let C=Fy(s,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return v.BASE.multiply(C(w))}static msm(w,C){return N_(v,s,w,C)}precompute(w=8,C=!0){return P.setWindowSize(this,w),C||this.multiply(Ba),this}_setWindowSize(w){this.precompute(w)}assertValidity(){b(this)}hasEvenY(){let{y:w}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(w)}equals(w){S(w);let{px:C,py:_,pz:T}=this,{px:B,py:L,pz:x}=w,y=r.eql(r.mul(C,x),r.mul(B,T)),I=r.eql(r.mul(_,x),r.mul(L,T));return y&&I}negate(){return new v(this.px,r.neg(this.py),this.pz)}double(){let{a:w,b:C}=t,_=r.mul(C,Ba),{px:T,py:B,pz:L}=this,x=r.ZERO,y=r.ZERO,I=r.ZERO,R=r.mul(T,T),D=r.mul(B,B),U=r.mul(L,L),F=r.mul(T,B);return F=r.add(F,F),I=r.mul(T,L),I=r.add(I,I),x=r.mul(w,I),y=r.mul(_,U),y=r.add(x,y),x=r.sub(D,y),y=r.add(D,y),y=r.mul(x,y),x=r.mul(F,x),I=r.mul(_,I),U=r.mul(w,U),F=r.sub(R,U),F=r.mul(w,F),F=r.add(F,I),I=r.add(R,R),R=r.add(I,R),R=r.add(R,U),R=r.mul(R,F),y=r.add(y,R),U=r.mul(B,L),U=r.add(U,U),R=r.mul(U,F),x=r.sub(x,R),I=r.mul(U,D),I=r.add(I,I),I=r.add(I,I),new v(x,y,I)}add(w){S(w);let{px:C,py:_,pz:T}=this,{px:B,py:L,pz:x}=w,y=r.ZERO,I=r.ZERO,R=r.ZERO,D=t.a,U=r.mul(t.b,Ba),F=r.mul(C,B),M=r.mul(_,L),j=r.mul(T,x),$=r.add(C,_),H=r.add(B,L);$=r.mul($,H),H=r.add(F,M),$=r.sub($,H),H=r.add(C,T);let G=r.add(B,x);return H=r.mul(H,G),G=r.add(F,j),H=r.sub(H,G),G=r.add(_,T),y=r.add(L,x),G=r.mul(G,y),y=r.add(M,j),G=r.sub(G,y),R=r.mul(D,H),y=r.mul(U,j),R=r.add(y,R),y=r.sub(M,R),R=r.add(M,R),I=r.mul(y,R),M=r.add(F,F),M=r.add(M,F),j=r.mul(D,j),H=r.mul(U,H),M=r.add(M,j),j=r.sub(F,j),j=r.mul(D,j),H=r.add(H,j),F=r.mul(M,H),I=r.add(I,F),F=r.mul(G,H),y=r.mul($,y),y=r.sub(y,F),F=r.mul($,M),R=r.mul(G,R),R=r.add(R,F),new v(y,I,R)}subtract(w){return this.add(w.negate())}is0(){return this.equals(v.ZERO)}multiply(w){let{endo:C}=e;if(!s.isValidNot0(w))throw new Error("invalid scalar: out of range");let _,T,B=L=>P.wNAFCached(this,L,v.normalizeZ);if(C){let{k1neg:L,k1:x,k2neg:y,k2:I}=C.splitScalar(w),{p:R,f:D}=B(x),{p:U,f:F}=B(I);T=D.add(F),_=E(C.beta,R,U,L,y)}else{let{p:L,f:x}=B(w);_=L,T=x}return v.normalizeZ([_,T])[0]}multiplyUnsafe(w){let{endo:C}=e,_=this;if(!s.isValid(w))throw new Error("invalid scalar: out of range");if(w===Ii||_.is0())return v.ZERO;if(w===Si)return _;if(P.hasPrecomputes(this))return this.multiply(w);if(C){let{k1neg:T,k1:B,k2neg:L,k2:x}=C.splitScalar(w),{p1:y,p2:I}=B_(v,_,B,x);return E(C.beta,y,I,T,L)}else return P.wNAFCachedUnsafe(_,w)}multiplyAndAddUnsafe(w,C,_){let T=this.multiplyUnsafe(C).add(w.multiplyUnsafe(_));return T.is0()?void 0:T}toAffine(w){return A(this,w)}isTorsionFree(){let{isTorsionFree:w}=e;return n===Si?!0:w?w(v,this):P.wNAFCachedUnsafe(this,i).is0()}clearCofactor(){let{clearCofactor:w}=e;return n===Si?this:w?w(v,this):this.multiplyUnsafe(n)}toBytes(w=!0){return Fa("isCompressed",w),this.assertValidity(),l(v,this,w)}toRawBytes(w=!0){return this.toBytes(w)}toHex(w=!0){return Di(this.toBytes(w))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}v.BASE=new v(t.Gx,t.Gy,r.ONE),v.ZERO=new v(r.ZERO,r.ONE,r.ZERO),v.Fp=r,v.Fn=s;let O=s.BITS,P=C_(v,e.endo?Math.ceil(O/2):O);return v}function Ly(t){return Uint8Array.of(t?2:3)}function G_(t,e,r={}){Wa(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let s=e.randomBytes||mn,n=e.hmac||((_,...T)=>$a(e.hash,_,Rs(...T))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o;function u(_){let T=a>>Si;return _>T}function l(_){return u(_)?o.neg(_):_}function h(_,T){if(!o.isValidNot0(T))throw new Error(`invalid signature ${_}: out of range 1..CURVE.n`)}class f{constructor(T,B,L){h("r",T),h("s",B),this.r=T,this.s=B,L!=null&&(this.recovery=L),Object.freeze(this)}static fromCompact(T){let B=o.BYTES,L=ft("compactSignature",T,B*2);return new f(o.fromBytes(L.subarray(0,B)),o.fromBytes(L.subarray(B,B*2)))}static fromDER(T){let{r:B,s:L}=_r.toSig(ft("DER",T));return new f(B,L)}assertValidity(){}addRecoveryBit(T){return new f(this.r,this.s,T)}recoverPublicKey(T){let B=i.ORDER,{r:L,s:x,recovery:y}=this;if(y==null||![0,1,2,3].includes(y))throw new Error("recovery id invalid");if(a*V_<B&&y>1)throw new Error("recovery id is ambiguous for h>1 curve");let I=y===2||y===3?L+a:L;if(!i.isValid(I))throw new Error("recovery id 2 or 3 invalid");let R=i.toBytes(I),D=t.fromHex(Rs(Ly((y&1)===0),R)),U=o.inv(I),F=b(ft("msgHash",T)),M=o.create(-F*U),j=o.create(x*U),$=t.BASE.multiplyUnsafe(M).add(D.multiplyUnsafe(j));if($.is0())throw new Error("point at infinify");return $.assertValidity(),$}hasHighS(){return u(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o.neg(this.s),this.recovery):this}toBytes(T){if(T==="compact")return Rs(o.toBytes(this.r),o.toBytes(this.s));if(T==="der")return wh(_r.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Di(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Di(this.toBytes("compact"))}}let p=Fy(o,r.allowedPrivateKeyLengths,r.wrapPrivateKey),d={isValidPrivateKey(_){try{return p(_),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{let _=a;return D_(s(By(_)),_)},precompute(_=8,T=t.BASE){return T.precompute(_,!1)}};function g(_,T=!0){return t.fromPrivateKey(_).toBytes(T)}function m(_){if(typeof _=="bigint")return!1;if(_ instanceof t)return!0;let T=ft("key",_).length,B=i.BYTES,L=B+1,x=2*B+1;if(!(r.allowedPrivateKeyLengths||o.BYTES===L))return T===L||T===x}function S(_,T,B=!0){if(m(_)===!0)throw new Error("first arg must be private key");if(m(T)===!1)throw new Error("second arg must be public key");return t.fromHex(T).multiply(p(_)).toBytes(B)}let A=e.bits2int||function(_){if(_.length>8192)throw new Error("input is too large");let T=Ka(_),B=_.length*8-c;return B>0?T>>BigInt(B):T},b=e.bits2int_modN||function(_){return o.create(A(_))},E=Ga(c);function v(_){return sh("num < 2^"+c,_,Ii,E),o.toBytes(_)}function O(_,T,B=P){if(["recovered","canonical"].some($=>$ in B))throw new Error("sign() legacy options not supported");let{hash:L}=e,{lowS:x,prehash:y,extraEntropy:I}=B;x==null&&(x=!0),_=ft("msgHash",_),Lm(B),y&&(_=ft("prehashed msgHash",L(_)));let R=b(_),D=p(T),U=[v(D),v(R)];if(I!=null&&I!==!1){let $=I===!0?s(i.BYTES):I;U.push(ft("extraEntropy",$))}let F=Rs(...U),M=R;function j($){let H=A($);if(!o.isValidNot0(H))return;let G=o.inv(H),Z=t.BASE.multiply(H).toAffine(),Q=o.create(Z.x);if(Q===Ii)return;let W=o.create(G*o.create(M+Q*D));if(W===Ii)return;let ae=(Z.x===Q?0:2)|Number(Z.y&Si),Ee=W;return x&&u(W)&&(Ee=l(W),ae^=1),new f(Q,Ee,ae)}return{seed:F,k2sig:j}}let P={lowS:e.lowS,prehash:!1},N={lowS:e.lowS,prehash:!1};function w(_,T,B=P){let{seed:L,k2sig:x}=O(_,T,B);return w_(e.hash.outputLen,o.BYTES,n)(L,x)}t.BASE.precompute(8);function C(_,T,B,L=N){let x=_;T=ft("msgHash",T),B=ft("publicKey",B),Lm(L);let{lowS:y,prehash:I,format:R}=L;if("strict"in L)throw new Error("options.strict was renamed to lowS");if(R!==void 0&&!["compact","der","js"].includes(R))throw new Error('format must be "compact", "der" or "js"');let D=typeof x=="string"||gh(x),U=!D&&!R&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!D&&!U)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let F,M;try{if(U)if(R===void 0||R==="js")F=new f(x.r,x.s);else throw new Error("invalid format");if(D){try{R!=="compact"&&(F=f.fromDER(x))}catch(ae){if(!(ae instanceof _r.Err))throw ae}!F&&R!=="der"&&(F=f.fromCompact(x))}M=t.fromHex(B)}catch{return!1}if(!F||y&&F.hasHighS())return!1;I&&(T=e.hash(T));let{r:j,s:$}=F,H=b(T),G=o.inv($),Z=o.create(H*G),Q=o.create(j*G),W=t.BASE.multiplyUnsafe(Z).add(M.multiplyUnsafe(Q));return W.is0()?!1:o.create(W.x)===j}return Object.freeze({getPublicKey:g,getSharedSecret:S,sign:w,verify:C,utils:d,Point:t,Signature:f})}function W_(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,s=yn(e.n,t.nBitLength),n={Fp:r,Fn:s,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function Y_(t){let{CURVE:e,curveOpts:r}=W_(t),s={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,ecdsaOpts:s}}function J_(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function Z_(t){let{CURVE:e,curveOpts:r,ecdsaOpts:s}=Y_(t),n=K_(e,r),i=G_(n,s,r);return J_(t,i)}function oh(t,e){let r=s=>Z_({...t,hash:s});return{...r(e),create:r}}var ky={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},My={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},qy={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},X_=yn(ky.p),Q_=yn(My.p),e6=yn(qy.p),t6=oh({...ky,Fp:X_,lowS:!1},ja);oh({...My,Fp:Q_,lowS:!1},yS),oh({...qy,Fp:e6,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},mS);var r6=t6,zy="base10",Je="base16",Ze="base64pad",Or="base64url",Li="utf8",jy=0,Ht=1,wn=2,s6=0,km=1,_i=12,Rh=32;function Vy(){let t=nh.utils.randomPrivateKey(),e=nh.getPublicKey(t);return{privateKey:Fe(t,Je),publicKey:Fe(e,Je)}}function Ya(){let t=mn(Rh);return Fe(t,Je)}function $y(t,e){let r=nh.getSharedSecret(ht(t,Je),ht(e,Je)),s=g_(Ha,r,void 0,void 0,Rh);return Fe(s,Je)}function bn(t){let e=Ha(ht(t,Je));return Fe(e,Je)}function mt(t){let e=Ha(ht(t,Li));return Fe(e,Je)}function Hy(t){return ht(`${t}`,zy)}function os(t){return Number(Fe(t,zy))}function Ky(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Gy(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function Wy(t){let e=Hy(typeof t.type<"u"?t.type:jy);if(os(e)===Ht&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let r=typeof t.senderPublicKey<"u"?ht(t.senderPublicKey,Je):void 0,s=typeof t.iv<"u"?ht(t.iv,Je):mn(_i),n=ht(t.symKey,Je),i=Sy(n,s).encrypt(ht(t.message,Li)),o=Xy({type:e,sealed:i,iv:s,senderPublicKey:r});return t.encoding===Or?Ky(o):o}function Yy(t){let e=ht(t.symKey,Je),{sealed:r,iv:s}=En({encoded:t.encoded,encoding:t.encoding}),n=Sy(e,s).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return Fe(n,Li)}function Jy(t,e){let r=Hy(wn),s=mn(_i),n=ht(t,Li),i=Xy({type:r,sealed:n,iv:s});return e===Or?Ky(i):i}function Zy(t,e){let{sealed:r}=En({encoded:t,encoding:e});return Fe(r,Li)}function Xy(t){if(os(t.type)===wn)return Fe(As([t.type,t.sealed]),Ze);if(os(t.type)===Ht){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Fe(As([t.type,t.senderPublicKey,t.iv,t.sealed]),Ze)}return Fe(As([t.type,t.iv,t.sealed]),Ze)}function En(t){let e=(t.encoding||Ze)===Or?Gy(t.encoded):t.encoded,r=ht(e,Ze),s=r.slice(s6,km),n=km;if(os(s)===Ht){let c=n+Rh,u=c+_i,l=r.slice(n,c),h=r.slice(c,u),f=r.slice(u);return{type:s,sealed:f,iv:h,senderPublicKey:l}}if(os(s)===wn){let c=r.slice(n),u=mn(_i);return{type:s,sealed:c,iv:u}}let i=n+_i,o=r.slice(n,i),a=r.slice(i);return{type:s,sealed:a,iv:o}}function Qy(t,e){let r=En({encoded:t,encoding:e?.encoding});return Oh({type:os(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Fe(r.senderPublicKey,Je):void 0,receiverPublicKey:e?.receiverPublicKey})}function Oh(t){let e=t?.type||jy;if(e===Ht){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Ch(t){return t.type===Ht&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Bh(t){return t.type===wn}function n6(t){let e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return As([new Uint8Array([4]),e,r])}function ew(t,e){let[r,s,n]=t.split("."),i=Buffer.from(Gy(n),"base64");if(i.length!==64)throw new Error("Invalid signature length");let o=i.slice(0,32),a=i.slice(32,64),c=`${r}.${s}`,u=Ha(c),l=n6(e);if(!r6.verify(As([o,a]),u,l))throw new Error("Invalid signature");return Vn(t).payload}var i6="irn";function ki(t){return t?.relay||{protocol:i6}}function Us(t){let e=H0[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function o6(t,e="-"){let r={},s="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(s)){let i=n.replace(s,""),o=t[n];r[i]=o}}),r}function Nh(t){if(!t.includes("wc:")){let u=ry(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;let e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,s=t.substring(0,e),n=t.substring(e+1,r).split("@"),i=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(i),a={};o.forEach((u,l)=>{a[l]=u});let c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:s,topic:a6(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:o6(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function a6(t){return t.startsWith("//")?t.substring(2):t}function c6(t,e="-"){let r="relay",s={};return Object.keys(t).forEach(n=>{let i=n,o=r+e+i;t[i]&&(s[o]=t[i])}),s}function Ph(t){let e=new URLSearchParams,r=c6(t.relay);Object.keys(r).sort().forEach(n=>{e.set(n,r[n])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));let s=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${s}`}function Mi(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var u6=Object.defineProperty,l6=Object.defineProperties,h6=Object.getOwnPropertyDescriptors,Mm=Object.getOwnPropertySymbols,f6=Object.prototype.hasOwnProperty,d6=Object.prototype.propertyIsEnumerable,qm=(t,e,r)=>e in t?u6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,p6=(t,e)=>{for(var r in e||(e={}))f6.call(e,r)&&qm(t,r,e[r]);if(Mm)for(var r of Mm(e))d6.call(e,r)&&qm(t,r,e[r]);return t},g6=(t,e)=>l6(t,h6(e));function xn(t){let e=[];return t.forEach(r=>{let[s,n]=r.split(":");e.push(`${s}:${n}`)}),e}function m6(t){let e=[];return Object.values(t).forEach(r=>{e.push(...xn(r.accounts))}),e}function y6(t,e){let r=[];return Object.values(t).forEach(s=>{xn(s.accounts).includes(e)&&r.push(...s.methods)}),r}function w6(t,e){let r=[];return Object.values(t).forEach(s=>{xn(s.accounts).includes(e)&&r.push(...s.events)}),r}function tw(t){return t.includes(":")}function b6(t){return tw(t)?t.split(":")[0]:t}function zm(t){var e,r,s;let n={};if(!vn(t))return n;for(let[i,o]of Object.entries(t)){let a=tw(i)?[i]:o.chains,c=o.methods||[],u=o.events||[],l=b6(i);n[l]=g6(p6({},n[l]),{chains:Bs(a,(e=n[l])==null?void 0:e.chains),methods:Bs(c,(r=n[l])==null?void 0:r.methods),events:Bs(u,(s=n[l])==null?void 0:s.events)})}return n}function E6(t){let e={};return t?.forEach(r=>{var s;let[n,i]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(s=e[n].chains)==null||s.push(`${n}:${i}`)}),e}function Uh(t,e){e=e.map(s=>s.replace("did:pkh:",""));let r=E6(e);for(let[s,n]of Object.entries(r))n.methods?n.methods=Bs(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}function rw(t,e){var r,s,n,i,o,a;let c=zm(t),u=zm(e),l={},h=Object.keys(c).concat(Object.keys(u));for(let f of h)l[f]={chains:Bs((r=c[f])==null?void 0:r.chains,(s=u[f])==null?void 0:s.chains),methods:Bs((n=c[f])==null?void 0:n.methods,(i=u[f])==null?void 0:i.methods),events:Bs((o=c[f])==null?void 0:o.events,(a=u[f])==null?void 0:a.events)};return l}var x6={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},v6={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(t,e){let{message:r,code:s}=v6[t];return{message:e?`${r} ${e}`:r,code:s}}function ge(t,e){let{message:r,code:s}=x6[t];return{message:e?`${r} ${e}`:r,code:s}}function Fs(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function vn(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ie(t){return typeof t>"u"}function we(t,e){return e&&Ie(t)?!0:typeof t=="string"&&!!t.trim().length}function Fh(t,e){return e&&Ie(t)?!0:typeof t=="number"&&!isNaN(t)}function sw(t,e){let{requiredNamespaces:r}=e,s=Object.keys(t.namespaces),n=Object.keys(r),i=!0;return Ts(n,s)?(s.forEach(o=>{let{accounts:a,methods:c,events:u}=t.namespaces[o],l=xn(a),h=r[o];(!Ts(Km(o,h),l)||!Ts(h.methods,c)||!Ts(h.events,u))&&(i=!1)}),i):!1}function ka(t){return we(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function I6(t){if(we(t,!1)&&t.includes(":")){let e=t.split(":");if(e.length===3){let r=e[0]+":"+e[1];return!!e[2]&&ka(r)}}return!1}function nw(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(we(t,!1)){if(e(t))return!0;let r=ry(t);return e(r)}}catch{}return!1}function iw(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function ow(t){return t?.topic}function aw(t,e){let r=null;return we(t?.publicKey,!1)||(r=q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function jm(t){let e=!0;return Fs(t)?t.length&&(e=t.every(r=>we(r,!1))):e=!1,e}function S6(t,e,r){let s=null;return Fs(e)&&e.length?e.forEach(n=>{s||ka(n)||(s=ge("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):ka(t)||(s=ge("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function _6(t,e,r){let s=null;return Object.entries(t).forEach(([n,i])=>{if(s)return;let o=S6(n,Km(n,i),`${e} ${r}`);o&&(s=o)}),s}function A6(t,e){let r=null;return Fs(t)?t.forEach(s=>{r||I6(s)||(r=ge("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=ge("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function D6(t,e){let r=null;return Object.values(t).forEach(s=>{if(r)return;let n=A6(s?.accounts,`${e} namespace`);n&&(r=n)}),r}function T6(t,e){let r=null;return jm(t?.methods)?jm(t?.events)||(r=ge("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ge("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function cw(t,e){let r=null;return Object.values(t).forEach(s=>{if(r)return;let n=T6(s,`${e}, namespace`);n&&(r=n)}),r}function uw(t,e,r){let s=null;if(t&&vn(t)){let n=cw(t,e);n&&(s=n);let i=_6(t,e,r);i&&(s=i)}else s=q("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return s}function Ja(t,e){let r=null;if(t&&vn(t)){let s=cw(t,e);s&&(r=s);let n=D6(t,e);n&&(r=n)}else r=q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Lh(t){return we(t.protocol,!0)}function lw(t,e){let r=!1;return e&&!t?r=!0:t&&Fs(t)&&t.length&&t.forEach(s=>{r=Lh(s)}),r}function hw(t){return typeof t=="number"}function Xe(t){return typeof t<"u"&&typeof t!==null}function fw(t){return!(!t||typeof t!="object"||!t.code||!Fh(t.code,!1)||!t.message||!we(t.message,!1))}function dw(t){return!(Ie(t)||!we(t.method,!1))}function pw(t){return!(Ie(t)||Ie(t.result)&&Ie(t.error)||!Fh(t.id,!1)||!we(t.jsonrpc,!1))}function gw(t){return!(Ie(t)||!we(t.name,!1))}function kh(t,e){return!(!ka(e)||!m6(t).includes(e))}function mw(t,e,r){return we(r,!1)?y6(t,e).includes(r):!1}function yw(t,e,r){return we(r,!1)?w6(t,e).includes(r):!1}function Mh(t,e,r){let s=null,n=R6(t),i=O6(e),o=Object.keys(n),a=Object.keys(i),c=Vm(Object.keys(t)),u=Vm(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(s=q("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Ts(o,a)||(s=q("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||s)return;let f=xn(e[h].accounts);f.includes(h)||(s=q("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{s||(Ts(n[h].methods,i[h].methods)?Ts(n[h].events,i[h].events)||(s=q("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):s=q("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),s}function R6(t){let e={};return Object.keys(t).forEach(r=>{var s;r.includes(":")?e[r]=t[r]:(s=t[r].chains)==null||s.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Vm(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function O6(t){let e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:xn(t[r].accounts)?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(i=>i.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}),e}function ww(t,e){return Fh(t,!1)&&t<=e.max&&t>=e.min}function qh(){let t=Bi();return new Promise(e=>{switch(t){case pt.browser:e(C6());break;case pt.reactNative:e(B6());break;case pt.node:e(N6());break;default:e(!0)}})}function C6(){return Ps()&&navigator?.onLine}async function B6(){return Tr()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function N6(){return!0}function bw(t){switch(Bi()){case pt.browser:P6(t);break;case pt.reactNative:U6(t);break;case pt.node:break}}function P6(t){!Tr()&&Ps()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function U6(t){Tr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function Ew(){var t;return Ps()&&(0,Vt.getDocument)()?((t=(0,Vt.getDocument)())==null?void 0:t.visibilityState)==="visible":!0}var Vl={},as=class{static get(e){return Vl[e]}static set(e,r){Vl[e]=r}static delete(e){delete Vl[e]}};function F6(t){let e=nn.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function L6({publicKey:t,signature:e,payload:r}){var s;let n=ah(r.method),i=128|parseInt(((s=r.version)==null?void 0:s.toString())||"4"),o=q6(r.address),a=r.era==="00"?new Uint8Array([0]):ah(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");let c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${M6(r.tip)}`),h=j6(l),f=new Uint8Array([0,...t,o,...e,...a,...u,...h,...n]),p=z6(f.length+1);return new Uint8Array([...p,i,...f])}function k6(t){let e=ah(t),r=(0,Hm.blake2b)(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function ah(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function M6(t){return t.startsWith("0x")?t.slice(2):t}function q6(t){let e=nn.decode(t)[0];return e===42?0:e===60?2:1}function z6(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){let e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){let e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function j6(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){let e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){let e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function xw(t){let e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=F6(t.transaction.address),s=L6({publicKey:r,signature:e,payload:t.transaction}),n=Buffer.from(s).toString("hex");return k6(n)}var Lw=De(ps());var et={};Ne(et,{DEFAULT_ERROR:()=>zi,IBaseJsonRpcProvider:()=>ic,IEvents:()=>ji,IJsonRpcConnection:()=>Hh,IJsonRpcProvider:()=>Vi,INTERNAL_ERROR:()=>Za,INVALID_PARAMS:()=>_w,INVALID_REQUEST:()=>Iw,METHOD_NOT_FOUND:()=>Sw,PARSE_ERROR:()=>vw,RESERVED_ERROR_CODES:()=>zh,SERVER_ERROR:()=>qi,SERVER_ERROR_CODE_RANGE:()=>Xa,STANDARD_ERROR_MAP:()=>cs,formatErrorMessage:()=>Uw,formatJsonRpcError:()=>ks,formatJsonRpcRequest:()=>xt,formatJsonRpcResult:()=>Ls,getBigIntRpcId:()=>Nt,getError:()=>ec,getErrorByCode:()=>tc,isHttpUrl:()=>Q6,isJsonRpcError:()=>Qe,isJsonRpcPayload:()=>Gh,isJsonRpcRequest:()=>In,isJsonRpcResponse:()=>hs,isJsonRpcResult:()=>vt,isJsonRpcValidationInvalid:()=>e4,isLocalhostUrl:()=>Kh,isNodeJs:()=>Pw,isReservedErrorCode:()=>Qa,isServerErrorCode:()=>V6,isValidDefaultRoute:()=>sc,isValidErrorCode:()=>Aw,isValidLeadingWildcardRoute:()=>W6,isValidRoute:()=>G6,isValidTrailingWildcardRoute:()=>Y6,isValidWildcardRoute:()=>nc,isWsUrl:()=>oc,parseConnectionError:()=>jh,payloadId:()=>Bt,validateJsonRpcError:()=>$6});var vw="PARSE_ERROR",Iw="INVALID_REQUEST",Sw="METHOD_NOT_FOUND",_w="INVALID_PARAMS",Za="INTERNAL_ERROR",qi="SERVER_ERROR",zh=[-32700,-32600,-32601,-32602,-32603],Xa=[-32e3,-32099],cs={[vw]:{code:-32700,message:"Parse error"},[Iw]:{code:-32600,message:"Invalid Request"},[Sw]:{code:-32601,message:"Method not found"},[_w]:{code:-32602,message:"Invalid params"},[Za]:{code:-32603,message:"Internal error"},[qi]:{code:-32e3,message:"Server error"}},zi=qi;function V6(t){return t<=Xa[0]&&t>=Xa[1]}function Qa(t){return zh.includes(t)}function Aw(t){return typeof t=="number"}function ec(t){return Object.keys(cs).includes(t)?cs[t]:cs[zi]}function tc(t){let e=Object.values(cs).find(r=>r.code===t);return e||cs[zi]}function $6(t){if(typeof t.error.code>"u")return{valid:!1,error:"Missing code for JSON-RPC error"};if(typeof t.error.message>"u")return{valid:!1,error:"Missing message for JSON-RPC error"};if(!Aw(t.error.code))return{valid:!1,error:`Invalid error code type for JSON-RPC: ${t.error.code}`};if(Qa(t.error.code)){let e=tc(t.error.code);if(e.message!==cs[zi].message&&t.error.message===e.message)return{valid:!1,error:`Invalid error code message for JSON-RPC: ${t.error.code}`}}return{valid:!0}}function jh(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var at={};Ne(at,{isNodeJs:()=>Pw});var Nw=De($h());bt(at,De($h()));var Pw=Nw.isNode;bt(et,at);function Bt(t=3){let e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Nt(t=6){return BigInt(Bt(t))}function xt(t,e,r){return{id:r||Bt(),jsonrpc:"2.0",method:t,params:e}}function Ls(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ks(t,e,r){return{id:t,jsonrpc:"2.0",error:Uw(e,r)}}function Uw(t,e){return typeof t>"u"?ec(Za):(typeof t=="string"&&(t=Object.assign(Object.assign({},ec(qi)),{message:t})),typeof e<"u"&&(t.data=e),Qa(t.code)&&(t=tc(t.code)),t)}function G6(t){return t.includes("*")?nc(t):!/\W/g.test(t)}function sc(t){return t==="*"}function nc(t){return sc(t)?!0:!(!t.includes("*")||t.split("*").length!==2||t.split("*").filter(e=>e.trim()==="").length!==1)}function W6(t){return!sc(t)&&nc(t)&&!t.split("*")[0].trim()}function Y6(t){return!sc(t)&&nc(t)&&!t.split("*")[1].trim()}var ji=class{},Hh=class extends ji{constructor(e){super()}},ic=class extends ji{constructor(){super()}},Vi=class extends ic{constructor(e){super()}};var J6="^https?:",Z6="^wss?:";function X6(t){let e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Fw(t,e){let r=X6(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Q6(t){return Fw(t,J6)}function oc(t){return Fw(t,Z6)}function Kh(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Gh(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function In(t){return Gh(t)&&"method"in t}function hs(t){return Gh(t)&&(vt(t)||Qe(t))}function vt(t){return"result"in t}function Qe(t){return"error"in t}function e4(t){return"error"in t&&t.valid===!1}var ac=class extends Vi{constructor(e){super(e),this.events=new Lw.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(xt(e.method,e.params||[],e.id||Nt().toString()),r)}async requestStrict(e,r){return new Promise(async(s,n)=>{if(!this.connection.connected)try{await this.open()}catch(i){n(i)}this.events.on(`${e.id}`,i=>{Qe(i)?n(i.error):s(i.result)});try{await this.connection.send(e,r)}catch(i){n(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),hs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};var jw=De(ps());var t4=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:Mw(),r4=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",qw=t=>t.split("?")[0],zw=10,s4=t4(),cc=class{constructor(e){if(this.url=e,this.events=new jw.EventEmitter,this.registering=!1,!oc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Tt(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!oc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){let r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,n)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),n(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,s)=>{let n=(0,et.isReactNative)()?void 0:{rejectUnauthorized:!Kh(e)},i=new s4(e,[],n);r4()?i.onerror=o=>{let a=o;s(this.emitError(a.error))}:i.on("error",o=>{s(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),r(i)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;let r=typeof e.data=="string"?Yt(e.data):e.data;this.events.emit("payload",r)}onError(e,r){let s=this.parseError(r),n=s.message||s.toString(),i=ks(e,n);this.events.emit("payload",i)}parseError(e,r=this.url){return jh(e,qw(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>zw&&this.events.setMaxListeners(zw)}emitError(e){let r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${qw(this.url)}`));return this.events.emit("register_error",r),r}};var db=De(zo()),pb="wc",gb=2,lc="core",or=`${pb}@2:${lc}:`,n4={name:lc,logger:"error"},i4={database:":memory:"},o4="crypto",Vw="client_ed25519_seed",a4=K.ONE_DAY,c4="keychain",u4="0.3",l4="messages",h4="0.3",f4=K.SIX_HOURS,d4="publisher",Tf="irn",p4="error",mb="wss://relay.walletconnect.org",g4="relayer",be={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},m4="_subscription",Pt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},y4=.1;var Zh="2.21.8";var pe={link_mode:"link_mode",relay:"relay"},uc={inbound:"inbound",outbound:"outbound"},w4="0.3",b4="WALLETCONNECT_CLIENT_ID",$w="WALLETCONNECT_LINK_MODE_APPS",St={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"};var E4="subscription",x4="0.3",iN=K.FIVE_SECONDS*1e3,v4="pairing",I4="0.3";var $i={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},fs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},S4="history",_4="0.3",A4="expirer",_t={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},D4="0.3";var T4="verify-api",R4="https://verify.walletconnect.com",yb="https://verify.walletconnect.org",An=yb,O4=`${An}/v3`,C4=[R4,yb],B4="echo",N4="https://echo.walletconnect.com";var Gt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ir={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Br={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Dn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},ds={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Tn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},P4=.1,U4="event-client",F4=86400,L4="https://pulse.walletconnect.org/batch";function k4(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,S=0,A=d.length;S!==A&&d[S]===0;)S++,g++;for(var b=(A-S)*l+1>>>0,E=new Uint8Array(b);S!==A;){for(var v=d[S],O=0,P=b-1;(v!==0||O<m)&&P!==-1;P--,O++)v+=256*E[P]>>>0,E[P]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");m=O,S++}for(var N=b-m;N!==b&&E[N]===0;)N++;for(var w=c.repeat(g);N<b;++N)w+=t.charAt(E[N]);return w}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,S=0;d[g]===c;)m++,g++;for(var A=(d.length-g)*u+1>>>0,b=new Uint8Array(A);d[g];){var E=r[d.charCodeAt(g)];if(E===255)return;for(var v=0,O=A-1;(E!==0||v<S)&&O!==-1;O--,v++)E+=a*b[O]>>>0,b[O]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");S=v,g++}if(d[g]!==" "){for(var P=A-S;P!==A&&b[P]===0;)P++;for(var N=new Uint8Array(m+(A-P)),w=m;P!==A;)N[w++]=b[P++];return N}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var M4=k4,q4=M4,wb=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},z4=t=>new TextEncoder().encode(t),j4=t=>new TextDecoder().decode(t),Xh=class{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Qh=class{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bb(this,e)}},ef=class{constructor(e){this.decoders=e}or(e){return bb(this,e)}decode(e){let r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},bb=(t,e)=>new ef({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),tf=class{constructor(e,r,s,n){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=n,this.encoder=new Xh(e,r,s),this.decoder=new Qh(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},hc=({name:t,prefix:e,encode:r,decode:s})=>new tf(t,e,r,s),Yi=({prefix:t,name:e,alphabet:r})=>{let{encode:s,decode:n}=q4(r,e);return hc({prefix:t,name:e,encode:s,decode:i=>wb(n(i))})},V4=(t,e,r,s)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,c=0,u=0;for(let l=0;l<i;++l){let h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},$4=(t,e,r)=>{let s=e[e.length-1]==="=",n=(1<<r)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[n&a>>o];if(o&&(i+=e[n&a<<r-o]),s)for(;i.length*r&7;)i+="=";return i},ze=({name:t,prefix:e,bitsPerChar:r,alphabet:s})=>hc({prefix:e,name:t,encode(n){return $4(n,s,r)},decode(n){return V4(n,s,r,t)}}),H4=hc({prefix:"\0",name:"identity",encode:t=>j4(t),decode:t=>z4(t)}),K4=Object.freeze({__proto__:null,identity:H4}),G4=ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),W4=Object.freeze({__proto__:null,base2:G4}),Y4=ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),J4=Object.freeze({__proto__:null,base8:Y4}),Z4=Yi({prefix:"9",name:"base10",alphabet:"0123456789"}),X4=Object.freeze({__proto__:null,base10:Z4}),Q4=ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),eA=ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),tA=Object.freeze({__proto__:null,base16:Q4,base16upper:eA}),rA=ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sA=ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nA=ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),iA=ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oA=ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),aA=ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cA=ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),uA=ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lA=ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),hA=Object.freeze({__proto__:null,base32:rA,base32upper:sA,base32pad:nA,base32padupper:iA,base32hex:oA,base32hexupper:aA,base32hexpad:cA,base32hexpadupper:uA,base32z:lA}),fA=Yi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),dA=Yi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),pA=Object.freeze({__proto__:null,base36:fA,base36upper:dA}),gA=Yi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mA=Yi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),yA=Object.freeze({__proto__:null,base58btc:gA,base58flickr:mA}),wA=ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bA=ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),EA=ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xA=ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),vA=Object.freeze({__proto__:null,base64:wA,base64pad:bA,base64url:EA,base64urlpad:xA}),Eb=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),IA=Eb.reduce((t,e,r)=>(t[r]=e,t),[]),SA=Eb.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _A(t){return t.reduce((e,r)=>(e+=IA[r],e),"")}function AA(t){let e=[];for(let r of t){let s=SA[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}var DA=hc({prefix:"\u{1F680}",name:"base256emoji",encode:_A,decode:AA}),TA=Object.freeze({__proto__:null,base256emoji:DA}),RA=xb,Hw=128,OA=127,CA=~OA,BA=Math.pow(2,31);function xb(t,e,r){e=e||[],r=r||0;for(var s=r;t>=BA;)e[r++]=t&255|Hw,t/=128;for(;t&CA;)e[r++]=t&255|Hw,t>>>=7;return e[r]=t|0,xb.bytes=r-s+1,e}var NA=rf,PA=128,Kw=127;function rf(t,s){var r=0,s=s||0,n=0,i=s,o,a=t.length;do{if(i>=a)throw rf.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=n<28?(o&Kw)<<n:(o&Kw)*Math.pow(2,n),n+=7}while(o>=PA);return rf.bytes=i-s,r}var UA=Math.pow(2,7),FA=Math.pow(2,14),LA=Math.pow(2,21),kA=Math.pow(2,28),MA=Math.pow(2,35),qA=Math.pow(2,42),zA=Math.pow(2,49),jA=Math.pow(2,56),VA=Math.pow(2,63),$A=function(t){return t<UA?1:t<FA?2:t<LA?3:t<kA?4:t<MA?5:t<qA?6:t<zA?7:t<jA?8:t<VA?9:10},HA={encode:RA,decode:NA,encodingLength:$A},vb=HA,Gw=(t,e,r=0)=>(vb.encode(t,e,r),e),Ww=t=>vb.encodingLength(t),sf=(t,e)=>{let r=e.byteLength,s=Ww(t),n=s+Ww(r),i=new Uint8Array(n+r);return Gw(t,i,0),Gw(r,i,s),i.set(e,n),new nf(t,r,e,i)},nf=class{constructor(e,r,s,n){this.code=e,this.size=r,this.digest=s,this.bytes=n}},Ib=({name:t,code:e,encode:r})=>new of(t,e,r),of=class{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?sf(this.code,r):r.then(s=>sf(this.code,s))}else throw Error("Unknown type, must be binary type")}},Sb=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),KA=Ib({name:"sha2-256",code:18,encode:Sb("SHA-256")}),GA=Ib({name:"sha2-512",code:19,encode:Sb("SHA-512")}),WA=Object.freeze({__proto__:null,sha256:KA,sha512:GA}),_b=0,YA="identity",Ab=wb,JA=t=>sf(_b,Ab(t)),ZA={code:_b,name:YA,encode:Ab,digest:JA},XA=Object.freeze({__proto__:null,identity:ZA});new TextEncoder,new TextDecoder;var Yw={...K4,...W4,...J4,...X4,...tA,...hA,...pA,...yA,...vA,...TA};({...WA,...XA});function Db(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function QA(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Db(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Tb(t,e,r,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:s}}}var Jw=Tb("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Wh=Tb("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=QA(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),eD={utf8:Jw,"utf-8":Jw,hex:Yw.base16,latin1:Wh,ascii:Wh,binary:Wh,...Yw};function tD(t,e="utf8"){let r=eD[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Db(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var rD=Object.defineProperty,sD=(t,e,r)=>e in t?rD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nr=(t,e,r)=>sD(t,typeof e!="symbol"?e+"":e,r),af=class{constructor(e,r){this.core=e,this.logger=r,nr(this,"keychain",new Map),nr(this,"name",c4),nr(this,"version",u4),nr(this,"initialized",!1),nr(this,"storagePrefix",or),nr(this,"init",async()=>{if(!this.initialized){let s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}}),nr(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),nr(this,"set",async(s,n)=>{this.isInitialized(),this.keychain.set(s,n),await this.persist()}),nr(this,"get",s=>{this.isInitialized();let n=this.keychain.get(s);if(typeof n>"u"){let{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(i)}return n}),nr(this,"del",async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()}),this.core=e,this.logger=Pe(r,this.name)}get context(){return Ve(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ma(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qa(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}},nD=Object.defineProperty,iD=(t,e,r)=>e in t?nD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Me=(t,e,r)=>iD(t,typeof e!="symbol"?e+"":e,r),cf=class{constructor(e,r,s){this.core=e,this.logger=r,Me(this,"name",o4),Me(this,"keychain"),Me(this,"randomSessionIdentifier",Ya()),Me(this,"initialized",!1),Me(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Me(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),Me(this,"getClientId",async()=>{this.isInitialized();let n=await this.getClientSeed(),i=pu(n);return du(i.publicKey)}),Me(this,"generateKeyPair",()=>{this.isInitialized();let n=Vy();return this.setPrivateKey(n.publicKey,n.privateKey)}),Me(this,"signJWT",async n=>{this.isInitialized();let i=await this.getClientSeed(),o=pu(i),a=this.randomSessionIdentifier;return await Lp(a,n,a4,o)}),Me(this,"generateSharedKey",(n,i,o)=>{this.isInitialized();let a=this.getPrivateKey(n),c=$y(a,i);return this.setSymKey(c,o)}),Me(this,"setSymKey",async(n,i)=>{this.isInitialized();let o=i||bn(n);return await this.keychain.set(o,n),o}),Me(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),Me(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),Me(this,"encode",async(n,i,o)=>{this.isInitialized();let a=Oh(o),c=Tt(i);if(Bh(a))return Jy(c,o?.encoding);if(Ch(a)){let f=a.senderPublicKey,p=a.receiverPublicKey;n=await this.generateSharedKey(f,p)}let u=this.getSymKey(n),{type:l,senderPublicKey:h}=a;return Wy({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),Me(this,"decode",async(n,i,o)=>{this.isInitialized();let a=Qy(i,o);if(Bh(a)){let c=Zy(i,o?.encoding);return Yt(c)}if(Ch(a)){let c=a.receiverPublicKey,u=a.senderPublicKey;n=await this.generateSharedKey(c,u)}try{let c=this.getSymKey(n),u=Yy({symKey:c,encoded:i,encoding:o?.encoding});return Yt(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Me(this,"getPayloadType",(n,i=Ze)=>{let o=En({encoded:n,encoding:i});return os(o.type)}),Me(this,"getPayloadSenderPublicKey",(n,i=Ze)=>{let o=En({encoded:n,encoding:i});return o.senderPublicKey?Fe(o.senderPublicKey,Je):void 0}),this.core=e,this.logger=Pe(r,this.name),this.keychain=s||new af(this.core,this.logger)}get context(){return Ve(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Vw)}catch{e=Ya(),await this.keychain.set(Vw,e)}return tD(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}},oD=Object.defineProperty,aD=Object.defineProperties,cD=Object.getOwnPropertyDescriptors,Zw=Object.getOwnPropertySymbols,uD=Object.prototype.hasOwnProperty,lD=Object.prototype.propertyIsEnumerable,uf=(t,e,r)=>e in t?oD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hD=(t,e)=>{for(var r in e||(e={}))uD.call(e,r)&&uf(t,r,e[r]);if(Zw)for(var r of Zw(e))lD.call(e,r)&&uf(t,r,e[r]);return t},fD=(t,e)=>aD(t,cD(e)),It=(t,e,r)=>uf(t,typeof e!="symbol"?e+"":e,r),lf=class extends xo{constructor(e,r){super(e,r),this.logger=e,this.core=r,It(this,"messages",new Map),It(this,"messagesWithoutClientAck",new Map),It(this,"name",l4),It(this,"version",h4),It(this,"initialized",!1),It(this,"storagePrefix",or),It(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s);let n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}}),It(this,"set",async(s,n,i)=>{this.isInitialized();let o=mt(n),a=this.messages.get(s);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(s,a),i===uc.inbound){let c=this.messagesWithoutClientAck.get(s)||{};this.messagesWithoutClientAck.set(s,fD(hD({},c),{[o]:n}))}return await this.persist(),o}),It(this,"get",s=>{this.isInitialized();let n=this.messages.get(s);return typeof n>"u"&&(n={}),n}),It(this,"getWithoutAck",s=>{this.isInitialized();let n={};for(let i of s){let o=this.messagesWithoutClientAck.get(i)||{};n[i]=Object.values(o)}return n}),It(this,"has",(s,n)=>{this.isInitialized();let i=this.get(s),o=mt(n);return typeof i[o]<"u"}),It(this,"ack",async(s,n)=>{this.isInitialized();let i=this.messagesWithoutClientAck.get(s);if(typeof i>"u")return;let o=mt(n);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(s):this.messagesWithoutClientAck.set(s,i),await this.persist()}),It(this,"del",async s=>{this.isInitialized(),this.messages.delete(s),this.messagesWithoutClientAck.delete(s),await this.persist()}),this.logger=Pe(e,this.name),this.core=r}get context(){return Ve(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ma(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ma(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qa(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?qa(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}},dD=Object.defineProperty,pD=Object.defineProperties,gD=Object.getOwnPropertyDescriptors,Xw=Object.getOwnPropertySymbols,mD=Object.prototype.hasOwnProperty,yD=Object.prototype.propertyIsEnumerable,hf=(t,e,r)=>e in t?dD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sn=(t,e)=>{for(var r in e||(e={}))mD.call(e,r)&&hf(t,r,e[r]);if(Xw)for(var r of Xw(e))yD.call(e,r)&&hf(t,r,e[r]);return t},Qw=(t,e)=>pD(t,gD(e)),Ut=(t,e,r)=>hf(t,typeof e!="symbol"?e+"":e,r),ff=class extends vo{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Ut(this,"events",new Cr.EventEmitter),Ut(this,"name",d4),Ut(this,"queue",new Map),Ut(this,"publishTimeout",(0,K.toMiliseconds)(K.ONE_MINUTE)),Ut(this,"initialPublishTimeout",(0,K.toMiliseconds)(K.ONE_SECOND*15)),Ut(this,"needsTransportRestart",!1),Ut(this,"publish",async(s,n,i)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:n,opts:i}});let h=i?.ttl||f4,f=i?.prompt||!1,p=i?.tag||0,d=i?.id||Nt().toString(),g=Us(ki().protocol),m={id:d,method:i?.publishMethod||g.publish,params:Sn({topic:s,message:n,ttl:h,prompt:f,tag:p,attestation:i?.attestation},i?.tvf&&{tvf:i.tvf})},S=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{Ie((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),Ie((c=m.params)==null?void 0:c.tag)&&((u=m.params)==null||delete u.tag);let A=new Promise(async b=>{let E=({id:O})=>{var P;((P=m.id)==null?void 0:P.toString())===O.toString()&&(this.removeRequestFromQueue(O),this.relayer.events.removeListener(be.publish,E),b())};this.relayer.events.on(be.publish,E);let v=$t(new Promise((O,P)=>{this.rpcPublish(m,i).then(O).catch(N=>{this.logger.warn(N,N?.message),P(N)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await v,this.events.removeListener(be.publish,E)}catch(O){this.queue.set(d,{request:m,opts:i,attempt:1}),this.logger.warn(O,O?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:s,message:n,opts:i}}),await $t(A,this.publishTimeout,S)}catch(A){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(A),(l=i?.internal)!=null&&l.throwOnFailedPublish)throw A}finally{this.queue.delete(d)}}),Ut(this,"publishCustom",async s=>{var n,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:s});let{payload:u,opts:l={}}=s,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:m=K.FIVE_MINUTES}=l,S=l.id||Nt().toString(),A=Us(ki().protocol),b=p||A.publish,E={id:S,method:b,params:Sn(Qw(Sn({},u),{ttl:m,prompt:d,tag:g,attestation:h}),f)},v=`Failed to publish custom payload, please try again. id:${S} tag:${g}`;try{Ie((n=E.params)==null?void 0:n.prompt)&&((i=E.params)==null||delete i.prompt),Ie((o=E.params)==null?void 0:o.tag)&&((a=E.params)==null||delete a.tag);let O=new Promise(async P=>{let N=({id:C})=>{var _;((_=E.id)==null?void 0:_.toString())===C.toString()&&(this.removeRequestFromQueue(C),this.relayer.events.removeListener(be.publish,N),P())};this.relayer.events.on(be.publish,N);let w=$t(new Promise((C,_)=>{this.rpcPublish(E,l).then(C).catch(T=>{this.logger.warn(T,T?.message),_(T)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${S} tag:${g}`);try{await w,this.events.removeListener(be.publish,N)}catch(C){this.queue.set(S,{request:E,opts:l,attempt:1}),this.logger.warn(C,C?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:S,payload:u,opts:l}}),await $t(O,this.publishTimeout,v)}catch(O){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(O),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw O}finally{this.queue.delete(S)}}),Ut(this,"on",(s,n)=>{this.events.on(s,n)}),Ut(this,"once",(s,n)=>{this.events.once(s,n)}),Ut(this,"off",(s,n)=>{this.events.off(s,n)}),Ut(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),this.relayer=e,this.logger=Pe(r,this.name),this.registerEventListeners()}get context(){return Ve(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let s=await this.relayer.request(e);return this.relayer.events.emit(be.publish,Sn(Sn({},e),r)),this.logger.debug("Successfully Published Payload"),s}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var s;let n=e.attempt+1;this.queue.set(r,Qw(Sn({},e),{attempt:n})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(s=e.request.params)==null?void 0:s.tag}, attempt: ${n}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Nr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(be.connection_stalled);return}this.checkQueue()}),this.relayer.on(be.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},wD=Object.defineProperty,bD=(t,e,r)=>e in t?wD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_n=(t,e,r)=>bD(t,typeof e!="symbol"?e+"":e,r),df=class{constructor(){_n(this,"map",new Map),_n(this,"set",(e,r)=>{let s=this.get(e);this.exists(e,r)||this.map.set(e,[...s,r])}),_n(this,"get",e=>this.map.get(e)||[]),_n(this,"exists",(e,r)=>this.get(e).includes(r)),_n(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let s=this.get(e);if(!this.exists(e,r))return;let n=s.filter(i=>i!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),_n(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},ED=Object.defineProperty,xD=Object.defineProperties,vD=Object.getOwnPropertyDescriptors,eb=Object.getOwnPropertySymbols,ID=Object.prototype.hasOwnProperty,SD=Object.prototype.propertyIsEnumerable,pf=(t,e,r)=>e in t?ED(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hi=(t,e)=>{for(var r in e||(e={}))ID.call(e,r)&&pf(t,r,e[r]);if(eb)for(var r of eb(e))SD.call(e,r)&&pf(t,r,e[r]);return t},Yh=(t,e)=>xD(t,vD(e)),he=(t,e,r)=>pf(t,typeof e!="symbol"?e+"":e,r),gf=class extends _o{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,he(this,"subscriptions",new Map),he(this,"topicMap",new df),he(this,"events",new Cr.EventEmitter),he(this,"name",E4),he(this,"version",x4),he(this,"pending",new Map),he(this,"cached",[]),he(this,"initialized",!1),he(this,"storagePrefix",or),he(this,"subscribeTimeout",(0,K.toMiliseconds)(K.ONE_MINUTE)),he(this,"initialSubscribeTimeout",(0,K.toMiliseconds)(K.ONE_SECOND*15)),he(this,"clientId"),he(this,"batchSubscribeTopicsLimit",500),he(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),he(this,"subscribe",async(s,n)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:n}});try{let o=ki(n),a={topic:s,relay:o,transportType:n?.transportType};(i=n?.internal)!=null&&i.skipSubscribe||this.pending.set(s,a);let c=await this.rpcSubscribe(s,o,n);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:n}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),he(this,"unsubscribe",async(s,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(s,n.id,n):await this.unsubscribeByTopic(s,n)}),he(this,"isSubscribed",s=>new Promise(n=>{n(this.topicMap.topics.includes(s))})),he(this,"isKnownTopic",s=>new Promise(n=>{n(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(i=>i.topic===s))})),he(this,"on",(s,n)=>{this.events.on(s,n)}),he(this,"once",(s,n)=>{this.events.once(s,n)}),he(this,"off",(s,n)=>{this.events.off(s,n)}),he(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),he(this,"start",async()=>{await this.onConnect()}),he(this,"stop",async()=>{await this.onDisconnect()}),he(this,"restart",async()=>{await this.restore(),await this.onRestart()}),he(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let s=[];this.pending.forEach(n=>{s.push(n)}),await this.batchSubscribe(s)}),he(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Nr.pulse,async()=>{await this.checkPending()}),this.events.on(St.created,async s=>{let n=St.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:s}),await this.persist()}),this.events.on(St.deleted,async s=>{let n=St.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:s}),await this.persist()})}),this.relayer=e,this.logger=Pe(r,this.name),this.clientId=""}get context(){return Ve(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let s=!1;try{s=this.getSubscription(e).topic===r}catch{}return s}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){let s=this.topicMap.get(e);await Promise.all(s.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}});try{let n=ki(s);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);let i=ge("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,s){var n,i;let o=await this.getSubscriptionId(e);if((n=s?.internal)!=null&&n.skipSubscribe)return o;(!s||s?.transportType===pe.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});let a={method:Us(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let c=(i=s?.internal)==null?void 0:i.throwOnFailedPublish;try{if(s?.transportType===pe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},(0,K.toMiliseconds)(K.ONE_SECOND)),o;let u=new Promise(async h=>{let f=p=>{p.topic===e&&(this.events.removeListener(St.created,f),h(p.id))};this.events.on(St.created,f);try{let p=await $t(new Promise((d,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),g(m)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(St.created,f),h(p)}catch{}}),l=await $t(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(be.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;let r=e[0].relay,s={method:Us(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await $t(new Promise(n=>{this.relayer.request(s).catch(i=>this.logger.warn(i)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let r=e[0].relay,s={method:Us(r.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let n;try{n=await await $t(new Promise((i,o)=>{this.relayer.request(s).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}return n}rpcUnsubscribe(e,r,s){let n={method:Us(s.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,Yh(Hi({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Hi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Hi({},r)),this.topicMap.set(r.topic,e),this.events.emit(St.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let r=this.subscriptions.get(e);if(!r){let{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});let s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(St.deleted,Yh(Hi({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(St.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<r;s++){let n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(St.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var s;return r.topic===((s=this.subscriptions.get(r.id))==null?void 0:s.topic)})){let{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Yh(Hi({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await sy((0,K.toMiliseconds)(K.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return mt(e+await this.getClientId())}},_D=Object.defineProperty,tb=Object.getOwnPropertySymbols,AD=Object.prototype.hasOwnProperty,DD=Object.prototype.propertyIsEnumerable,mf=(t,e,r)=>e in t?_D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rb=(t,e)=>{for(var r in e||(e={}))AD.call(e,r)&&mf(t,r,e[r]);if(tb)for(var r of tb(e))DD.call(e,r)&&mf(t,r,e[r]);return t},ie=(t,e,r)=>mf(t,typeof e!="symbol"?e+"":e,r),yf=class extends Io{constructor(e){super(e),ie(this,"protocol","wc"),ie(this,"version",2),ie(this,"core"),ie(this,"logger"),ie(this,"events",new Cr.EventEmitter),ie(this,"provider"),ie(this,"messages"),ie(this,"subscriber"),ie(this,"publisher"),ie(this,"name",g4),ie(this,"transportExplicitlyClosed",!1),ie(this,"initialized",!1),ie(this,"connectionAttemptInProgress",!1),ie(this,"relayUrl"),ie(this,"projectId"),ie(this,"packageName"),ie(this,"bundleId"),ie(this,"hasExperiencedNetworkDisruption",!1),ie(this,"pingTimeout"),ie(this,"heartBeatTimeout",(0,K.toMiliseconds)(K.THIRTY_SECONDS+K.FIVE_SECONDS)),ie(this,"reconnectTimeout"),ie(this,"connectPromise"),ie(this,"reconnectInProgress",!1),ie(this,"requestsInFlight",[]),ie(this,"connectTimeout",(0,K.toMiliseconds)(K.ONE_SECOND*15)),ie(this,"request",async r=>{var s,n;this.logger.debug("Publishing Request Payload");let i=r.id||Nt().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:r.method,topic:(s=r.params)==null?void 0:s.topic},"relayer.request - publishing...");let o=`${i}:${((n=r.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(o);let a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${i}`),o}}),ie(this,"resetPingTimeout",()=>{Ci()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,s,n,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(i=(n=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null?void 0:n.terminate)==null||i.call(n)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),ie(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),ie(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(be.connect)}),ie(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),ie(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(be.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ie(this,"registerProviderListeners",()=>{this.provider.on(Pt.payload,this.onPayloadHandler),this.provider.on(Pt.connect,this.onConnectHandler),this.provider.on(Pt.disconnect,this.onDisconnectHandler),this.provider.on(Pt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Pe(e.logger,this.name):(0,kn.default)(qn({level:e.logger||p4})),this.messages=new lf(this.logger,e.core),this.subscriber=new gf(this,this.logger),this.publisher=new ff(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||mb,Gm()?this.packageName=ch():Wm()&&(this.bundleId=ch()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Ve(this.logger)}get connected(){var e,r,s;return((s=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:s.readyState)===1||!1}get connecting(){var e,r,s;return((s=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:s.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,s){this.isInitialized(),await this.publisher.publish(e,r,s),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:pe.relay},uc.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var s,n,i;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();let o=typeof((s=r?.internal)==null?void 0:s.throwOnFailedPublish)>"u"?!0:(n=r?.internal)==null?void 0:n.throwOnFailedPublish,a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c,u=l=>{l.topic===e&&(this.subscriber.off(St.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(St.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,rb({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await $t(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,s)=>{await this.connect(e).then(r).catch(s).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await qh())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let r=e.sort((s,n)=>s.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(let s of r)try{await this.onMessageEvent(s)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){let{topic:s}=e;if(!r.sessionExists){let n=Se(K.FIVE_MINUTES),i={topic:s,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(s,i)}this.events.emit(be.message,e),await this.recordMessageEvent(e,uc.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(s,n)=>{let i=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(Pt.disconnect,i),await $t(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(Pt.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{let c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Pt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Pt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){await this.subscriber.stop();let n=s;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(s=>setTimeout(s,(0,K.toMiliseconds)(r*1))),r++}}startPingTimeout(){var e,r,s,n,i;if(Ci())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((i=(n=(s=this.provider)==null?void 0:s.connection)==null?void 0:n.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ac(new cc(Jm({sdkVersion:Zh,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){let{topic:s,message:n}=e;await this.messages.set(s,n,r)}async shouldIgnoreMessageEvent(e){let{topic:r,message:s}=e;if(!s||s.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;let n=this.messages.has(r,s);return n&&this.logger.warn(`Ignoring duplicate message: ${s}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),In(e)){if(!e.method.endsWith(m4))return;let r=e.params,{topic:s,message:n,publishedAt:i,attestation:o}=r.data,a={topic:s,message:n,publishedAt:i,transportType:pe.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(rb({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else hs(e)&&this.events.emit(be.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,uc.inbound),this.events.emit(be.message,e))}async acknowledgePayload(e){let r=Ls(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Pt.payload,this.onPayloadHandler),this.provider.off(Pt.connect,this.onConnectHandler),this.provider.off(Pt.disconnect,this.onDisconnectHandler),this.provider.off(Pt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await qh();bw(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(s=>this.logger.error(s,s?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Nr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Ew())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(be.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,K.toMiliseconds)(y4)))))}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function TD(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function sb(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function nb(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var RD="[object RegExp]",OD="[object String]",CD="[object Number]",BD="[object Boolean]",ib="[object Arguments]",ND="[object Symbol]",PD="[object Date]",UD="[object Map]",FD="[object Set]",LD="[object Array]",kD="[object Function]",MD="[object ArrayBuffer]",Jh="[object Object]",qD="[object Error]",zD="[object DataView]",jD="[object Uint8Array]",VD="[object Uint8ClampedArray]",$D="[object Uint16Array]",HD="[object Uint32Array]",KD="[object BigUint64Array]",GD="[object Int8Array]",WD="[object Int16Array]",YD="[object Int32Array]",JD="[object BigInt64Array]",ZD="[object Float32Array]",XD="[object Float64Array]";function QD(){}function ob(t){if(!t||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function e5(t,e,r){return Gi(t,e,void 0,void 0,void 0,void 0,r)}function Gi(t,e,r,s,n,i,o){let a=o(t,e,r,s,n,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Wi(t,e,i,o)}return Wi(t,e,i,o)}function Wi(t,e,r,s){if(Object.is(t,e))return!0;let n=nb(t),i=nb(e);if(n===ib&&(n=Jh),i===ib&&(i=Jh),n!==i)return!1;switch(n){case OD:return t.toString()===e.toString();case CD:{let c=t.valueOf(),u=e.valueOf();return TD(c,u)}case BD:case PD:case ND:return Object.is(t.valueOf(),e.valueOf());case RD:return t.source===e.source&&t.flags===e.flags;case kD:return t===e}r=r??new Map;let o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case UD:{if(t.size!==e.size)return!1;for(let[c,u]of t.entries())if(!e.has(c)||!Gi(u,e.get(c),c,t,e,r,s))return!1;return!0}case FD:{if(t.size!==e.size)return!1;let c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){let h=c[l],f=u.findIndex(p=>Gi(h,p,void 0,t,e,r,s));if(f===-1)return!1;u.splice(f,1)}return!0}case LD:case jD:case VD:case $D:case HD:case KD:case GD:case WD:case YD:case JD:case ZD:case XD:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Gi(t[c],e[c],c,t,e,r,s))return!1;return!0}case MD:return t.byteLength!==e.byteLength?!1:Wi(new Uint8Array(t),new Uint8Array(e),r,s);case zD:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Wi(new Uint8Array(t),new Uint8Array(e),r,s);case qD:return t.name===e.name&&t.message===e.message;case Jh:{if(!(Wi(t.constructor,e.constructor,r,s)||ob(t)&&ob(e)))return!1;let c=[...Object.keys(t),...sb(t)],u=[...Object.keys(e),...sb(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){let h=c[l],f=t[h];if(!Object.hasOwn(e,h))return!1;let p=e[h];if(!Gi(f,p,h,t,e,r,s))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function t5(t,e){return e5(t,e,QD)}var r5=Object.defineProperty,ab=Object.getOwnPropertySymbols,s5=Object.prototype.hasOwnProperty,n5=Object.prototype.propertyIsEnumerable,wf=(t,e,r)=>e in t?r5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cb=(t,e)=>{for(var r in e||(e={}))s5.call(e,r)&&wf(t,r,e[r]);if(ab)for(var r of ab(e))n5.call(e,r)&&wf(t,r,e[r]);return t},yt=(t,e,r)=>wf(t,typeof e!="symbol"?e+"":e,r),ar=class extends So{constructor(e,r,s,n=or,i=void 0){super(e,r,s,n),this.core=e,this.logger=r,this.name=s,yt(this,"map",new Map),yt(this,"version",w4),yt(this,"cached",[]),yt(this,"initialized",!1),yt(this,"getKey"),yt(this,"storagePrefix",or),yt(this,"recentlyDeleted",[]),yt(this,"recentlyDeletedLimit",200),yt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ie(o)?this.map.set(this.getKey(o),o):iw(o)?this.map.set(o.id,o):ow(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),yt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),yt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),yt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>t5(a[c],o[c]))):this.values)),yt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=cb(cb({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),yt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Pe(r,this.name),this.storagePrefix=n,this.getKey=i}get context(){return Ve(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){let{message:n}=q("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}let{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}},i5=Object.defineProperty,o5=(t,e,r)=>e in t?i5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ee=(t,e,r)=>o5(t,typeof e!="symbol"?e+"":e,r),bf=class{constructor(e,r){this.core=e,this.logger=r,ee(this,"name",v4),ee(this,"version",I4),ee(this,"events",new Cr.default),ee(this,"pairings"),ee(this,"initialized",!1),ee(this,"storagePrefix",or),ee(this,"ignoredPayloadTypes",[Ht]),ee(this,"registeredMethods",[]),ee(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ee(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),ee(this,"create",async s=>{this.isInitialized();let n=Ya(),i=await this.core.crypto.setSymKey(n),o=Se(K.FIVE_MINUTES),a={protocol:Tf},c={topic:i,expiry:o,relay:a,active:!1,methods:s?.methods},u=Ph({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:n,relay:a,expiryTimestamp:o,methods:s?.methods});return this.events.emit(fs.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:s?.transportType,internal:s?.internal}),{topic:i,uri:u}}),ee(this,"pair",async s=>{this.isInitialized();let n=this.core.eventClient.createEvent({properties:{topic:s?.uri,trace:[Gt.pairing_started]}});this.isValidPair(s,n);let{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Nh(s.uri);n.props.properties.topic=i,n.addTrace(Gt.pairing_uri_validation_success),n.addTrace(Gt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(i)){if(l=this.pairings.get(i),n.addTrace(Gt.existing_pairing),l.active)throw n.setError(ir.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);n.addTrace(Gt.pairing_not_expired)}let h=c||Se(K.FIVE_MINUTES),f={topic:i,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(i,h),await this.pairings.set(i,f),n.addTrace(Gt.store_new_pairing),s.activatePairing&&await this.activate({topic:i}),this.events.emit(fs.create,f),n.addTrace(Gt.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),n.addTrace(Gt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(ir.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(p){throw n.setError(ir.subscribe_pairing_topic_failure),p}return n.addTrace(Gt.subscribe_pairing_topic_success),f}),ee(this,"activate",async({topic:s})=>{this.isInitialized();let n=Se(K.FIVE_MINUTES);this.core.expirer.set(s,n),await this.pairings.update(s,{active:!0,expiry:n})}),ee(this,"ping",async s=>{this.isInitialized(),await this.isValidPing(s),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:n}=s;if(this.pairings.keys.includes(n)){let i=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Rr();this.events.once(ne("pairing_ping",i),({error:u})=>{u?c(u):a()}),await o()}}),ee(this,"updateExpiry",async({topic:s,expiry:n})=>{this.isInitialized(),await this.pairings.update(s,{expiry:n})}),ee(this,"updateMetadata",async({topic:s,metadata:n})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:n})}),ee(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ee(this,"disconnect",async s=>{this.isInitialized(),await this.isValidDisconnect(s);let{topic:n}=s;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",ge("USER_DISCONNECTED")),await this.deletePairing(n))}),ee(this,"formatUriFromPairing",s=>{this.isInitialized();let{topic:n,relay:i,expiry:o,methods:a}=s,c=this.core.crypto.keychain.get(n);return Ph({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),ee(this,"sendRequest",async(s,n,i)=>{let o=xt(n,i),a=await this.core.crypto.encode(s,o),c=$i[n].req;return this.core.history.set(s,o),this.core.relayer.publish(s,a,c),o.id}),ee(this,"sendResult",async(s,n,i)=>{let o=Ls(s,i),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,s)).request.method,u=$i[c].res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),ee(this,"sendError",async(s,n,i)=>{let o=ks(s,i),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,s)).request.method,u=$i[c]?$i[c].res:$i.unregistered_method.res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),ee(this,"deletePairing",async(s,n)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ge("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),n?Promise.resolve():this.core.expirer.del(s)])}),ee(this,"cleanup",async()=>{let s=this.pairings.getAll().filter(n=>sr(n.expiry));await Promise.all(s.map(n=>this.deletePairing(n.topic)))}),ee(this,"onRelayEventRequest",async s=>{let{topic:n,payload:i}=s;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,i);default:return await this.onUnknownRpcMethodRequest(n,i)}}),ee(this,"onRelayEventResponse",async s=>{let{topic:n,payload:i}=s,o=(await this.core.history.get(n,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,i);default:return this.onUnknownRpcMethodResponse(o)}}),ee(this,"onPairingPingRequest",async(s,n)=>{let{id:i}=n;try{this.isValidPing({topic:s}),await this.sendResult(i,s,!0),this.events.emit(fs.ping,{id:i,topic:s})}catch(o){await this.sendError(i,s,o),this.logger.error(o)}}),ee(this,"onPairingPingResponse",(s,n)=>{let{id:i}=n;setTimeout(()=>{vt(n)?this.events.emit(ne("pairing_ping",i),{}):Qe(n)&&this.events.emit(ne("pairing_ping",i),{error:n.error})},500)}),ee(this,"onPairingDeleteRequest",async(s,n)=>{let{id:i}=n;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(fs.delete,{id:i,topic:s})}catch(o){await this.sendError(i,s,o),this.logger.error(o)}}),ee(this,"onUnknownRpcMethodRequest",async(s,n)=>{let{id:i,method:o}=n;try{if(this.registeredMethods.includes(o))return;let a=ge("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,s,a),this.logger.error(a)}catch(a){await this.sendError(i,s,a),this.logger.error(a)}}),ee(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(ge("WC_METHOD_UNSUPPORTED",s))}),ee(this,"isValidPair",(s,n)=>{var i;if(!Xe(s)){let{message:a}=q("MISSING_OR_INVALID",`pair() params: ${s}`);throw n.setError(ir.malformed_pairing_uri),new Error(a)}if(!nw(s.uri)){let{message:a}=q("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw n.setError(ir.malformed_pairing_uri),new Error(a)}let o=Nh(s?.uri);if(!((i=o?.relay)!=null&&i.protocol)){let{message:a}=q("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(ir.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=q("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(ir.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,K.toMiliseconds)(o?.expiryTimestamp)<Date.now()){n.setError(ir.pairing_expired);let{message:a}=q("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ee(this,"isValidPing",async s=>{if(!Xe(s)){let{message:i}=q("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}let{topic:n}=s;await this.isValidPairingTopic(n)}),ee(this,"isValidDisconnect",async s=>{if(!Xe(s)){let{message:i}=q("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}let{topic:n}=s;await this.isValidPairingTopic(n)}),ee(this,"isValidPairingTopic",async s=>{if(!we(s,!1)){let{message:n}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(n)}if(!this.pairings.keys.includes(s)){let{message:n}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(n)}if(sr(this.pairings.get(s).expiry)){await this.deletePairing(s);let{message:n}=q("EXPIRED",`pairing topic: ${s}`);throw new Error(n)}}),this.core=e,this.logger=Pe(r,this.name),this.pairings=new ar(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ve(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(be.message,async e=>{let{topic:r,message:s,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==pe.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))try{let i=await this.core.crypto.decode(r,s);In(i)?(this.core.history.set(r,i),await this.onRelayEventRequest({topic:r,payload:i})):hs(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id)),await this.core.relayer.messages.ack(r,s)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(_t.expired,async e=>{let{topic:r}=za(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(fs.expire,{topic:r}))})}},a5=Object.defineProperty,c5=(t,e,r)=>e in t?a5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qe=(t,e,r)=>c5(t,typeof e!="symbol"?e+"":e,r),Ef=class extends Eo{constructor(e,r){super(e,r),this.core=e,this.logger=r,qe(this,"records",new Map),qe(this,"events",new Cr.EventEmitter),qe(this,"name",S4),qe(this,"version",_4),qe(this,"cached",[]),qe(this,"initialized",!1),qe(this,"storagePrefix",or),qe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),qe(this,"set",(s,n,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:n,chainId:i}),this.records.has(n.id))return;let o={id:n.id,topic:s,request:{method:n.method,params:n.params||null},chainId:i,expiry:Se(K.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Kt.created,o)}),qe(this,"resolve",async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;let n=await this.getRecord(s.id);typeof n.response>"u"&&(n.response=Qe(s)?{error:s.error}:{result:s.result},this.records.set(n.id,n),this.persist(),this.events.emit(Kt.updated,n))}),qe(this,"get",async(s,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:n}),await this.getRecord(n))),qe(this,"delete",(s,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(i=>{if(i.topic===s){if(typeof n<"u"&&i.id!==n)return;this.records.delete(i.id),this.events.emit(Kt.deleted,i)}}),this.persist()}),qe(this,"exists",async(s,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===s:!1)),qe(this,"on",(s,n)=>{this.events.on(s,n)}),qe(this,"once",(s,n)=>{this.events.once(s,n)}),qe(this,"off",(s,n)=>{this.events.off(s,n)}),qe(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),this.logger=Pe(r,this.name)}get context(){return Ve(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;let s={topic:r.topic,request:xt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let r=this.records.get(e);if(!r){let{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kt.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Kt.created,e=>{let r=Kt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Kt.updated,e=>{let r=Kt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Kt.deleted,e=>{let r=Kt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Nr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{(0,K.toMiliseconds)(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Kt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}},u5=Object.defineProperty,l5=(t,e,r)=>e in t?u5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tt=(t,e,r)=>l5(t,typeof e!="symbol"?e+"":e,r),xf=class extends Ao{constructor(e,r){super(e,r),this.core=e,this.logger=r,tt(this,"expirations",new Map),tt(this,"events",new Cr.EventEmitter),tt(this,"name",A4),tt(this,"version",D4),tt(this,"cached",[]),tt(this,"initialized",!1),tt(this,"storagePrefix",or),tt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),tt(this,"has",s=>{try{let n=this.formatTarget(s);return typeof this.getExpiration(n)<"u"}catch{return!1}}),tt(this,"set",(s,n)=>{this.isInitialized();let i=this.formatTarget(s),o={target:i,expiry:n};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(_t.created,{target:i,expiration:o})}),tt(this,"get",s=>{this.isInitialized();let n=this.formatTarget(s);return this.getExpiration(n)}),tt(this,"del",s=>{if(this.isInitialized(),this.has(s)){let n=this.formatTarget(s),i=this.getExpiration(n);this.expirations.delete(n),this.events.emit(_t.deleted,{target:n,expiration:i})}}),tt(this,"on",(s,n)=>{this.events.on(s,n)}),tt(this,"once",(s,n)=>{this.events.once(s,n)}),tt(this,"off",(s,n)=>{this.events.off(s,n)}),tt(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),this.logger=Pe(r,this.name)}get context(){return Ve(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Xm(e);if(typeof e=="number")return Qm(e);let{message:r}=q("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(_t.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let r=this.expirations.get(e);if(!r){let{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(s),new Error(s)}return r}checkExpiry(e,r){let{expiry:s}=r;(0,K.toMiliseconds)(s)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(_t.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Nr.pulse,()=>this.checkExpirations()),this.events.on(_t.created,e=>{let r=_t.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(_t.expired,e=>{let r=_t.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(_t.deleted,e=>{let r=_t.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}},h5=Object.defineProperty,f5=(t,e,r)=>e in t?h5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ae=(t,e,r)=>f5(t,typeof e!="symbol"?e+"":e,r),vf=class extends Do{constructor(e,r,s){super(e,r,s),this.core=e,this.logger=r,this.store=s,Ae(this,"name",T4),Ae(this,"abortController"),Ae(this,"isDevEnv"),Ae(this,"verifyUrlV3",O4),Ae(this,"storagePrefix",or),Ae(this,"version",gb),Ae(this,"publicKey"),Ae(this,"fetchPromise"),Ae(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,K.toMiliseconds)((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ae(this,"register",async n=>{if(!Ps()||this.isDevEnv)return;let i=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{let u=(0,db.getDocument)(),l=this.startAbortTimer(K.ONE_SECOND*5),h=await new Promise((f,p)=>{let d=()=>{window.removeEventListener("message",m),u.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);let g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});let m=S=>{if(S.data&&typeof S.data=="string")try{let A=JSON.parse(S.data);if(A.type==="verify_attestation"){if(Vn(A.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",m),f(A.attestation===null?"":A.attestation)}}catch(A){this.logger.warn(A)}};u.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),Ae(this,"resolve",async n=>{if(this.isDevEnv)return"";let{attestationId:i,hash:o,encryptedId:a}=n;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(Vn(i).payload.id!==a)return;let u=await this.isValidJwtAttestation(i);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;let c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),Ae(this,"fetchAttestation",async(n,i)=>{this.logger.debug(`resolving attestation: ${n} from url: ${i}`);let o=this.startAbortTimer(K.ONE_SECOND*5),a=await fetch(`${i}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ae(this,"getVerifyUrl",n=>{let i=n||An;return C4.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${An}`),i=An),i}),Ae(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let n=this.startAbortTimer(K.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await i.json()}catch(n){this.logger.warn(n)}}),Ae(this,"persistPublicKey",async n=>{this.logger.debug("persisting public key to local storage",n),await this.store.setItem(this.storeKey,n),this.publicKey=n}),Ae(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ae(this,"isValidJwtAttestation",async n=>{let i=await this.getPublicKey();try{if(i)return this.validateAttestation(n,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ae(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ae(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});let n=await this.fetchPromise;return this.fetchPromise=void 0,n}),Ae(this,"validateAttestation",(n,i)=>{let o=ew(n,i.publicKey),a={hasExpired:(0,K.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Pe(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ni(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Ve(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,K.toMiliseconds)(e))}},d5=Object.defineProperty,p5=(t,e,r)=>e in t?d5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ub=(t,e,r)=>p5(t,typeof e!="symbol"?e+"":e,r),If=class extends To{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,ub(this,"context",B4),ub(this,"registerDeviceToken",async s=>{let{clientId:n,token:i,notificationType:o,enableEncrypted:a=!1}=s,c=`${N4}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:i,always_raw:a})})}),this.logger=Pe(r,this.context)}},g5=Object.defineProperty,lb=Object.getOwnPropertySymbols,m5=Object.prototype.hasOwnProperty,y5=Object.prototype.propertyIsEnumerable,Sf=(t,e,r)=>e in t?g5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ki=(t,e)=>{for(var r in e||(e={}))m5.call(e,r)&&Sf(t,r,e[r]);if(lb)for(var r of lb(e))y5.call(e,r)&&Sf(t,r,e[r]);return t},Be=(t,e,r)=>Sf(t,typeof e!="symbol"?e+"":e,r),_f=class extends Ro{constructor(e,r,s=!0){super(e,r,s),this.core=e,this.logger=r,Be(this,"context",U4),Be(this,"storagePrefix",or),Be(this,"storageVersion",P4),Be(this,"events",new Map),Be(this,"shouldPersist",!1),Be(this,"init",async()=>{if(!Ni())try{let n={eventId:fh(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:lh(this.core.relayer.protocol,this.core.relayer.version,Zh)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Be(this,"createEvent",n=>{let{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=n,u=fh(),l=this.core.projectId||"",h=Date.now(),f=Ki({eventId:u,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),Be(this,"getEvent",n=>{let{eventId:i,topic:o}=n;if(i)return this.events.get(i);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ki(Ki({},a),this.setMethods(a.eventId))}),Be(this,"deleteEvent",n=>{let{eventId:i}=n;this.events.delete(i),this.shouldPersist=!0}),Be(this,"setEventListeners",()=>{this.core.heartbeat.on(Nr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{(0,K.fromMiliseconds)(Date.now())-(0,K.fromMiliseconds)(n.timestamp)>F4&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Be(this,"setMethods",n=>({addTrace:i=>this.addTrace(n,i),setError:i=>this.setError(n,i)})),Be(this,"addTrace",(n,i)=>{let o=this.events.get(n);o&&(o.props.properties.trace.push(i),this.events.set(n,o),this.shouldPersist=!0)}),Be(this,"setError",(n,i)=>{let o=this.events.get(n);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Be(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Be(this,"restore",async()=>{try{let n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(i=>{this.events.set(i.eventId,Ki(Ki({},i),this.setMethods(i.eventId)))})}catch(n){this.logger.warn(n)}}),Be(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let n=[];for(let[i,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(let i of n)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Be(this,"sendEvent",async n=>{let i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${L4}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Zh}${i}`,{method:"POST",body:JSON.stringify(n)})}),Be(this,"getAppDomain",()=>uh().url),this.logger=Pe(r,this.context),this.telemetryEnabled=s,s?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},w5=Object.defineProperty,hb=Object.getOwnPropertySymbols,b5=Object.prototype.hasOwnProperty,E5=Object.prototype.propertyIsEnumerable,Af=(t,e,r)=>e in t?w5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fb=(t,e)=>{for(var r in e||(e={}))b5.call(e,r)&&Af(t,r,e[r]);if(hb)for(var r of hb(e))E5.call(e,r)&&Af(t,r,e[r]);return t},de=(t,e,r)=>Af(t,typeof e!="symbol"?e+"":e,r),Df=class t extends bo{constructor(e){var r;super(e),de(this,"protocol",pb),de(this,"version",gb),de(this,"name",lc),de(this,"relayUrl"),de(this,"projectId"),de(this,"customStoragePrefix"),de(this,"events",new Cr.EventEmitter),de(this,"logger"),de(this,"heartbeat"),de(this,"relayer"),de(this,"crypto"),de(this,"storage"),de(this,"history"),de(this,"expirer"),de(this,"pairing"),de(this,"verify"),de(this,"echoClient"),de(this,"linkModeSupportedApps"),de(this,"eventClient"),de(this,"initialized",!1),de(this,"logChunkController"),de(this,"on",(a,c)=>this.events.on(a,c)),de(this,"once",(a,c)=>this.events.once(a,c)),de(this,"off",(a,c)=>this.events.off(a,c)),de(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),de(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;let l={topic:a,message:c,publishedAt:Date.now(),transportType:pe.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});let s=this.getGlobalCore(e?.customStoragePrefix);if(s)try{return this.customStoragePrefix=s.customStoragePrefix,this.logger=s.logger,this.heartbeat=s.heartbeat,this.crypto=s.crypto,this.history=s.history,this.expirer=s.expirer,this.storage=s.storage,this.relayer=s.relayer,this.pairing=s.pairing,this.verify=s.verify,this.echoClient=s.echoClient,this.linkModeSupportedApps=s.linkModeSupportedApps,this.eventClient=s.eventClient,this.initialized=s.initialized,this.logChunkController=s.logChunkController,s}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||mb,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let n=qn({level:typeof e?.logger=="string"&&e.logger?e.logger:n4.logger,name:lc}),{logger:i,chunkLoggerController:o}=qd({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Pe(i,this.name),this.heartbeat=new co,this.crypto=new cf(this,this.logger,e?.keychain),this.history=new Ef(this,this.logger),this.expirer=new xf(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ho(fb(fb({},i4),e?.storageOptions)),this.relayer=new yf({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new bf(this,this.logger),this.verify=new vf(this,this.logger,this.storage),this.echoClient=new If(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new _f(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let r=new t(e);await r.initialize();let s=await r.crypto.getClientId();return await r.storage.setItem(b4,s),r}get context(){return Ve(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem($w,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem($w)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${e}`,s=`${r}_count`;return globalThis[s]=(globalThis[s]||0)+1,globalThis[s]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[s]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;let s=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[s]=e}catch(s){console.warn("Failed to set global WalletConnect core",s)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},Rb=Df;var dc=De(ps()),X=De(Ks());var Nb="wc",Pb=2,Ub="client",zf=`${Nb}@${Pb}:${Ub}:`,Rf={name:Ub,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"};var Ob="WALLETCONNECT_DEEPLINK_CHOICE";var x5="proposal";var Cb="Proposal expired",v5="session",Rn=X.SEVEN_DAYS,I5="engine",je={wc_sessionPropose:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1104},res:{ttl:X.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1106},res:{ttl:X.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1112},res:{ttl:X.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1114},res:{ttl:X.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:X.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:X.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1119}}},Of={min:X.FIVE_MINUTES,max:X.SEVEN_DAYS},cr={idle:"IDLE",active:"ACTIVE"},S5={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},_5="request",A5=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],D5="wc";var T5="auth",R5="authKeys",O5="pairingTopics",C5="requests",pc=`${D5}@${1.5}:${T5}:`,fc=`${pc}:PUB_KEY`,B5=Object.defineProperty,N5=Object.defineProperties,P5=Object.getOwnPropertyDescriptors,Bb=Object.getOwnPropertySymbols,U5=Object.prototype.hasOwnProperty,F5=Object.prototype.propertyIsEnumerable,Bf=(t,e,r)=>e in t?B5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e)=>{for(var r in e||(e={}))U5.call(e,r)&&Bf(t,r,e[r]);if(Bb)for(var r of Bb(e))F5.call(e,r)&&Bf(t,r,e[r]);return t},rt=(t,e)=>N5(t,P5(e)),k=(t,e,r)=>Bf(t,typeof e!="symbol"?e+"":e,r),Nf=class extends Co{constructor(e){super(e),k(this,"name",I5),k(this,"events",new dc.default),k(this,"initialized",!1),k(this,"requestQueue",{state:cr.idle,queue:[]}),k(this,"sessionRequestQueue",{state:cr.idle,queue:[]}),k(this,"emittedSessionRequests",new Na({limit:500})),k(this,"requestQueueDelay",X.ONE_SECOND),k(this,"expectedPairingMethodMap",new Map),k(this,"recentlyDeletedMap",new Map),k(this,"recentlyDeletedLimit",200),k(this,"relayMessageCache",[]),k(this,"pendingSessions",new Map),k(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(je)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,X.toMiliseconds)(this.requestQueueDelay)))}),k(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let s=rt(oe({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s),s.optionalNamespaces=rw(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};let{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=s,l=n,h,f=!1;try{if(l){let O=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=O.active}}catch(O){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),O}if(!l||!f){let{topic:O,uri:P}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=O,h=P}if(!l){let{message:O}=q("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(O)}let p=await this.client.core.crypto.generateKeyPair(),d=je.wc_sessionPropose.req.ttl||X.FIVE_MINUTES,g=Se(d),m=rt(oe(oe({requiredNamespaces:i,optionalNamespaces:o,relays:u??[{protocol:Tf}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Bt()}),S=ne("session_connect",m.id),{reject:A,resolve:b,done:E}=Rr(d,Cb),v=({id:O})=>{O===m.id&&(this.client.events.off("proposal_expire",v),this.pendingSessions.delete(m.id),this.events.emit(S,{error:{message:Cb,code:0}}))};return this.client.events.on("proposal_expire",v),this.events.once(S,({error:O,session:P})=>{this.client.events.off("proposal_expire",v),O?A(O):P&&b(P)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:E}}),k(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(s){throw this.client.logger.error("pair() failed"),s}}),k(this,"approve",async r=>{var s,n,i;let o=this.client.core.eventClient.createEvent({properties:{topic:(s=r?.id)==null?void 0:s.toString(),trace:[Br.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(w){throw o.setError(Dn.no_internet_connection),w}try{await this.isValidProposalId(r?.id)}catch(w){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Dn.proposal_not_found),w}try{await this.isValidApprove(r)}catch(w){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Dn.session_approve_namespace_validation_failure),w}let{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:d,proposer:g,requiredNamespaces:m,optionalNamespaces:S}=p,A=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:d});A||(A=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:Br.session_approve_started,properties:{topic:d,trace:[Br.session_approve_started,Br.session_namespaces_validation_success]}}));let b=await this.client.core.crypto.generateKeyPair(),E=g.publicKey,v=await this.client.core.crypto.generateSharedKey(b,E),O=oe(oe(oe({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:b,metadata:this.client.metadata},expiry:Se(Rn)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),P=pe.relay;A.addTrace(Br.subscribing_session_topic);try{await this.client.core.relayer.subscribe(v,{transportType:P,internal:{skipSubscribe:!0}})}catch(w){throw A.setError(Dn.subscribe_session_topic_failure),w}A.addTrace(Br.subscribe_session_topic_success);let N=rt(oe({},O),{topic:v,requiredNamespaces:m,optionalNamespaces:S,pairingTopic:d,acknowledged:!1,self:O.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:pe.relay});await this.client.session.set(v,N),A.addTrace(Br.store_session);try{await this.sendApproveSession({sessionTopic:v,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:O,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),A.addTrace(Br.session_approve_publish_success)}catch(w){throw this.client.logger.error(w),this.client.session.delete(v,ge("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(v),w}return this.client.core.eventClient.deleteEvent({eventId:A.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(v,Se(Rn)),{topic:v,acknowledged:()=>Promise.resolve(this.client.session.get(v))}}),k(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:s,reason:n}=r,i;try{i=this.client.proposal.get(s).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${s}) failed`),o}i&&await this.sendError({id:s,topic:i,error:n,rpcOpts:je.wc_sessionPropose.reject}),await this.deleteProposal(s)}),k(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}let{topic:s,namespaces:n}=r,{done:i,resolve:o,reject:a}=Rr(),c=Bt(),u=Nt().toString(),l=this.client.session.get(s).namespaces;return this.events.once(ne("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(s,{namespaces:n}),await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(s,{namespaces:l}),a(h)}),{acknowledged:i}}),k(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:s}=r,n=Bt(),{done:i,resolve:o,reject:a}=Rr();return this.events.once(ne("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(s,Se(Rn)),this.sendRequest({topic:s,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),k(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}let{chainId:s,request:n,topic:i,expiry:o=je.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(i);a?.transportType===pe.relay&&await this.confirmOnlineStateOrThrow();let c=Bt(),u=Nt().toString(),{done:l,resolve:h,reject:f}=Rr(o,"Request expired. Please try again.");this.events.once(ne("session_request",c),({error:m,result:S})=>{m?f(m):h(S)});let p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:i,method:p,params:{request:rt(oe({},n),{expiryTimestamp:Se(o)}),chainId:s},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:s,id:c}),await l();let g={request:rt(oe({},n),{expiryTimestamp:Se(o)}),chainId:s};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:i,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(S=>f(S)),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:s,id:c}),m()}),new Promise(async m=>{var S;if(!((S=a.sessionConfig)!=null&&S.disableDeepLink)){let A=await ty(this.client.core.storage,Ob);await ey({id:c,topic:i,wcDeepLink:A})}m()}),l()]).then(m=>m[2])}),k(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);let{topic:s,response:n}=r,{id:i}=n,o=this.client.session.get(s);o.transportType===pe.relay&&await this.confirmOnlineStateOrThrow();let a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);vt(n)?await this.sendResult({id:i,topic:s,result:n.result,throwOnFailedPublish:!0,appLink:a}):Qe(n)&&await this.sendError({id:i,topic:s,error:n.error,appLink:a}),this.cleanupAfterResponse(r)}),k(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}let{topic:s}=r;if(this.client.session.keys.includes(s)){let n=Bt(),i=Nt().toString(),{done:o,resolve:a,reject:c}=Rr();this.events.once(ne("session_ping",n),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:s,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(s)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:s}))}),k(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);let{topic:s,event:n,chainId:i}=r,o=Nt().toString(),a=Bt();await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:n,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),k(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);let{topic:s}=r;if(this.client.session.keys.includes(s))await this.sendRequest({topic:s,method:"wc_sessionDelete",params:ge("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:s,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(s))await this.client.core.pairing.disconnect({topic:s});else{let{message:n}=q("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(n)}}),k(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(s=>sw(s,r)))),k(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),k(this,"authenticate",async(r,s)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);let i=s&&this.client.core.linkModeSupportedApps.includes(s)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=i?pe.link_mode:pe.relay;o===pe.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:f,exp:p,nbf:d,methods:g=[],expiry:m}=r,S=[...r.resources||[]],{topic:A,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:A,uri:b}});let E=await this.client.core.crypto.generateKeyPair(),v=bn(E);if(await Promise.all([this.client.auth.authKeys.set(fc,{responseTopic:v,publicKey:E}),this.client.auth.pairingTopics.set(v,{topic:v,pairingTopic:A})]),await this.client.core.relayer.subscribe(v,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${A}`),g.length>0){let{namespace:D}=Oi(a[0]),U=by(D,"request",g);Fi(S)&&(U=Ey(U,S.pop())),S.push(U)}let O=m&&m>je.wc_sessionAuthenticate.req.ttl?m:je.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:f??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:S},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:Se(O)},N={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},w={requiredNamespaces:{},optionalNamespaces:N,relays:[{protocol:"irn"}],pairingTopic:A,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:Se(je.wc_sessionPropose.req.ttl),id:Bt()},{done:C,resolve:_,reject:T}=Rr(O,"Request expired"),B=Bt(),L=ne("session_connect",w.id),x=ne("session_request",B),y=async({error:D,session:U})=>{this.events.off(x,I),D?T(D):U&&_({session:U})},I=async D=>{var U,F,M;if(await this.deletePendingAuthRequest(B,{message:"fulfilled",code:0}),D.error){let W=ge("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return D.error.code===W.code?void 0:(this.events.off(L,y),T(D.error.message))}await this.deleteProposal(w.id),this.events.off(L,y);let{cacaos:j,responder:$}=D.result,H=[],G=[];for(let W of j){await vh({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),T(ge("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:ae}=W,Ee=Fi(ae.resources),wt=[Va(ae.iss)],At=Ui(ae.iss);if(Ee){let Dt=Sh(Ee),Wt=_h(Ee);H.push(...Dt),wt.push(...Wt)}for(let Dt of wt)G.push(`${Dt}:${At}`)}let Z=await this.client.core.crypto.generateSharedKey(E,$.publicKey),Q;H.length>0&&(Q={topic:Z,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:$,controller:$.publicKey,expiry:Se(Rn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:A,namespaces:Uh([...new Set(H)],[...new Set(G)]),transportType:o},await this.client.core.relayer.subscribe(Z,{transportType:o}),await this.client.session.set(Z,Q),A&&await this.client.core.pairing.updateMetadata({topic:A,metadata:$.metadata}),Q=this.client.session.get(Z)),(U=this.client.metadata.redirect)!=null&&U.linkMode&&(F=$.metadata.redirect)!=null&&F.linkMode&&(M=$.metadata.redirect)!=null&&M.universal&&s&&(this.client.core.addLinkModeSupportedApp($.metadata.redirect.universal),this.client.session.update(Z,{transportType:pe.link_mode})),_({auths:j,session:Q})};this.events.once(L,y),this.events.once(x,I);let R;try{if(i){let D=xt("wc_sessionAuthenticate",P,B);this.client.core.history.set(A,D);let U=await this.client.core.crypto.encode("",D,{type:wn,encoding:Or});R=Mi(s,A,U)}else await Promise.all([this.sendRequest({topic:A,method:"wc_sessionAuthenticate",params:P,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:B}),this.sendRequest({topic:A,method:"wc_sessionPropose",params:w,expiry:je.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:w.id})])}catch(D){throw this.events.off(L,y),this.events.off(x,I),D}return await this.setProposal(w.id,w),await this.setAuthRequest(B,{request:rt(oe({},P),{verifyContext:{}}),pairingTopic:A,transportType:o}),{uri:R??b,response:C}}),k(this,"approveSessionAuthenticate",async r=>{let{id:s,auths:n}=r,i=this.client.core.eventClient.createEvent({properties:{topic:s.toString(),trace:[ds.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw i.setError(Tn.no_internet_connection),m}let o=this.getPendingAuthRequest(s);if(!o)throw i.setError(Tn.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${s}`);let a=o.transportType||pe.relay;a===pe.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=bn(c),h={type:Ht,receiverPublicKey:c,senderPublicKey:u},f=[],p=[];for(let m of n){if(!await vh({cacao:m,projectId:this.client.core.projectId})){i.setError(Tn.invalid_cacao);let v=ge("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:s,topic:l,error:v,encodeOpts:h}),new Error(v.message)}i.addTrace(ds.cacaos_verified);let{p:S}=m,A=Fi(S.resources),b=[Va(S.iss)],E=Ui(S.iss);if(A){let v=Sh(A),O=_h(A);f.push(...v),b.push(...O)}for(let v of b)p.push(`${v}:${E}`)}let d=await this.client.core.crypto.generateSharedKey(u,c);i.addTrace(ds.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Se(Rn),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Uh([...new Set(f)],[...new Set(p)]),transportType:a},i.addTrace(ds.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(m){throw i.setError(Tn.subscribe_authenticated_session_topic_failure),m}i.addTrace(ds.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),i.addTrace(ds.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(ds.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:s,result:{cacaos:n,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw i.setError(Tn.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(s,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:g}}),k(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();let{id:s,reason:n}=r,i=this.getPendingAuthRequest(s);if(!i)throw new Error(`Could not find pending auth request with id ${s}`);i.transportType===pe.relay&&await this.confirmOnlineStateOrThrow();let o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=bn(o),u={type:Ht,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:s,topic:c,error:n,encodeOpts:u,rpcOpts:je.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(s,{message:"rejected",code:0}),await this.deleteProposal(s)}),k(this,"formatAuthMessage",r=>{this.isInitialized();let{request:s,iss:n}=r;return Ih(s,n)}),k(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),k(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{let s=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&i.topic&&i.topic!==s.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}}),k(this,"deleteSession",async r=>{var s;let{topic:n,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,ge("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),i||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Ob).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===n&&this.deletePendingSessionRequest(u.id,ge("USER_DISCONNECTED"))}),n===((s=this.sessionRequestQueue.queue[0])==null?void 0:s.topic)&&(this.sessionRequestQueue.state=cr.idle),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),k(this,"deleteProposal",async(r,s)=>{if(s)try{let n=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(Dn.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ge("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),k(this,"deletePendingSessionRequest",async(r,s,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==r),n&&(this.sessionRequestQueue.state=cr.idle,this.client.events.emit("session_request_expire",{id:r}))}),k(this,"deletePendingAuthRequest",async(r,s,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,s),n?Promise.resolve():this.client.core.expirer.del(r)])}),k(this,"setExpiry",async(r,s)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,s),await this.client.session.update(r,{expiry:s}))}),k(this,"setProposal",async(r,s)=>{this.client.core.expirer.set(r,Se(je.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,s)}),k(this,"setAuthRequest",async(r,s)=>{let{request:n,pairingTopic:i,transportType:o=pe.relay}=s;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:i,verifyContext:n.verifyContext,transportType:o})}),k(this,"setPendingSessionRequest",async r=>{let{id:s,topic:n,params:i,verifyContext:o}=r,a=i.request.expiryTimestamp||Se(je.wc_sessionRequest.req.ttl);this.client.core.expirer.set(s,a),await this.client.pendingRequest.set(s,{id:s,topic:n,params:i,verifyContext:o})}),k(this,"sendRequest",async r=>{let{topic:s,method:n,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:f={}}=r,p=xt(n,i,c),d,g=!!l;try{let A=g?Or:Ze;d=await this.client.core.crypto.encode(s,p,{encoding:A})}catch(A){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),A}let m;if(A5.includes(n)){let A=mt(JSON.stringify(p)),b=mt(d);m=await this.client.core.verify.register({id:b,decryptedId:A})}let S=oe(oe({},je[n].req),f);if(S.attestation=m,o&&(S.ttl=o),a&&(S.id=a),this.client.core.history.set(s,p),g){let A=Mi(l,s,d);await global.Linking.openURL(A,this.client.name)}else S.tvf=rt(oe({},h),{correlationId:p.id}),u?(S.internal=rt(oe({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,d,S)):this.client.core.relayer.publish(s,d,S).catch(A=>this.client.logger.error(A));return p.id}),k(this,"sendProposeSession",async r=>{let{proposal:s,publishOpts:n}=r,i=xt("wc_sessionPropose",s,s.id);this.client.core.history.set(s.pairingTopic,i);let o=await this.client.core.crypto.encode(s.pairingTopic,i,{encoding:Ze}),a=mt(JSON.stringify(i)),c=mt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:s.pairingTopic,sessionProposal:o},opts:rt(oe({},n),{publishMethod:"wc_proposeSession",attestation:u})})}),k(this,"sendApproveSession",async r=>{let{sessionTopic:s,pairingProposalResponse:n,proposal:i,sessionSettleRequest:o,publishOpts:a}=r,c=Ls(i.id,n),u=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Ze}),l=xt("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(s,l,{encoding:Ze});this.client.core.history.set(s,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:s,pairingTopic:i.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:rt(oe({},a),{publishMethod:"wc_approveSession"})})}),k(this,"sendResult",async r=>{let{id:s,topic:n,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=Ls(s,i),l,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let d=h?Or:Ze;l=await this.client.core.crypto.encode(n,u,rt(oe({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),d}let f,p;try{f=await this.client.core.history.get(n,s);let d=f.request;try{p=this.getTVFParams(s,d.params,i)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${s}) failed`),d}if(h){let d=Mi(c,n,l);await global.Linking.openURL(d,this.client.name)}else{let d=f.request.method,g=je[d].res;g.tvf=rt(oe({},p),{correlationId:s}),o?(g.internal=rt(oe({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,l,g)):this.client.core.relayer.publish(n,l,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(u)}),k(this,"sendError",async r=>{let{id:s,topic:n,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=ks(s,i),l,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let p=h?Or:Ze;l=await this.client.core.crypto.encode(n,u,rt(oe({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let f;try{f=await this.client.core.history.get(n,s)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${s}) failed`),p}if(h){let p=Mi(c,n,l);await global.Linking.openURL(p,this.client.name)}else{let p=f.request.method,d=a||je[p].res;this.client.core.relayer.publish(n,l,d)}await this.client.core.history.resolve(u)}),k(this,"cleanup",async()=>{let r=[],s=[];this.client.session.getAll().forEach(n=>{let i=!1;sr(n.expiry)&&(i=!0),this.client.core.crypto.keychain.has(n.topic)||(i=!0),i&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{sr(n.expiryTimestamp)&&s.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...s.map(n=>this.deleteProposal(n))])}),k(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),k(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),k(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===cr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=cr.active;let r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=cr.idle}),k(this,"processRequest",async r=>{let{topic:s,payload:n,attestation:i,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:s,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:s,payload:n,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(s,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(s,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(s,n);case"wc_sessionPing":return await this.onSessionPingRequest(s,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(s,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:s,payload:n,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(s,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:s,payload:n,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),k(this,"onRelayEventResponse",async r=>{let{topic:s,payload:n,transportType:i}=r,o=(await this.client.core.history.get(s,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(s,n,i);case"wc_sessionSettle":return this.onSessionSettleResponse(s,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,n);case"wc_sessionExtend":return this.onSessionExtendResponse(s,n);case"wc_sessionPing":return this.onSessionPingResponse(s,n);case"wc_sessionRequest":return this.onSessionRequestResponse(s,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(s,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),k(this,"onRelayEventUnknownPayload",r=>{let{topic:s}=r,{message:n}=q("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),k(this,"shouldIgnorePairingRequest",r=>{let{topic:s,requestMethod:n}=r,i=this.expectedPairingMethodMap.get(s);return!i||i.includes(n)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),k(this,"onSessionProposeRequest",async r=>{let{topic:s,payload:n,attestation:i,encryptedId:o}=r,{params:a,id:c}=n;try{let u=this.client.core.eventClient.getEvent({topic:s});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(ir.proposal_listener_not_found)),this.isValidConnect(oe({},n.params));let l=a.expiryTimestamp||Se(je.wc_sessionPropose.req.ttl),h=oe({id:c,pairingTopic:s,expiryTimestamp:l,attestation:i,encryptedId:o},a);await this.setProposal(c,h);let f=await this.getVerifyContext({attestationId:i,hash:mt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(Gt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(u){await this.sendError({id:c,topic:s,error:u,rpcOpts:je.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),k(this,"onSessionProposeResponse",async(r,s,n)=>{let{id:i}=s;if(vt(s)){let{result:o}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});let l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(i,{sessionTopic:l,pairingTopic:r,proposalId:i,publicKey:c});let h=await this.client.core.relayer.subscribe(l,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(Qe(s)){await this.deleteProposal(i);let o=ne("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:s.error})}}),k(this,"onSessionSettleRequest",async(r,s)=>{let{id:n,params:i}=s;try{this.isValidSessionSettleRequest(i);let{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f}=s.params,p=[...this.pendingSessions.values()].find(m=>m.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);let d=this.client.proposal.get(p.proposalId),g=rt(oe(oe(oe({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:pe.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(ne("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:s.id,topic:r,result:!0})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),k(this,"onSessionSettleResponse",async(r,s)=>{let{id:n}=s;vt(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ne("session_approve",n),{})):Qe(s)&&(await this.client.session.delete(r,ge("USER_DISCONNECTED")),this.events.emit(ne("session_approve",n),{error:s.error}))}),k(this,"onSessionUpdateRequest",async(r,s)=>{let{params:n,id:i}=s;try{let o=`${r}_session_update`,a=as.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:r,error:ge("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(oe({topic:r},n));try{as.set(o,i),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:i,topic:r,result:!0})}catch(c){throw as.delete(o),c}this.client.events.emit("session_update",{id:i,topic:r,params:n})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),k(this,"isRequestOutOfSync",(r,s)=>s.toString().slice(0,-3)<r.toString().slice(0,-3)),k(this,"onSessionUpdateResponse",(r,s)=>{let{id:n}=s,i=ne("session_update",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);vt(s)?this.events.emit(ne("session_update",n),{}):Qe(s)&&this.events.emit(ne("session_update",n),{error:s.error})}),k(this,"onSessionExtendRequest",async(r,s)=>{let{id:n}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Se(Rn)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(i){await this.sendError({id:n,topic:r,error:i}),this.client.logger.error(i)}}),k(this,"onSessionExtendResponse",(r,s)=>{let{id:n}=s,i=ne("session_extend",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);vt(s)?this.events.emit(ne("session_extend",n),{}):Qe(s)&&this.events.emit(ne("session_extend",n),{error:s.error})}),k(this,"onSessionPingRequest",async(r,s)=>{let{id:n}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(i){await this.sendError({id:n,topic:r,error:i}),this.client.logger.error(i)}}),k(this,"onSessionPingResponse",(r,s)=>{let{id:n}=s,i=ne("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);vt(s)?this.events.emit(ne("session_ping",n),{}):Qe(s)&&this.events.emit(ne("session_ping",n),{error:s.error})},500)}),k(this,"onSessionDeleteRequest",async(r,s)=>{let{id:n}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(be.publish,async()=>{i(await this.deleteSession({topic:r,id:n}))})}),this.sendResult({id:n,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ge("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),k(this,"onSessionRequest",async r=>{var s,n,i;let{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:h,params:f}=a;try{await this.isValidRequest(oe({topic:o},f));let p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:mt(JSON.stringify(xt("wc_sessionRequest",f,h))),encryptedId:u,metadata:p.peer.metadata,transportType:l}),g={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),l===pe.link_mode&&(s=p.peer.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),k(this,"onSessionRequestResponse",(r,s)=>{let{id:n}=s,i=ne("session_request",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);vt(s)?this.events.emit(ne("session_request",n),{result:s.result}):Qe(s)&&this.events.emit(ne("session_request",n),{error:s.error})}),k(this,"onSessionEventRequest",async(r,s)=>{let{id:n,params:i}=s;try{let o=`${r}_session_event_${i.event.name}`,a=as.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(oe({topic:r},i)),this.client.events.emit("session_event",{id:n,topic:r,params:i}),as.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),k(this,"onSessionAuthenticateResponse",(r,s)=>{let{id:n}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:s}),vt(s)?this.events.emit(ne("session_request",n),{result:s.result}):Qe(s)&&this.events.emit(ne("session_request",n),{error:s.error})}),k(this,"onSessionAuthenticateRequest",async r=>{var s;let{topic:n,payload:i,attestation:o,encryptedId:a,transportType:c}=r;try{let{requester:u,authPayload:l,expiryTimestamp:h}=i.params,f=await this.getVerifyContext({attestationId:o,hash:mt(JSON.stringify(i)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:n,id:i.id,authPayload:l,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:p,pairingTopic:n,transportType:c}),c===pe.link_mode&&(s=u.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:i.params,id:i.id,verifyContext:f})}catch(u){this.client.logger.error(u);let l=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(i.params.requester.metadata,c),p={type:Ht,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:i.id,topic:n,error:u,encodeOpts:p,rpcOpts:je.wc_sessionAuthenticate.autoReject,appLink:f})}}),k(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),k(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=cr.idle,this.processSessionRequestQueue()},(0,X.toMiliseconds)(this.requestQueueDelay))}),k(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:s})=>{let n=this.client.core.history.pending;n.length>0&&n.filter(i=>i.topic===r&&i.request.method==="wc_sessionRequest").forEach(i=>{let o=i.request.id,a=ne("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ne("session_request",i.request.id),{error:s})})}),k(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===cr.active){this.client.logger.info("session request queue is already active.");return}let r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(s){this.client.logger.error(s)}}),k(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=cr.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),k(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;let s=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);s&&this.onSessionProposeRequest({topic:r.topic,payload:xt("wc_sessionPropose",rt(oe({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id),attestation:s.attestation,encryptedId:s.encryptedId})}),k(this,"isValidConnect",async r=>{if(!Xe(r)){let{message:u}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}let{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ie(s)||await this.isValidPairingTopic(s),!lw(c,!0)){let{message:u}=q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!Ie(n)&&vn(n)!==0){let u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(n,"requiredNamespaces")}if(!Ie(i)&&vn(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),Ie(o)||this.validateSessionProps(o,"sessionProperties"),!Ie(a)){this.validateSessionProps(a,"scopedProperties");let u=Object.keys(n||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),k(this,"validateNamespaces",(r,s)=>{let n=uw(r,"connect()",s);if(n)throw new Error(n.message)}),k(this,"isValidApprove",async r=>{if(!Xe(r))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${r}`).message);let{id:s,namespaces:n,relayProtocol:i,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(s),await this.isValidProposalId(s);let c=this.client.proposal.get(s),u=Ja(n,"approve()");if(u)throw new Error(u.message);let l=Mh(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!we(i,!0)){let{message:h}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(Ie(o)||this.validateSessionProps(o,"sessionProperties"),!Ie(a)){this.validateSessionProps(a,"scopedProperties");let h=new Set(Object.keys(n));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),k(this,"isValidReject",async r=>{if(!Xe(r)){let{message:i}=q("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(i)}let{id:s,reason:n}=r;if(this.checkRecentlyDeleted(s),await this.isValidProposalId(s),!fw(n)){let{message:i}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(i)}}),k(this,"isValidSessionSettleRequest",r=>{if(!Xe(r)){let{message:u}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}let{relay:s,controller:n,namespaces:i,expiry:o}=r;if(!Lh(s)){let{message:u}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}let a=aw(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=Ja(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(sr(o)){let{message:u}=q("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),k(this,"isValidUpdate",async r=>{if(!Xe(r)){let{message:c}=q("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}let{topic:s,namespaces:n}=r;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);let i=this.client.session.get(s),o=Ja(n,"update()");if(o)throw new Error(o.message);let a=Mh(i.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),k(this,"isValidExtend",async r=>{if(!Xe(r)){let{message:n}=q("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}let{topic:s}=r;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s)}),k(this,"isValidRequest",async r=>{if(!Xe(r)){let{message:c}=q("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}let{topic:s,request:n,chainId:i,expiry:o}=r;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);let{namespaces:a}=this.client.session.get(s);if(!kh(a,i)){let{message:c}=q("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!dw(n)){let{message:c}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!mw(a,i,n.method)){let{message:c}=q("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(o&&!ww(o,Of)){let{message:c}=q("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Of.min} and ${Of.max}`);throw new Error(c)}}),k(this,"isValidRespond",async r=>{var s;if(!Xe(r)){let{message:o}=q("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}let{topic:n,response:i}=r;try{await this.isValidSessionTopic(n)}catch(o){throw(s=r?.response)!=null&&s.id&&this.cleanupAfterResponse(r),o}if(!pw(i)){let{message:o}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(o)}}),k(this,"isValidPing",async r=>{if(!Xe(r)){let{message:n}=q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}let{topic:s}=r;await this.isValidSessionOrPairingTopic(s)}),k(this,"isValidEmit",async r=>{if(!Xe(r)){let{message:a}=q("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}let{topic:s,event:n,chainId:i}=r;await this.isValidSessionTopic(s);let{namespaces:o}=this.client.session.get(s);if(!kh(o,i)){let{message:a}=q("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!gw(n)){let{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!yw(o,i,n.name)){let{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),k(this,"isValidDisconnect",async r=>{if(!Xe(r)){let{message:n}=q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}let{topic:s}=r;await this.isValidSessionOrPairingTopic(s)}),k(this,"isValidAuthenticate",r=>{let{chains:s,uri:n,domain:i,nonce:o}=r;if(!Array.isArray(s)||s.length===0)throw new Error("chains is required and must be a non-empty array");if(!we(n,!1))throw new Error("uri is required parameter");if(!we(i,!1))throw new Error("domain is required parameter");if(!we(o,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(c=>Oi(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=Oi(s[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),k(this,"getVerifyContext",async r=>{let{attestationId:s,hash:n,encryptedId:i,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||An,validation:"UNKNOWN",origin:o.url||""}};try{if(a===pe.link_mode){let l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}let u=await this.client.core.verify.resolve({attestationId:s,hash:n,encryptedId:i,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),k(this,"validateSessionProps",(r,s)=>{Object.values(r).forEach((n,i)=>{if(n==null){let{message:o}=q("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[i]}`);throw new Error(o)}})}),k(this,"getPendingAuthRequest",r=>{let s=this.client.auth.requests.get(r);return typeof s=="object"?s:void 0}),k(this,"addToRecentlyDeleted",(r,s)=>{if(this.recentlyDeletedMap.set(r,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0,i=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(n++>=i)break;this.recentlyDeletedMap.delete(o)}}}),k(this,"checkRecentlyDeleted",r=>{let s=this.recentlyDeletedMap.get(r);if(s){let{message:n}=q("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${r}`);throw new Error(n)}}),k(this,"isLinkModeEnabled",(r,s)=>{var n,i,o,a,c,u,l,h,f;return!r||s!==pe.link_mode?!1:((i=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r?.redirect)==null?void 0:l.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),k(this,"getAppLinkIfEnabled",(r,s)=>{var n;return this.isLinkModeEnabled(r,s)?(n=r?.redirect)==null?void 0:n.universal:void 0}),k(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;let s=hh(r,"topic")||"",n=decodeURIComponent(hh(r,"wc_ev")||""),i=this.client.session.keys.includes(s);i&&this.client.session.update(s,{transportType:pe.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:n,sessionExists:i})}),k(this,"registerLinkModeListeners",async()=>{var r;if(Ni()||Tr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){let s=global==null?void 0:global.Linking;if(typeof s<"u"){s.addEventListener("url",this.handleLinkModeMessage,this.client.name);let n=await s.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),k(this,"getTVFParams",(r,s,n)=>{var i,o,a;if(!((i=s.request)!=null&&i.method))return{};let c={correlationId:r,rpcMethods:[s.request.method],chainId:s.chainId};try{let u=this.extractTxHashesFromResult(s.request,n);c.txHashes=u,c.contractAddresses=this.isValidContractData(s.request.params)?[(a=(o=s.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn("Error getting TVF params",u)}return c}),k(this,"isValidContractData",r=>{var s;if(!r)return!1;try{let n=r?.data||((s=r?.[0])==null?void 0:s.data);if(!n.startsWith("0x"))return!1;let i=n.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),k(this,"extractTxHashesFromResult",(r,s)=>{var n;try{if(!s)return[];let i=r.method,o=S5[i];if(i==="sui_signTransaction")return[my(s.transactionBytes)];if(i==="near_signTransaction")return[bh(s)];if(i==="near_signTransactions")return s.map(c=>bh(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(n=s.tx_json)==null?void 0:n.hash];if(i==="polkadot_signTransaction")return[xw({transaction:r.params.transactionPayload,signature:s.signature})];if(i==="algo_signTxn")return Fs(s)?s.map(c=>Eh(c)):[Eh(s)];if(i==="cosmos_signDirect")return[yy(s)];if(typeof s=="string")return[s];let a=s[o.key];if(Fs(a))return i==="solana_signAllTransactions"?a.map(c=>gy(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(let[s,n]of Object.entries(r))for(let i of n)try{await this.onProviderMessageEvent({topic:s,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${i}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){let{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(be.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:r,message:s,attestation:n,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(fc)?this.client.auth.authKeys.get(fc):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(r,s,{receiverPublicKey:o,encoding:i===pe.link_mode?Or:Ze});In(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:i,encryptedId:mt(s)})):hs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:i}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:i}),await this.client.core.relayer.messages.ack(r,s)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(_t.expired,async e=>{let{topic:r,id:s}=za(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,q("EXPIRED"),!0);if(s&&this.client.auth.requests.keys.includes(s))return await this.deletePendingAuthRequest(s,q("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(fs.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(fs.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!we(e,!1)){let{message:r}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:r}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(sr(this.client.core.pairing.pairings.get(e).expiry)){let{message:r}=q("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!we(e,!1)){let{message:r}=q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:r}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(sr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:r}=q("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){let{message:r}=q("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(we(e,!1)){let{message:r}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{let{message:r}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!hw(e)){let{message:r}=q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){let{message:r}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(sr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:r}=q("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}},Pf=class extends ar{constructor(e,r){super(e,r,x5,zf),this.core=e,this.logger=r}},Uf=class extends ar{constructor(e,r){super(e,r,v5,zf),this.core=e,this.logger=r}},Ff=class extends ar{constructor(e,r){super(e,r,_5,zf,s=>s.id),this.core=e,this.logger=r}},Lf=class extends ar{constructor(e,r){super(e,r,R5,pc,()=>fc),this.core=e,this.logger=r}},kf=class extends ar{constructor(e,r){super(e,r,O5,pc),this.core=e,this.logger=r}},Mf=class extends ar{constructor(e,r){super(e,r,C5,pc,s=>s.id),this.core=e,this.logger=r}},L5=Object.defineProperty,k5=(t,e,r)=>e in t?L5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cf=(t,e,r)=>k5(t,typeof e!="symbol"?e+"":e,r),qf=class{constructor(e,r){this.core=e,this.logger=r,Cf(this,"authKeys"),Cf(this,"pairingTopics"),Cf(this,"requests"),this.authKeys=new Lf(this.core,this.logger),this.pairingTopics=new kf(this.core,this.logger),this.requests=new Mf(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},M5=Object.defineProperty,q5=(t,e,r)=>e in t?M5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,te=(t,e,r)=>q5(t,typeof e!="symbol"?e+"":e,r),Ji=class t extends Oo{constructor(e){super(e),te(this,"protocol",Nb),te(this,"version",Pb),te(this,"name",Rf.name),te(this,"metadata"),te(this,"core"),te(this,"logger"),te(this,"events",new dc.EventEmitter),te(this,"engine"),te(this,"session"),te(this,"proposal"),te(this,"pendingRequest"),te(this,"auth"),te(this,"signConfig"),te(this,"on",(s,n)=>this.events.on(s,n)),te(this,"once",(s,n)=>this.events.once(s,n)),te(this,"off",(s,n)=>this.events.off(s,n)),te(this,"removeListener",(s,n)=>this.events.removeListener(s,n)),te(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),te(this,"connect",async s=>{try{return await this.engine.connect(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"pair",async s=>{try{return await this.engine.pair(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"approve",async s=>{try{return await this.engine.approve(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"reject",async s=>{try{return await this.engine.reject(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"update",async s=>{try{return await this.engine.update(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"extend",async s=>{try{return await this.engine.extend(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"request",async s=>{try{return await this.engine.request(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"respond",async s=>{try{return await this.engine.respond(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"ping",async s=>{try{return await this.engine.ping(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"emit",async s=>{try{return await this.engine.emit(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"disconnect",async s=>{try{return await this.engine.disconnect(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"find",s=>{try{return this.engine.find(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),te(this,"authenticate",async(s,n)=>{try{return await this.engine.authenticate(s,n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"approveSessionAuthenticate",async s=>{try{return await this.engine.approveSessionAuthenticate(s)}catch(n){throw this.logger.error(n.message),n}}),te(this,"rejectSessionAuthenticate",async s=>{try{return await this.engine.rejectSessionAuthenticate(s)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||Rf.name,this.metadata=Ym(e?.metadata),this.signConfig=e?.signConfig;let r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:(0,kn.default)(qn({level:e?.logger||Rf.logger}));this.core=e?.core||new Rb(e),this.logger=Pe(r,this.name),this.session=new Uf(this.core,this.logger),this.proposal=new Pf(this.core,this.logger),this.pendingRequest=new Ff(this.core,this.logger),this.engine=new Nf(this),this.auth=new qf(this.core,this.logger)}static async init(e){let r=new t(e);return await r.initialize(),r}get context(){return Ve(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};typeof window<"u"&&(window.WalletConnectSignClient=Ji);var z5=Ji;return Ms(j5);})();
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@walletconnect/relay-auth/dist/index.es.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@walletconnect/utils/dist/index.es.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
